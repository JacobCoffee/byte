<!-- prettier-ignore -->
{% extends 'base/base.html' %}
{% block extrahead %}{% endblock extrahead %}
{% block nav %}
  {% set navbar_color = 'bg-primary dark:text-base-content' %}
  {% include 'base/nav.html' %}
{% endblock nav %}
{% block title %}Dashboard{% endblock %}
{% block headercontent %}

<div class="min-h-full bg-primary pb-32">
  <header>
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <h1 class="text-3xl font-bold tracking-tight text-white">Dashboard</h1>
    </div>
  </header>
</div>
{% endblock headercontent %} {% block content %}
<main class="text-center -mt-32">
  <div class="mx-auto max-w-7xl px-4 pb-12 sm:px-6 lg:px-8">
    <div class="stats shadow-2xl">
      <div class="stat">
        <div class="stat-figure text-primary">
          <!-- https://feathericons.dev/?search=server&iconset=feather -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="24"
            height="24"
            class="inline-block w-8 h-8 stroke-current"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2">
            <rect height="8" rx="2" ry="2" width="20" x="2" y="2"></rect>
            <rect height="8" rx="2" ry="2" width="20" x="2" y="14"></rect>
            <line x1="6" x2="6.01" y1="6" y2="6"></line>
            <line x1="6" x2="6.01" y1="18" y2="18"></line>
          </svg>
        </div>
        <div class="stat-title text-base-content">Server Count</div>
        <div class="stat-value text-primary" id="server-count">-</div>
        <div class="stat-desc">Servers connected to Byte</div>
      </div>

      <div class="stat">
        <div class="stat-figure text-secondary">
          <!-- https://feathericons.dev/?search=message-square&iconset=feather -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="24"
            height="24"
            class="inline-block w-8 h-8 stroke-current"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
        </div>
        <div class="stat-title text-base-content">Messages Sent</div>
        <div class="stat-value text-primary">42,069</div>
        <div class="stat-desc">11% more than last month</div>
      </div>

      <div class="stat">
        <div class="stat-figure text-secondary">
          <div class="avatar" id="bot-avatar">
            <div class="w-16 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
        </div>
        <div class="stat-title text-base-content">Bot Status</div>
        <div class="stat-value">
          <span id="bot-status" class="badge badge-lg">-</span>
        </div>
        <div class="stat-desc">Uptime: <span id="uptime">-</span></div>
      </div>
    </div>
    <div class="mt-4 text-sm text-center text-base-content/60 dark:text-base-100/40">
      Last update: <span id="last-update">-</span>
      | WebSocket: <span id="ws-status" class="ws-status">disconnected</span>
    </div>
    <div class="mt-10 p-4 rounded-lg shadow-2xl bg-base-100/60 dark:bg-neutral/60">
      <h1 class="text-5xl font-bold text-base-content dark:text-base-100/80">Activity</h1>
      <div class="h-[calc(50vh-10em)] overflow-y-auto">
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            Service started 26 hours ago!
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 29th at 15:30</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            Connected to 1 servers
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 29th at 15:31</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            Connected to 1 servers
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 29th at 15:31</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            Connected to 1 servers
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 29th at 15:31</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            Connected to 1 servers
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 29th at 15:31</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            Connected to 1 servers
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 29th at 15:31</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            Connected to 1 servers
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 29th at 15:31</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>

        <div class="chat chat-start">
          <div class="chat-image avatar">
            <div class="w-10 rounded-full">
              <img src="/static/logo.svg" alt="Byte Logo" />
            </div>
          </div>
          <div class="chat-bubble text-base-content dark:text-base-100/80 bg-byte-white dark:bg-neutral">
            User invited Byte to
            <b>Furry Dev Convention</b>
            !
          </div>
          <time class="text-xs opacity-50 text-base-content dark:text-base-100/80">July 30th at 04:20</time>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock content %}
{% block extrajs %}
<script>
let ws = null;
let reconnectAttempts = 0;
const maxReconnectAttempts = 5;

function connectWebSocket() {
    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const wsUrl = `${protocol}//${window.location.host}/ws/dashboard`;

    console.log('Connecting to WebSocket:', wsUrl);
    ws = new WebSocket(wsUrl);

    ws.onopen = () => {
        console.log('WebSocket connected');
        reconnectAttempts = 0;
        updateConnectionStatus('connected');
    };

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        console.log('WebSocket message received:', data);
        updateDashboard(data);
    };

    ws.onclose = () => {
        console.log('WebSocket closed, attempting reconnect...');
        updateConnectionStatus('disconnected');

        if (reconnectAttempts < maxReconnectAttempts) {
            reconnectAttempts++;
            const delay = 3000 * reconnectAttempts;
            console.log(`Reconnecting in ${delay}ms (attempt ${reconnectAttempts}/${maxReconnectAttempts})`);
            setTimeout(connectWebSocket, delay);
        } else {
            console.error('Max reconnection attempts reached');
            updateConnectionStatus('failed');
        }
    };

    ws.onerror = (error) => {
        console.error('WebSocket error:', error);
        updateConnectionStatus('error');
    };
}

function updateDashboard(data) {
    // Update server count
    const serverCountEl = document.getElementById('server-count');
    if (serverCountEl) {
        serverCountEl.textContent = data.server_count;
    }

    // Update bot status
    const botStatusEl = document.getElementById('bot-status');
    const botAvatarEl = document.getElementById('bot-avatar');
    if (botStatusEl) {
        const isOnline = data.bot_status === 'online';
        botStatusEl.textContent = data.bot_status;
        botStatusEl.className = isOnline ? 'badge badge-lg badge-success' : 'badge badge-lg badge-error';

        // Update avatar online indicator
        if (botAvatarEl) {
            if (isOnline) {
                botAvatarEl.classList.add('online');
            } else {
                botAvatarEl.classList.remove('online');
            }
        }
    }

    // Update uptime
    const uptimeEl = document.getElementById('uptime');
    if (uptimeEl) {
        uptimeEl.textContent = formatUptime(data.uptime);
    }

    // Update last update timestamp
    const timestampEl = document.getElementById('last-update');
    if (timestampEl) {
        const updateTime = new Date(data.timestamp);
        timestampEl.textContent = updateTime.toLocaleTimeString();
    }
}

function formatUptime(seconds) {
    const days = Math.floor(seconds / 86400);
    const hours = Math.floor((seconds % 86400) / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);

    if (days > 0) {
        return `${days}d ${hours}h ${minutes}m`;
    } else if (hours > 0) {
        return `${hours}h ${minutes}m`;
    } else {
        return `${minutes}m`;
    }
}

function updateConnectionStatus(status) {
    const statusEl = document.getElementById('ws-status');
    if (statusEl) {
        statusEl.textContent = status;
        statusEl.className = `ws-status ws-status-${status}`;
    }
}

// Connect on page load
document.addEventListener('DOMContentLoaded', connectWebSocket);

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
    if (ws) {
        ws.close();
    }
});
</script>
{% endblock extrajs %}
