<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>sqlalchemy.ext.associationproxy - Docs</title>
    <link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />
  <script>
    const isDarkTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const sessionTheme = sessionStorage['_theme']
    if (sessionTheme) {
      document.documentElement.classList.add(sessionTheme)
    } else if (isDarkTheme) {
      document.documentElement.classList.add('dark')
    }
  </script><link rel="shortcut icon" href="../../../_static/badge.svg"/><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=aecf457f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=28c32440" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=ee381b95" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=80d31e7b" />
    <style>
:root {
  --sy-f-sys:-apple-system, BlinkMacSystemFont, Segoe UI, Oxygen, Ubuntu, Droid Sans, Helvetica Neue;--sy-f-cjk:PingFang SC, Hiragino Sans GB, Droid Sans Fallback, Microsoft YaHei;--sy-f-heading:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-text:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-mono:Menlo, Monaco, Consolas, "Courier New", monospace;--sy-c-divider:rgba(var(--sy-rc-text), 0.1);--sy-c-divider-weak:rgba(var(--sy-rc-text), 0.05);--sy-c-border:rgba(var(--sy-rc-text), 0.14);--sy-s-banner-height:0rem;--sy-s-navbar-height:56px;--sy-s-offset-top:calc(var(--sy-s-navbar-height) + var(--sy-s-banner-height));--sy-c-link:rgb(var(--sy-rc-theme));--sy-c-link-weak:rgba(var(--sy-rc-theme), 0.86);
  --sy-rc-theme:66, 177, 168;--sy-rc-bg:255, 255, 255;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#fff;--sy-c-bg-weak:12, 12, 12;--sy-c-text:#0C0C0C;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#0C0C0C;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#42B1A8;
}
@media (prefers-color-scheme: light) {
  :root {
    --sy-rc-theme:66, 177, 168;--sy-rc-bg:255, 255, 255;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#fff;--sy-c-bg-weak:12, 12, 12;--sy-c-text:#0C0C0C;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#0C0C0C;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#42B1A8;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --sy-rc-theme:66, 177, 168;--sy-rc-bg:12, 12, 12;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#42B1A8;--sy-c-bg-weak:#0C0C0C;--sy-c-text:#EBEBE9;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#EBEBE9;--sy-c-foot-bg:#0C0C0C;--sy-c-foot-divider:#42B1A8;
  }
}
html.light {
  --sy-rc-theme:66, 177, 168;--sy-rc-bg:255, 255, 255;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#fff;--sy-c-bg-weak:12, 12, 12;--sy-c-text:#0C0C0C;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#0C0C0C;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#42B1A8;
}
html.dark {
  --sy-rc-theme:66, 177, 168;--sy-rc-bg:12, 12, 12;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#42B1A8;--sy-c-bg-weak:#0C0C0C;--sy-c-text:#EBEBE9;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#EBEBE9;--sy-c-foot-bg:#0C0C0C;--sy-c-foot-divider:#42B1A8;
}
</style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-heading: Inter, var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="sqlalchemy.ext.associationproxy"/>
<meta name="twitter:card" content="summary"/></head>
<body><div class="document"><div class="announcement">
    <div class="announcement-inner">
      <p>This documentation is currently under development.</p>
      <button class="announcement-close" aria-label="Close announcement">
        <i class="i-icon close"></i>
      </button>
    </div>
  </div><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand mr-4" href="/">
      <img class="light-logo" src="../../../_static/badge.svg" alt="byte-bot" height="28" />
      <img class="dark-logo" src="../../../_static/badge.svg" alt="byte-bot" height="28" />
      <strong>byte-bot</strong>
    </a>
    <div class="sy-head-links" id="NavLinks">
      <nav class="sy-head-nav">

<ul><li class="link">
          <a href="https://byte-bot.app/"><span>Dashboard</span><i class="i-icon external-link"></i></a>
        </li><li class="link">
          <a href="https://github.com/sponsors/JacobCoffee"><span>Sponsor me</span><i class="i-icon external-link"></i></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form>
        
        
        <div class="sy-head-social flex items-center">
            <a class="flex items-center" href="https://github.com/JacobCoffee/byte-bot" aria-label="GitHub">
              <i class="i-icon github"></i>
            </a>
            <a class="flex items-center" href="https://discord.gg/ZVG8hN6RrJ/" aria-label="Discord">
              <i class="i-icon discord"></i>
            </a>
        </div>
      </div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden">
      <button class="js-theme theme-switch flex items-center" data-aria-light="Switch to dark mode" data-aria-dark="Switch to light mode">
        <i class="i-icon theme-icon"></i>
      </button>
      <button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="NavLinks" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading"><span class="caption-text">Byte Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../byte/usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../byte/usage/byte.html">About Byte</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../byte/usage/starting.html">Starting Byte</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../byte/api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../byte/api/bot.html">bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../byte/api/plugins/index.html">plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/plugins/admin.html">admin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/plugins/astral.html">astral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/plugins/events.html">events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/plugins/general.html">general</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/plugins/github.html">github</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/plugins/testing.html">testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/plugins/python.html">python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../byte/api/views/index.html">views</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/views/forums.html">forums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/views/astral.html">astral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/views/python.html">python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/views/abstract.html">abstract</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../byte/api/lib/index.html">lib</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/lib/common.html">common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/lib/logging.html">logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/lib/settings.html">settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../byte/api/lib/utils.html">utils</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Web Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../web/usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../web/usage/server.html">About the Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../web/usage/starting.html">Starting Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../web/api/app.html">app</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../web/api/cli.html">cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../web/api/metadata.html">metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../web/api/utils.html">utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../web/api/domain/index.html">domain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/domain/init.html">Domain Initializer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/domain/urls.html">urls</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/domain/system/index.html">system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/system/controllers.html">controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/system/dtos.html">dtos</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/system/helpers.html">helpers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/domain/guilds/index.html">guilds</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/guilds/controllers.html">controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/guilds/dependencies.html">dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/guilds/helpers.html">helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/guilds/schemas.html">schemas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/guilds/services.html">services</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/guilds/urls.html">urls</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/domain/github/index.html">github</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/github/helpers.html">helpers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/domain/web/index.html">web</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/web/controllers.html">controllers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/domain/db/index.html">Database</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/domain/db/models.html">models</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../web/api/lib/index.html">lib</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/constants.html">constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/cors.html">cors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/dependencies.html">dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/dtos.html">dtos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/exceptions.html">exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/openapi.html">openapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/schema.html">schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/serialization.html">serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/settings.html">settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/static_files.html">static files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/template.html">template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/log/index.html">logging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/lib/log/controller.html">controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/lib/log/init.html">init</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/lib/log/utils.html">utils</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../web/api/lib/db/index.html">Database Library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/lib/db/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../web/api/lib/db/orm.html">orm</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contribution-guide.html">Contribution guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
      
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-icon close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/JacobCoffee/byte"
  data-type="github" data-user="JacobCoffee" data-repo="byte">
  <span class="w-8 flex items-center justify-around shrink-0 text-2xl">
    <i class="i-icon github"></i>
  </span>
  <span class="flex-grow px-2">
    <span>JacobCoffee/byte</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <i class="i-icon star"></i>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <i class="i-icon git-fork"></i>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
    <div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-icon menu"></i>
      </button>
    </div>
    <ul class="flex-1">
      
      
      <li><a href="../../../index.html">byte-bot</a><span>/</span></li>
      
      <li><a href="../../index.html">Module code</a><span>/</span></li>
      
      <li><strong>sqlalchemy.ext.associationproxy</strong></li>
      
      
    </ul>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-icon outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for sqlalchemy.ext.associationproxy</h1><div class="highlight"><pre>
<span></span><span id="1-1"><span class="c1"># ext/associationproxy.py</span>
</span><span id="1-2"><span class="c1"># Copyright (C) 2005-2025 the SQLAlchemy authors and contributors</span>
</span><span id="1-3"><span class="c1"># &lt;see AUTHORS file&gt;</span>
</span><span id="1-4"><span class="c1">#</span>
</span><span id="1-5"><span class="c1"># This module is part of SQLAlchemy and is released under</span>
</span><span id="1-6"><span class="c1"># the MIT License: https://www.opensource.org/licenses/mit-license.php</span>
</span><span id="1-7">
</span><span id="1-8"><span class="sd">&quot;&quot;&quot;Contain the ``AssociationProxy`` class.</span>
</span><span id="1-9">
</span><span id="1-10"><span class="sd">The ``AssociationProxy`` is a Python property object which provides</span>
</span><span id="1-11"><span class="sd">transparent proxied access to the endpoint of an association object.</span>
</span><span id="1-12">
</span><span id="1-13"><span class="sd">See the example ``examples/association/proxied_association.py``.</span>
</span><span id="1-14">
</span><span id="1-15"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-16"><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
</span><span id="1-17">
</span><span id="1-18"><span class="kn">import</span><span class="w"> </span><span class="nn">operator</span>
</span><span id="1-19"><span class="kn">import</span><span class="w"> </span><span class="nn">typing</span>
</span><span id="1-20"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractSet</span>
</span><span id="1-21"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
</span><span id="1-22"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
</span><span id="1-23"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">cast</span>
</span><span id="1-24"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Collection</span>
</span><span id="1-25"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span>
</span><span id="1-26"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Generic</span>
</span><span id="1-27"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemsView</span>
</span><span id="1-28"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>
</span><span id="1-29"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterator</span>
</span><span id="1-30"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">KeysView</span>
</span><span id="1-31"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
</span><span id="1-32"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapping</span>
</span><span id="1-33"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">MutableMapping</span>
</span><span id="1-34"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">MutableSequence</span>
</span><span id="1-35"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">MutableSet</span>
</span><span id="1-36"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoReturn</span>
</span><span id="1-37"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
</span><span id="1-38"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">overload</span>
</span><span id="1-39"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Set</span>
</span><span id="1-40"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>
</span><span id="1-41"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Type</span>
</span><span id="1-42"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span>
</span><span id="1-43"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span>
</span><span id="1-44"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValuesView</span>
</span><span id="1-45">
</span><span id="1-46"><span class="kn">from</span><span class="w"> </span><span class="nn">..</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnElement</span>
</span><span id="1-47"><span class="kn">from</span><span class="w"> </span><span class="nn">..</span><span class="w"> </span><span class="kn">import</span> <span class="n">exc</span>
</span><span id="1-48"><span class="kn">from</span><span class="w"> </span><span class="nn">..</span><span class="w"> </span><span class="kn">import</span> <span class="n">inspect</span>
</span><span id="1-49"><span class="kn">from</span><span class="w"> </span><span class="nn">..</span><span class="w"> </span><span class="kn">import</span> <span class="n">orm</span>
</span><span id="1-50"><span class="kn">from</span><span class="w"> </span><span class="nn">..</span><span class="w"> </span><span class="kn">import</span> <span class="n">util</span>
</span><span id="1-51"><span class="kn">from</span><span class="w"> </span><span class="nn">..orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">collections</span>
</span><span id="1-52"><span class="kn">from</span><span class="w"> </span><span class="nn">..orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">InspectionAttrExtensionType</span>
</span><span id="1-53"><span class="kn">from</span><span class="w"> </span><span class="nn">..orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">interfaces</span>
</span><span id="1-54"><span class="kn">from</span><span class="w"> </span><span class="nn">..orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">ORMDescriptor</span>
</span><span id="1-55"><span class="kn">from</span><span class="w"> </span><span class="nn">..orm.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLORMOperations</span>
</span><span id="1-56"><span class="kn">from</span><span class="w"> </span><span class="nn">..orm.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">_AttributeOptions</span>
</span><span id="1-57"><span class="kn">from</span><span class="w"> </span><span class="nn">..orm.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">_DCAttributeOptions</span>
</span><span id="1-58"><span class="kn">from</span><span class="w"> </span><span class="nn">..orm.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">_DEFAULT_ATTRIBUTE_OPTIONS</span>
</span><span id="1-59"><span class="kn">from</span><span class="w"> </span><span class="nn">..sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">operators</span>
</span><span id="1-60"><span class="kn">from</span><span class="w"> </span><span class="nn">..sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">or_</span>
</span><span id="1-61"><span class="kn">from</span><span class="w"> </span><span class="nn">..sql.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">_NoArg</span>
</span><span id="1-62"><span class="kn">from</span><span class="w"> </span><span class="nn">..util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
</span><span id="1-63"><span class="kn">from</span><span class="w"> </span><span class="nn">..util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Protocol</span>
</span><span id="1-64"><span class="kn">from</span><span class="w"> </span><span class="nn">..util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>
</span><span id="1-65"><span class="kn">from</span><span class="w"> </span><span class="nn">..util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">SupportsIndex</span>
</span><span id="1-66"><span class="kn">from</span><span class="w"> </span><span class="nn">..util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">SupportsKeysAndGetItem</span>
</span><span id="1-67">
</span><span id="1-68"><span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-69">    <span class="kn">from</span><span class="w"> </span><span class="nn">..orm.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">MapperProperty</span>
</span><span id="1-70">    <span class="kn">from</span><span class="w"> </span><span class="nn">..orm.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">PropComparator</span>
</span><span id="1-71">    <span class="kn">from</span><span class="w"> </span><span class="nn">..orm.mapper</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapper</span>
</span><span id="1-72">    <span class="kn">from</span><span class="w"> </span><span class="nn">..sql._typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">_ColumnExpressionArgument</span>
</span><span id="1-73">    <span class="kn">from</span><span class="w"> </span><span class="nn">..sql._typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">_InfoType</span>
</span><span id="1-74">
</span><span id="1-75">
</span><span id="1-76"><span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Any</span><span class="p">)</span>
</span><span id="1-77"><span class="n">_T_co</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T_co&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Any</span><span class="p">,</span> <span class="n">covariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="1-78"><span class="n">_T_con</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T_con&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Any</span><span class="p">,</span> <span class="n">contravariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="1-79"><span class="n">_S</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_S&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Any</span><span class="p">)</span>
</span><span id="1-80"><span class="n">_KT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_KT&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Any</span><span class="p">)</span>
</span><span id="1-81"><span class="n">_VT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_VT&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Any</span><span class="p">)</span>
</span><span id="1-82">
</span><span id="1-83">
</span><span id="1-84"><span class="k">def</span><span class="w"> </span><span class="nf">association_proxy</span><span class="p">(</span>
</span><span id="1-85">    <span class="n">target_collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-86">    <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-87">    <span class="o">*</span><span class="p">,</span>
</span><span id="1-88">    <span class="n">creator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_CreatorProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-89">    <span class="n">getset_factory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_GetSetFactoryProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-90">    <span class="n">proxy_factory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ProxyFactoryProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-91">    <span class="n">proxy_bulk_set</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ProxyBulkSetProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-92">    <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-93">    <span class="n">cascade_scalar_deletes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-94">    <span class="n">create_on_none_assignment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-95">    <span class="n">init</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_NoArg</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">,</span>
</span><span id="1-96">    <span class="nb">repr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_NoArg</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">,</span>  <span class="c1"># noqa: A002</span>
</span><span id="1-97">    <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">,</span>
</span><span id="1-98">    <span class="n">default_factory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_NoArg</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">_T</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">,</span>
</span><span id="1-99">    <span class="n">compare</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_NoArg</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">,</span>
</span><span id="1-100">    <span class="n">kw_only</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_NoArg</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">,</span>
</span><span id="1-101">    <span class="nb">hash</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_NoArg</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">,</span>  <span class="c1"># noqa: A002</span>
</span><span id="1-102"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssociationProxy</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-103"><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return a Python property implementing a view of a target</span>
</span><span id="1-104"><span class="sd">    attribute which references an attribute on members of the</span>
</span><span id="1-105"><span class="sd">    target.</span>
</span><span id="1-106">
</span><span id="1-107"><span class="sd">    The returned value is an instance of :class:`.AssociationProxy`.</span>
</span><span id="1-108">
</span><span id="1-109"><span class="sd">    Implements a Python property representing a relationship as a collection</span>
</span><span id="1-110"><span class="sd">    of simpler values, or a scalar value.  The proxied property will mimic</span>
</span><span id="1-111"><span class="sd">    the collection type of the target (list, dict or set), or, in the case of</span>
</span><span id="1-112"><span class="sd">    a one to one relationship, a simple scalar value.</span>
</span><span id="1-113">
</span><span id="1-114"><span class="sd">    :param target_collection: Name of the attribute that is the immediate</span>
</span><span id="1-115"><span class="sd">      target.  This attribute is typically mapped by</span>
</span><span id="1-116"><span class="sd">      :func:`~sqlalchemy.orm.relationship` to link to a target collection, but</span>
</span><span id="1-117"><span class="sd">      can also be a many-to-one or non-scalar relationship.</span>
</span><span id="1-118">
</span><span id="1-119"><span class="sd">    :param attr: Attribute on the associated instance or instances that</span>
</span><span id="1-120"><span class="sd">      are available on instances of the target object.</span>
</span><span id="1-121">
</span><span id="1-122"><span class="sd">    :param creator: optional.</span>
</span><span id="1-123">
</span><span id="1-124"><span class="sd">      Defines custom behavior when new items are added to the proxied</span>
</span><span id="1-125"><span class="sd">      collection.</span>
</span><span id="1-126">
</span><span id="1-127"><span class="sd">      By default, adding new items to the collection will trigger a</span>
</span><span id="1-128"><span class="sd">      construction of an instance of the target object, passing the given</span>
</span><span id="1-129"><span class="sd">      item as a positional argument to the target constructor.  For cases</span>
</span><span id="1-130"><span class="sd">      where this isn&#39;t sufficient, :paramref:`.association_proxy.creator`</span>
</span><span id="1-131"><span class="sd">      can supply a callable that will construct the object in the</span>
</span><span id="1-132"><span class="sd">      appropriate way, given the item that was passed.</span>
</span><span id="1-133">
</span><span id="1-134"><span class="sd">      For list- and set- oriented collections, a single argument is</span>
</span><span id="1-135"><span class="sd">      passed to the callable. For dictionary oriented collections, two</span>
</span><span id="1-136"><span class="sd">      arguments are passed, corresponding to the key and value.</span>
</span><span id="1-137">
</span><span id="1-138"><span class="sd">      The :paramref:`.association_proxy.creator` callable is also invoked</span>
</span><span id="1-139"><span class="sd">      for scalar (i.e. many-to-one, one-to-one) relationships. If the</span>
</span><span id="1-140"><span class="sd">      current value of the target relationship attribute is ``None``, the</span>
</span><span id="1-141"><span class="sd">      callable is used to construct a new object.  If an object value already</span>
</span><span id="1-142"><span class="sd">      exists, the given attribute value is populated onto that object.</span>
</span><span id="1-143">
</span><span id="1-144"><span class="sd">      .. seealso::</span>
</span><span id="1-145">
</span><span id="1-146"><span class="sd">        :ref:`associationproxy_creator`</span>
</span><span id="1-147">
</span><span id="1-148"><span class="sd">    :param cascade_scalar_deletes: when True, indicates that setting</span>
</span><span id="1-149"><span class="sd">        the proxied value to ``None``, or deleting it via ``del``, should</span>
</span><span id="1-150"><span class="sd">        also remove the source object.  Only applies to scalar attributes.</span>
</span><span id="1-151"><span class="sd">        Normally, removing the proxied target will not remove the proxy</span>
</span><span id="1-152"><span class="sd">        source, as this object may have other state that is still to be</span>
</span><span id="1-153"><span class="sd">        kept.</span>
</span><span id="1-154">
</span><span id="1-155"><span class="sd">        .. versionadded:: 1.3</span>
</span><span id="1-156">
</span><span id="1-157"><span class="sd">        .. seealso::</span>
</span><span id="1-158">
</span><span id="1-159"><span class="sd">            :ref:`cascade_scalar_deletes` - complete usage example</span>
</span><span id="1-160">
</span><span id="1-161"><span class="sd">    :param create_on_none_assignment: when True, indicates that setting</span>
</span><span id="1-162"><span class="sd">      the proxied value to ``None`` should **create** the source object</span>
</span><span id="1-163"><span class="sd">      if it does not exist, using the creator.  Only applies to scalar</span>
</span><span id="1-164"><span class="sd">      attributes.  This is mutually exclusive</span>
</span><span id="1-165"><span class="sd">      vs. the :paramref:`.assocation_proxy.cascade_scalar_deletes`.</span>
</span><span id="1-166">
</span><span id="1-167"><span class="sd">      .. versionadded:: 2.0.18</span>
</span><span id="1-168">
</span><span id="1-169"><span class="sd">    :param init: Specific to :ref:`orm_declarative_native_dataclasses`,</span>
</span><span id="1-170"><span class="sd">     specifies if the mapped attribute should be part of the ``__init__()``</span>
</span><span id="1-171"><span class="sd">     method as generated by the dataclass process.</span>
</span><span id="1-172">
</span><span id="1-173"><span class="sd">     .. versionadded:: 2.0.0b4</span>
</span><span id="1-174">
</span><span id="1-175"><span class="sd">    :param repr: Specific to :ref:`orm_declarative_native_dataclasses`,</span>
</span><span id="1-176"><span class="sd">     specifies if the attribute established by this :class:`.AssociationProxy`</span>
</span><span id="1-177"><span class="sd">     should be part of the ``__repr__()`` method as generated by the dataclass</span>
</span><span id="1-178"><span class="sd">     process.</span>
</span><span id="1-179">
</span><span id="1-180"><span class="sd">     .. versionadded:: 2.0.0b4</span>
</span><span id="1-181">
</span><span id="1-182"><span class="sd">    :param default_factory: Specific to</span>
</span><span id="1-183"><span class="sd">     :ref:`orm_declarative_native_dataclasses`, specifies a default-value</span>
</span><span id="1-184"><span class="sd">     generation function that will take place as part of the ``__init__()``</span>
</span><span id="1-185"><span class="sd">     method as generated by the dataclass process.</span>
</span><span id="1-186">
</span><span id="1-187"><span class="sd">     .. versionadded:: 2.0.0b4</span>
</span><span id="1-188">
</span><span id="1-189"><span class="sd">    :param compare: Specific to</span>
</span><span id="1-190"><span class="sd">     :ref:`orm_declarative_native_dataclasses`, indicates if this field</span>
</span><span id="1-191"><span class="sd">     should be included in comparison operations when generating the</span>
</span><span id="1-192"><span class="sd">     ``__eq__()`` and ``__ne__()`` methods for the mapped class.</span>
</span><span id="1-193">
</span><span id="1-194"><span class="sd">     .. versionadded:: 2.0.0b4</span>
</span><span id="1-195">
</span><span id="1-196"><span class="sd">    :param kw_only: Specific to :ref:`orm_declarative_native_dataclasses`,</span>
</span><span id="1-197"><span class="sd">     indicates if this field should be marked as keyword-only when generating</span>
</span><span id="1-198"><span class="sd">     the ``__init__()`` method as generated by the dataclass process.</span>
</span><span id="1-199">
</span><span id="1-200"><span class="sd">     .. versionadded:: 2.0.0b4</span>
</span><span id="1-201">
</span><span id="1-202"><span class="sd">    :param hash: Specific to</span>
</span><span id="1-203"><span class="sd">     :ref:`orm_declarative_native_dataclasses`, controls if this field</span>
</span><span id="1-204"><span class="sd">     is included when generating the ``__hash__()`` method for the mapped</span>
</span><span id="1-205"><span class="sd">     class.</span>
</span><span id="1-206">
</span><span id="1-207"><span class="sd">     .. versionadded:: 2.0.36</span>
</span><span id="1-208">
</span><span id="1-209"><span class="sd">    :param info: optional, will be assigned to</span>
</span><span id="1-210"><span class="sd">     :attr:`.AssociationProxy.info` if present.</span>
</span><span id="1-211">
</span><span id="1-212">
</span><span id="1-213"><span class="sd">    The following additional parameters involve injection of custom behaviors</span>
</span><span id="1-214"><span class="sd">    within the :class:`.AssociationProxy` object and are for advanced use</span>
</span><span id="1-215"><span class="sd">    only:</span>
</span><span id="1-216">
</span><span id="1-217"><span class="sd">    :param getset_factory: Optional.  Proxied attribute access is</span>
</span><span id="1-218"><span class="sd">        automatically handled by routines that get and set values based on</span>
</span><span id="1-219"><span class="sd">        the `attr` argument for this proxy.</span>
</span><span id="1-220">
</span><span id="1-221"><span class="sd">        If you would like to customize this behavior, you may supply a</span>
</span><span id="1-222"><span class="sd">        `getset_factory` callable that produces a tuple of `getter` and</span>
</span><span id="1-223"><span class="sd">        `setter` functions.  The factory is called with two arguments, the</span>
</span><span id="1-224"><span class="sd">        abstract type of the underlying collection and this proxy instance.</span>
</span><span id="1-225">
</span><span id="1-226"><span class="sd">    :param proxy_factory: Optional.  The type of collection to emulate is</span>
</span><span id="1-227"><span class="sd">        determined by sniffing the target collection.  If your collection</span>
</span><span id="1-228"><span class="sd">        type can&#39;t be determined by duck typing or you&#39;d like to use a</span>
</span><span id="1-229"><span class="sd">        different collection implementation, you may supply a factory</span>
</span><span id="1-230"><span class="sd">        function to produce those collections.  Only applicable to</span>
</span><span id="1-231"><span class="sd">        non-scalar relationships.</span>
</span><span id="1-232">
</span><span id="1-233"><span class="sd">    :param proxy_bulk_set: Optional, use with proxy_factory.</span>
</span><span id="1-234">
</span><span id="1-235">
</span><span id="1-236"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-237">    <span class="k">return</span> <span class="n">AssociationProxy</span><span class="p">(</span>
</span><span id="1-238">        <span class="n">target_collection</span><span class="p">,</span>
</span><span id="1-239">        <span class="n">attr</span><span class="p">,</span>
</span><span id="1-240">        <span class="n">creator</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
</span><span id="1-241">        <span class="n">getset_factory</span><span class="o">=</span><span class="n">getset_factory</span><span class="p">,</span>
</span><span id="1-242">        <span class="n">proxy_factory</span><span class="o">=</span><span class="n">proxy_factory</span><span class="p">,</span>
</span><span id="1-243">        <span class="n">proxy_bulk_set</span><span class="o">=</span><span class="n">proxy_bulk_set</span><span class="p">,</span>
</span><span id="1-244">        <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
</span><span id="1-245">        <span class="n">cascade_scalar_deletes</span><span class="o">=</span><span class="n">cascade_scalar_deletes</span><span class="p">,</span>
</span><span id="1-246">        <span class="n">create_on_none_assignment</span><span class="o">=</span><span class="n">create_on_none_assignment</span><span class="p">,</span>
</span><span id="1-247">        <span class="n">attribute_options</span><span class="o">=</span><span class="n">_AttributeOptions</span><span class="p">(</span>
</span><span id="1-248">            <span class="n">init</span><span class="p">,</span> <span class="nb">repr</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">default_factory</span><span class="p">,</span> <span class="n">compare</span><span class="p">,</span> <span class="n">kw_only</span><span class="p">,</span> <span class="nb">hash</span>
</span><span id="1-249">        <span class="p">),</span>
</span><span id="1-250">    <span class="p">)</span>
</span><span id="1-251">
</span><span id="1-252">
</span><span id="1-253"><span class="k">class</span><span class="w"> </span><span class="nc">AssociationProxyExtensionType</span><span class="p">(</span><span class="n">InspectionAttrExtensionType</span><span class="p">):</span>
</span><span id="1-254">    <span class="n">ASSOCIATION_PROXY</span> <span class="o">=</span> <span class="s2">&quot;ASSOCIATION_PROXY&quot;</span>
</span><span id="1-255"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbol indicating an :class:`.InspectionAttr` that&#39;s</span>
</span><span id="1-256"><span class="sd">    of type :class:`.AssociationProxy`.</span>
</span><span id="1-257">
</span><span id="1-258"><span class="sd">    Is assigned to the :attr:`.InspectionAttr.extension_type`</span>
</span><span id="1-259"><span class="sd">    attribute.</span>
</span><span id="1-260">
</span><span id="1-261"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-262">
</span><span id="1-263">
</span><span id="1-264"><span class="k">class</span><span class="w"> </span><span class="nc">_GetterProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">[</span><span class="n">_T_co</span><span class="p">]):</span>
</span><span id="1-265">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T_co</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-266">
</span><span id="1-267">
</span><span id="1-268"><span class="c1"># mypy 0.990 we are no longer allowed to make this Protocol[_T_con]</span>
</span><span id="1-269"><span class="k">class</span><span class="w"> </span><span class="nc">_SetterProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span> <span class="o">...</span>
</span><span id="1-270">
</span><span id="1-271">
</span><span id="1-272"><span class="k">class</span><span class="w"> </span><span class="nc">_PlainSetterProtocol</span><span class="p">(</span><span class="n">_SetterProtocol</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">[</span><span class="n">_T_con</span><span class="p">]):</span>
</span><span id="1-273">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T_con</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-274">
</span><span id="1-275">
</span><span id="1-276"><span class="k">class</span><span class="w"> </span><span class="nc">_DictSetterProtocol</span><span class="p">(</span><span class="n">_SetterProtocol</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">[</span><span class="n">_T_con</span><span class="p">]):</span>
</span><span id="1-277">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T_con</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-278">
</span><span id="1-279">
</span><span id="1-280"><span class="c1"># mypy 0.990 we are no longer allowed to make this Protocol[_T_con]</span>
</span><span id="1-281"><span class="k">class</span><span class="w"> </span><span class="nc">_CreatorProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span> <span class="o">...</span>
</span><span id="1-282">
</span><span id="1-283">
</span><span id="1-284"><span class="k">class</span><span class="w"> </span><span class="nc">_PlainCreatorProtocol</span><span class="p">(</span><span class="n">_CreatorProtocol</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">[</span><span class="n">_T_con</span><span class="p">]):</span>
</span><span id="1-285">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T_con</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-286">
</span><span id="1-287">
</span><span id="1-288"><span class="k">class</span><span class="w"> </span><span class="nc">_KeyCreatorProtocol</span><span class="p">(</span><span class="n">_CreatorProtocol</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">[</span><span class="n">_T_con</span><span class="p">]):</span>
</span><span id="1-289">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_T_con</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-290">
</span><span id="1-291">
</span><span id="1-292"><span class="k">class</span><span class="w"> </span><span class="nc">_LazyCollectionProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-293">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span id="1-294">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-295">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="1-296">        <span class="n">MutableSet</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T</span><span class="p">],</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span><span id="1-297">    <span class="p">]:</span> <span class="o">...</span>
</span><span id="1-298">
</span><span id="1-299">
</span><span id="1-300"><span class="k">class</span><span class="w"> </span><span class="nc">_GetSetFactoryProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
</span><span id="1-301">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span id="1-302">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-303">        <span class="n">collection_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</span><span id="1-304">        <span class="n">assoc_instance</span><span class="p">:</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-305">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_GetterProtocol</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">_SetterProtocol</span><span class="p">]:</span> <span class="o">...</span>
</span><span id="1-306">
</span><span id="1-307">
</span><span id="1-308"><span class="k">class</span><span class="w"> </span><span class="nc">_ProxyFactoryProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
</span><span id="1-309">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span id="1-310">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-311">        <span class="n">lazy_collection</span><span class="p">:</span> <span class="n">_LazyCollectionProtocol</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-312">        <span class="n">creator</span><span class="p">:</span> <span class="n">_CreatorProtocol</span><span class="p">,</span>
</span><span id="1-313">        <span class="n">value_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-314">        <span class="n">parent</span><span class="p">:</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-315">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-316">
</span><span id="1-317">
</span><span id="1-318"><span class="k">class</span><span class="w"> </span><span class="nc">_ProxyBulkSetProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
</span><span id="1-319">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span id="1-320">        <span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">:</span> <span class="n">_AssociationCollection</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">collection</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span id="1-321">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-322">
</span><span id="1-323">
</span><span id="1-324"><span class="k">class</span><span class="w"> </span><span class="nc">_AssociationProxyProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-325"><span class="w">    </span><span class="sd">&quot;&quot;&quot;describes the interface of :class:`.AssociationProxy`</span>
</span><span id="1-326"><span class="sd">    without including descriptor methods in the interface.&quot;&quot;&quot;</span>
</span><span id="1-327">
</span><span id="1-328">    <span class="n">creator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_CreatorProtocol</span><span class="p">]</span>
</span><span id="1-329">    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-330">    <span class="n">target_collection</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-331">    <span class="n">value_attr</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-332">    <span class="n">cascade_scalar_deletes</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="1-333">    <span class="n">create_on_none_assignment</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="1-334">    <span class="n">getset_factory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_GetSetFactoryProtocol</span><span class="p">]</span>
</span><span id="1-335">    <span class="n">proxy_factory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ProxyFactoryProtocol</span><span class="p">]</span>
</span><span id="1-336">    <span class="n">proxy_bulk_set</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ProxyBulkSetProtocol</span><span class="p">]</span>
</span><span id="1-337">
</span><span id="1-338">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span id="1-339">    <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_InfoType</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-340">
</span><span id="1-341">    <span class="k">def</span><span class="w"> </span><span class="nf">for_class</span><span class="p">(</span>
</span><span id="1-342">        <span class="bp">self</span><span class="p">,</span> <span class="n">class_</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-343">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
</span><span id="1-344">
</span><span id="1-345">    <span class="k">def</span><span class="w"> </span><span class="nf">_default_getset</span><span class="p">(</span>
</span><span id="1-346">        <span class="bp">self</span><span class="p">,</span> <span class="n">collection_class</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-347">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_GetterProtocol</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">_SetterProtocol</span><span class="p">]:</span> <span class="o">...</span>
</span><span id="1-348">
</span><span id="1-349">
</span><span id="1-350"><span class="k">class</span><span class="w"> </span><span class="nc">AssociationProxy</span><span class="p">(</span>
</span><span id="1-351">    <span class="n">interfaces</span><span class="o">.</span><span class="n">InspectionAttrInfo</span><span class="p">,</span>
</span><span id="1-352">    <span class="n">ORMDescriptor</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span>
</span><span id="1-353">    <span class="n">_DCAttributeOptions</span><span class="p">,</span>
</span><span id="1-354">    <span class="n">_AssociationProxyProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span>
</span><span id="1-355"><span class="p">):</span>
</span><span id="1-356"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A descriptor that presents a read/write view of an object attribute.&quot;&quot;&quot;</span>
</span><span id="1-357">
</span><span id="1-358">    <span class="n">is_attribute</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-359">    <span class="n">extension_type</span> <span class="o">=</span> <span class="n">AssociationProxyExtensionType</span><span class="o">.</span><span class="n">ASSOCIATION_PROXY</span>
</span><span id="1-360">
</span><span id="1-361">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-362">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-363">        <span class="n">target_collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-364">        <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-365">        <span class="o">*</span><span class="p">,</span>
</span><span id="1-366">        <span class="n">creator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_CreatorProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-367">        <span class="n">getset_factory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_GetSetFactoryProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-368">        <span class="n">proxy_factory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ProxyFactoryProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-369">        <span class="n">proxy_bulk_set</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ProxyBulkSetProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-370">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-371">        <span class="n">cascade_scalar_deletes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-372">        <span class="n">create_on_none_assignment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-373">        <span class="n">attribute_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_AttributeOptions</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-374">    <span class="p">):</span>
</span><span id="1-375"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a new :class:`.AssociationProxy`.</span>
</span><span id="1-376">
</span><span id="1-377"><span class="sd">        The :class:`.AssociationProxy` object is typically constructed using</span>
</span><span id="1-378"><span class="sd">        the :func:`.association_proxy` constructor function. See the</span>
</span><span id="1-379"><span class="sd">        description of :func:`.association_proxy` for a description of all</span>
</span><span id="1-380"><span class="sd">        parameters.</span>
</span><span id="1-381">
</span><span id="1-382">
</span><span id="1-383"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-384">        <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span> <span class="o">=</span> <span class="n">target_collection</span>
</span><span id="1-385">        <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span> <span class="o">=</span> <span class="n">attr</span>
</span><span id="1-386">        <span class="bp">self</span><span class="o">.</span><span class="n">creator</span> <span class="o">=</span> <span class="n">creator</span>
</span><span id="1-387">        <span class="bp">self</span><span class="o">.</span><span class="n">getset_factory</span> <span class="o">=</span> <span class="n">getset_factory</span>
</span><span id="1-388">        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_factory</span> <span class="o">=</span> <span class="n">proxy_factory</span>
</span><span id="1-389">        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_bulk_set</span> <span class="o">=</span> <span class="n">proxy_bulk_set</span>
</span><span id="1-390">
</span><span id="1-391">        <span class="k">if</span> <span class="n">cascade_scalar_deletes</span> <span class="ow">and</span> <span class="n">create_on_none_assignment</span><span class="p">:</span>
</span><span id="1-392">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-393">                <span class="s2">&quot;The cascade_scalar_deletes and create_on_none_assignment &quot;</span>
</span><span id="1-394">                <span class="s2">&quot;parameters are mutually exclusive.&quot;</span>
</span><span id="1-395">            <span class="p">)</span>
</span><span id="1-396">        <span class="bp">self</span><span class="o">.</span><span class="n">cascade_scalar_deletes</span> <span class="o">=</span> <span class="n">cascade_scalar_deletes</span>
</span><span id="1-397">        <span class="bp">self</span><span class="o">.</span><span class="n">create_on_none_assignment</span> <span class="o">=</span> <span class="n">create_on_none_assignment</span>
</span><span id="1-398">
</span><span id="1-399">        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-400">            <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="1-401">            <span class="n">target_collection</span><span class="p">,</span>
</span><span id="1-402">            <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
</span><span id="1-403">        <span class="p">)</span>
</span><span id="1-404">        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
</span><span id="1-405">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>  <span class="c1"># type: ignore</span>
</span><span id="1-406">
</span><span id="1-407">        <span class="k">if</span> <span class="p">(</span>
</span><span id="1-408">            <span class="n">attribute_options</span>
</span><span id="1-409">            <span class="ow">and</span> <span class="n">attribute_options</span> <span class="o">!=</span> <span class="n">_DEFAULT_ATTRIBUTE_OPTIONS</span>
</span><span id="1-410">        <span class="p">):</span>
</span><span id="1-411">            <span class="bp">self</span><span class="o">.</span><span class="n">_has_dataclass_arguments</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-412">            <span class="bp">self</span><span class="o">.</span><span class="n">_attribute_options</span> <span class="o">=</span> <span class="n">attribute_options</span>
</span><span id="1-413">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-414">            <span class="bp">self</span><span class="o">.</span><span class="n">_has_dataclass_arguments</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-415">            <span class="bp">self</span><span class="o">.</span><span class="n">_attribute_options</span> <span class="o">=</span> <span class="n">_DEFAULT_ATTRIBUTE_OPTIONS</span>
</span><span id="1-416">
</span><span id="1-417">    <span class="nd">@overload</span>
</span><span id="1-418">    <span class="k">def</span><span class="w"> </span><span class="fm">__get__</span><span class="p">(</span>
</span><span id="1-419">        <span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">owner</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="1-420">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-421">
</span><span id="1-422">    <span class="nd">@overload</span>
</span><span id="1-423">    <span class="k">def</span><span class="w"> </span><span class="fm">__get__</span><span class="p">(</span>
</span><span id="1-424">        <span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">owner</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-425">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
</span><span id="1-426">
</span><span id="1-427">    <span class="nd">@overload</span>
</span><span id="1-428">    <span class="k">def</span><span class="w"> </span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-429">
</span><span id="1-430">    <span class="k">def</span><span class="w"> </span><span class="fm">__get__</span><span class="p">(</span>
</span><span id="1-431">        <span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-432">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">_T</span><span class="p">,</span> <span class="n">AssociationProxy</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span id="1-433">        <span class="k">if</span> <span class="n">owner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-434">            <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-435">        <span class="n">inst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_instance</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</span><span id="1-436">        <span class="k">if</span> <span class="n">inst</span><span class="p">:</span>
</span><span id="1-437">            <span class="k">return</span> <span class="n">inst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="1-438">
</span><span id="1-439">        <span class="k">assert</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="1-440">
</span><span id="1-441">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-442">
</span><span id="1-443">    <span class="k">def</span><span class="w"> </span><span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-444">        <span class="n">class_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="1-445">        <span class="bp">self</span><span class="o">.</span><span class="n">_as_instance</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="1-446">
</span><span id="1-447">    <span class="k">def</span><span class="w"> </span><span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-448">        <span class="n">class_</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="1-449">        <span class="bp">self</span><span class="o">.</span><span class="n">_as_instance</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="1-450">
</span><span id="1-451">    <span class="k">def</span><span class="w"> </span><span class="nf">for_class</span><span class="p">(</span>
</span><span id="1-452">        <span class="bp">self</span><span class="p">,</span> <span class="n">class_</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-453">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-454"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the internal state local to a specific mapped class.</span>
</span><span id="1-455">
</span><span id="1-456"><span class="sd">        E.g., given a class ``User``::</span>
</span><span id="1-457">
</span><span id="1-458"><span class="sd">            class User(Base):</span>
</span><span id="1-459"><span class="sd">                # ...</span>
</span><span id="1-460">
</span><span id="1-461"><span class="sd">                keywords = association_proxy(&quot;kws&quot;, &quot;keyword&quot;)</span>
</span><span id="1-462">
</span><span id="1-463"><span class="sd">        If we access this :class:`.AssociationProxy` from</span>
</span><span id="1-464"><span class="sd">        :attr:`_orm.Mapper.all_orm_descriptors`, and we want to view the</span>
</span><span id="1-465"><span class="sd">        target class for this proxy as mapped by ``User``::</span>
</span><span id="1-466">
</span><span id="1-467"><span class="sd">            inspect(User).all_orm_descriptors[&quot;keywords&quot;].for_class(User).target_class</span>
</span><span id="1-468">
</span><span id="1-469"><span class="sd">        This returns an instance of :class:`.AssociationProxyInstance` that</span>
</span><span id="1-470"><span class="sd">        is specific to the ``User`` class.   The :class:`.AssociationProxy`</span>
</span><span id="1-471"><span class="sd">        object remains agnostic of its parent class.</span>
</span><span id="1-472">
</span><span id="1-473"><span class="sd">        :param class\_: the class that we are returning state for.</span>
</span><span id="1-474">
</span><span id="1-475"><span class="sd">        :param obj: optional, an instance of the class that is required</span>
</span><span id="1-476"><span class="sd">         if the attribute refers to a polymorphic target, e.g. where we have</span>
</span><span id="1-477"><span class="sd">         to look at the type of the actual destination object to get the</span>
</span><span id="1-478"><span class="sd">         complete path.</span>
</span><span id="1-479">
</span><span id="1-480"><span class="sd">        .. versionadded:: 1.3 - :class:`.AssociationProxy` no longer stores</span>
</span><span id="1-481"><span class="sd">           any state specific to a particular parent class; the state is now</span>
</span><span id="1-482"><span class="sd">           stored in per-class :class:`.AssociationProxyInstance` objects.</span>
</span><span id="1-483">
</span><span id="1-484">
</span><span id="1-485"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-486">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_instance</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
</span><span id="1-487">
</span><span id="1-488">    <span class="k">def</span><span class="w"> </span><span class="nf">_as_instance</span><span class="p">(</span>
</span><span id="1-489">        <span class="bp">self</span><span class="p">,</span> <span class="n">class_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-490">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-491">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-492">            <span class="n">inst</span> <span class="o">=</span> <span class="n">class_</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_inst&quot;</span><span class="p">]</span>
</span><span id="1-493">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="1-494">            <span class="n">inst</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-495">
</span><span id="1-496">        <span class="c1"># avoid exception context</span>
</span><span id="1-497">        <span class="k">if</span> <span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-498">            <span class="n">owner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_owner</span><span class="p">(</span><span class="n">class_</span><span class="p">)</span>
</span><span id="1-499">            <span class="k">if</span> <span class="n">owner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-500">                <span class="n">inst</span> <span class="o">=</span> <span class="n">AssociationProxyInstance</span><span class="o">.</span><span class="n">for_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
</span><span id="1-501">                <span class="nb">setattr</span><span class="p">(</span><span class="n">class_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;_inst&quot;</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>
</span><span id="1-502">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-503">                <span class="n">inst</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-504">
</span><span id="1-505">        <span class="k">if</span> <span class="n">inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inst</span><span class="o">.</span><span class="n">_is_canonical</span><span class="p">:</span>
</span><span id="1-506">            <span class="c1"># the AssociationProxyInstance can&#39;t be generalized</span>
</span><span id="1-507">            <span class="c1"># since the proxied attribute is not on the targeted</span>
</span><span id="1-508">            <span class="c1"># class, only on subclasses of it, which might be</span>
</span><span id="1-509">            <span class="c1"># different.  only return for the specific</span>
</span><span id="1-510">            <span class="c1"># object&#39;s current value</span>
</span><span id="1-511">            <span class="k">return</span> <span class="n">inst</span><span class="o">.</span><span class="n">_non_canonical_get_for_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-512">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-513">            <span class="k">return</span> <span class="n">inst</span>  <span class="c1"># type: ignore  # TODO</span>
</span><span id="1-514">
</span><span id="1-515">    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_owner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_cls</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-516">        <span class="c1"># we might be getting invoked for a subclass</span>
</span><span id="1-517">        <span class="c1"># that is not mapped yet, in some declarative situations.</span>
</span><span id="1-518">        <span class="c1"># save until we are mapped</span>
</span><span id="1-519">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-520">            <span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">target_cls</span><span class="p">)</span>
</span><span id="1-521">        <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">NoInspectionAvailable</span><span class="p">:</span>
</span><span id="1-522">            <span class="c1"># can&#39;t find a mapper, don&#39;t set owner. if we are a not-yet-mapped</span>
</span><span id="1-523">            <span class="c1"># subclass, we can also scan through __mro__ to find a mapped</span>
</span><span id="1-524">            <span class="c1"># class, but instead just wait for us to be called again against a</span>
</span><span id="1-525">            <span class="c1"># mapped class normally.</span>
</span><span id="1-526">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-527">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-528">            <span class="k">return</span> <span class="n">insp</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">class_manager</span><span class="o">.</span><span class="n">class_</span>
</span><span id="1-529">
</span><span id="1-530">    <span class="k">def</span><span class="w"> </span><span class="nf">_default_getset</span><span class="p">(</span>
</span><span id="1-531">        <span class="bp">self</span><span class="p">,</span> <span class="n">collection_class</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-532">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_GetterProtocol</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">_SetterProtocol</span><span class="p">]:</span>
</span><span id="1-533">        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span>
</span><span id="1-534">        <span class="n">_getter</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span><span id="1-535">
</span><span id="1-536">        <span class="k">def</span><span class="w"> </span><span class="nf">getter</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-537">            <span class="k">return</span> <span class="n">_getter</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="1-538">
</span><span id="1-539">        <span class="k">if</span> <span class="n">collection_class</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="1-540">
</span><span id="1-541">            <span class="k">def</span><span class="w"> </span><span class="nf">dict_setter</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-542">                <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="1-543">
</span><span id="1-544">            <span class="k">return</span> <span class="n">getter</span><span class="p">,</span> <span class="n">dict_setter</span>
</span><span id="1-545">
</span><span id="1-546">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-547">
</span><span id="1-548">            <span class="k">def</span><span class="w"> </span><span class="nf">plain_setter</span><span class="p">(</span><span class="n">o</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-549">                <span class="nb">setattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="1-550">
</span><span id="1-551">            <span class="k">return</span> <span class="n">getter</span><span class="p">,</span> <span class="n">plain_setter</span>
</span><span id="1-552">
</span><span id="1-553">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-554">        <span class="k">return</span> <span class="s2">&quot;AssociationProxy(</span><span class="si">%r</span><span class="s2">, </span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-555">            <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">,</span>
</span><span id="1-556">            <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">,</span>
</span><span id="1-557">        <span class="p">)</span>
</span><span id="1-558">
</span><span id="1-559">
</span><span id="1-560"><span class="c1"># the pep-673 Self type does not work in Mypy for a &quot;hybrid&quot;</span>
</span><span id="1-561"><span class="c1"># style method that returns type or Self, so for one specific case</span>
</span><span id="1-562"><span class="c1"># we still need to use the pre-pep-673 workaround.</span>
</span><span id="1-563"><span class="n">_Self</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_Self&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;AssociationProxyInstance[Any]&quot;</span><span class="p">)</span>
</span><span id="1-564">
</span><span id="1-565">
</span><span id="1-566"><span class="k">class</span><span class="w"> </span><span class="nc">AssociationProxyInstance</span><span class="p">(</span><span class="n">SQLORMOperations</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-567"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A per-class object that serves class- and object-specific results.</span>
</span><span id="1-568">
</span><span id="1-569"><span class="sd">    This is used by :class:`.AssociationProxy` when it is invoked</span>
</span><span id="1-570"><span class="sd">    in terms of a specific class or instance of a class, i.e. when it is</span>
</span><span id="1-571"><span class="sd">    used as a regular Python descriptor.</span>
</span><span id="1-572">
</span><span id="1-573"><span class="sd">    When referring to the :class:`.AssociationProxy` as a normal Python</span>
</span><span id="1-574"><span class="sd">    descriptor, the :class:`.AssociationProxyInstance` is the object that</span>
</span><span id="1-575"><span class="sd">    actually serves the information.   Under normal circumstances, its presence</span>
</span><span id="1-576"><span class="sd">    is transparent::</span>
</span><span id="1-577">
</span><span id="1-578"><span class="sd">        &gt;&gt;&gt; User.keywords.scalar</span>
</span><span id="1-579"><span class="sd">        False</span>
</span><span id="1-580">
</span><span id="1-581"><span class="sd">    In the special case that the :class:`.AssociationProxy` object is being</span>
</span><span id="1-582"><span class="sd">    accessed directly, in order to get an explicit handle to the</span>
</span><span id="1-583"><span class="sd">    :class:`.AssociationProxyInstance`, use the</span>
</span><span id="1-584"><span class="sd">    :meth:`.AssociationProxy.for_class` method::</span>
</span><span id="1-585">
</span><span id="1-586"><span class="sd">        proxy_state = inspect(User).all_orm_descriptors[&quot;keywords&quot;].for_class(User)</span>
</span><span id="1-587">
</span><span id="1-588"><span class="sd">        # view if proxy object is scalar or not</span>
</span><span id="1-589"><span class="sd">        &gt;&gt;&gt; proxy_state.scalar</span>
</span><span id="1-590"><span class="sd">        False</span>
</span><span id="1-591">
</span><span id="1-592"><span class="sd">    .. versionadded:: 1.3</span>
</span><span id="1-593">
</span><span id="1-594"><span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
</span><span id="1-595">
</span><span id="1-596">    <span class="n">collection_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span id="1-597">    <span class="n">parent</span><span class="p">:</span> <span class="n">_AssociationProxyProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span><span id="1-598">
</span><span id="1-599">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-600">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-601">        <span class="n">parent</span><span class="p">:</span> <span class="n">_AssociationProxyProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span>
</span><span id="1-602">        <span class="n">owning_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-603">        <span class="n">target_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-604">        <span class="n">value_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-605">    <span class="p">):</span>
</span><span id="1-606">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-607">        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">key</span>
</span><span id="1-608">        <span class="bp">self</span><span class="o">.</span><span class="n">owning_class</span> <span class="o">=</span> <span class="n">owning_class</span>
</span><span id="1-609">        <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">target_collection</span>
</span><span id="1-610">        <span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-611">        <span class="bp">self</span><span class="o">.</span><span class="n">target_class</span> <span class="o">=</span> <span class="n">target_class</span>
</span><span id="1-612">        <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span> <span class="o">=</span> <span class="n">value_attr</span>
</span><span id="1-613">
</span><span id="1-614">    <span class="n">target_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span id="1-615"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The intermediary class handled by this</span>
</span><span id="1-616"><span class="sd">    :class:`.AssociationProxyInstance`.</span>
</span><span id="1-617">
</span><span id="1-618"><span class="sd">    Intercepted append/set/assignment events will result</span>
</span><span id="1-619"><span class="sd">    in the generation of new instances of this class.</span>
</span><span id="1-620">
</span><span id="1-621"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-622">
</span><span id="1-623">    <span class="nd">@classmethod</span>
</span><span id="1-624">    <span class="k">def</span><span class="w"> </span><span class="nf">for_proxy</span><span class="p">(</span>
</span><span id="1-625">        <span class="bp">cls</span><span class="p">,</span>
</span><span id="1-626">        <span class="n">parent</span><span class="p">:</span> <span class="n">AssociationProxy</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span>
</span><span id="1-627">        <span class="n">owning_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-628">        <span class="n">parent_instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-629">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-630">        <span class="n">target_collection</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">target_collection</span>
</span><span id="1-631">        <span class="n">value_attr</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">value_attr</span>
</span><span id="1-632">        <span class="n">prop</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="1-633">            <span class="s2">&quot;orm.RelationshipProperty[_T]&quot;</span><span class="p">,</span>
</span><span id="1-634">            <span class="n">orm</span><span class="o">.</span><span class="n">class_mapper</span><span class="p">(</span><span class="n">owning_class</span><span class="p">)</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="n">target_collection</span><span class="p">),</span>
</span><span id="1-635">        <span class="p">)</span>
</span><span id="1-636">
</span><span id="1-637">        <span class="c1"># this was never asserted before but this should be made clear.</span>
</span><span id="1-638">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">RelationshipProperty</span><span class="p">):</span>
</span><span id="1-639">            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="1-640">                <span class="s2">&quot;association proxy to a non-relationship &quot;</span>
</span><span id="1-641">                <span class="s2">&quot;intermediary is not supported&quot;</span>
</span><span id="1-642">            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
</span><span id="1-643">
</span><span id="1-644">        <span class="n">target_class</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">class_</span>
</span><span id="1-645">
</span><span id="1-646">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-647">            <span class="n">target_assoc</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="1-648">                <span class="s2">&quot;AssociationProxyInstance[_T]&quot;</span><span class="p">,</span>
</span><span id="1-649">                <span class="bp">cls</span><span class="o">.</span><span class="n">_cls_unwrap_target_assoc_proxy</span><span class="p">(</span><span class="n">target_class</span><span class="p">,</span> <span class="n">value_attr</span><span class="p">),</span>
</span><span id="1-650">            <span class="p">)</span>
</span><span id="1-651">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="1-652">            <span class="c1"># the proxied attribute doesn&#39;t exist on the target class;</span>
</span><span id="1-653">            <span class="c1"># return an &quot;ambiguous&quot; instance that will work on a per-object</span>
</span><span id="1-654">            <span class="c1"># basis</span>
</span><span id="1-655">            <span class="k">return</span> <span class="n">AmbiguousAssociationProxyInstance</span><span class="p">(</span>
</span><span id="1-656">                <span class="n">parent</span><span class="p">,</span> <span class="n">owning_class</span><span class="p">,</span> <span class="n">target_class</span><span class="p">,</span> <span class="n">value_attr</span>
</span><span id="1-657">            <span class="p">)</span>
</span><span id="1-658">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="1-659">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-660">                <span class="sa">f</span><span class="s2">&quot;Association proxy received an unexpected error when &quot;</span>
</span><span id="1-661">                <span class="sa">f</span><span class="s2">&quot;trying to retreive attribute &quot;</span>
</span><span id="1-662">                <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">target_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">parent</span><span class="o">.</span><span class="n">value_attr</span><span class="si">}</span><span class="s1">&quot; from &#39;</span>
</span><span id="1-663">                <span class="sa">f</span><span class="s1">&#39;class &quot;</span><span class="si">{</span><span class="n">target_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="1-664">            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
</span><span id="1-665">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-666">            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_construct_for_assoc</span><span class="p">(</span>
</span><span id="1-667">                <span class="n">target_assoc</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">owning_class</span><span class="p">,</span> <span class="n">target_class</span><span class="p">,</span> <span class="n">value_attr</span>
</span><span id="1-668">            <span class="p">)</span>
</span><span id="1-669">
</span><span id="1-670">    <span class="nd">@classmethod</span>
</span><span id="1-671">    <span class="k">def</span><span class="w"> </span><span class="nf">_construct_for_assoc</span><span class="p">(</span>
</span><span id="1-672">        <span class="bp">cls</span><span class="p">,</span>
</span><span id="1-673">        <span class="n">target_assoc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]],</span>
</span><span id="1-674">        <span class="n">parent</span><span class="p">:</span> <span class="n">_AssociationProxyProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span>
</span><span id="1-675">        <span class="n">owning_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-676">        <span class="n">target_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-677">        <span class="n">value_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="1-678">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-679">        <span class="k">if</span> <span class="n">target_assoc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-680">            <span class="k">return</span> <span class="n">ObjectAssociationProxyInstance</span><span class="p">(</span>
</span><span id="1-681">                <span class="n">parent</span><span class="p">,</span> <span class="n">owning_class</span><span class="p">,</span> <span class="n">target_class</span><span class="p">,</span> <span class="n">value_attr</span>
</span><span id="1-682">            <span class="p">)</span>
</span><span id="1-683">
</span><span id="1-684">        <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">target_class</span><span class="p">,</span> <span class="n">value_attr</span><span class="p">)</span>
</span><span id="1-685">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="s2">&quot;_is_internal_proxy&quot;</span><span class="p">):</span>
</span><span id="1-686">            <span class="k">return</span> <span class="n">AmbiguousAssociationProxyInstance</span><span class="p">(</span>
</span><span id="1-687">                <span class="n">parent</span><span class="p">,</span> <span class="n">owning_class</span><span class="p">,</span> <span class="n">target_class</span><span class="p">,</span> <span class="n">value_attr</span>
</span><span id="1-688">            <span class="p">)</span>
</span><span id="1-689">        <span class="n">is_object</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">_impl_uses_objects</span>
</span><span id="1-690">        <span class="k">if</span> <span class="n">is_object</span><span class="p">:</span>
</span><span id="1-691">            <span class="k">return</span> <span class="n">ObjectAssociationProxyInstance</span><span class="p">(</span>
</span><span id="1-692">                <span class="n">parent</span><span class="p">,</span> <span class="n">owning_class</span><span class="p">,</span> <span class="n">target_class</span><span class="p">,</span> <span class="n">value_attr</span>
</span><span id="1-693">            <span class="p">)</span>
</span><span id="1-694">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-695">            <span class="k">return</span> <span class="n">ColumnAssociationProxyInstance</span><span class="p">(</span>
</span><span id="1-696">                <span class="n">parent</span><span class="p">,</span> <span class="n">owning_class</span><span class="p">,</span> <span class="n">target_class</span><span class="p">,</span> <span class="n">value_attr</span>
</span><span id="1-697">            <span class="p">)</span>
</span><span id="1-698">
</span><span id="1-699">    <span class="k">def</span><span class="w"> </span><span class="nf">_get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MapperProperty</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-700">        <span class="k">return</span> <span class="n">orm</span><span class="o">.</span><span class="n">class_mapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">owning_class</span><span class="p">)</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span>
</span><span id="1-701">            <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span>
</span><span id="1-702">        <span class="p">)</span>
</span><span id="1-703">
</span><span id="1-704">    <span class="nd">@property</span>
</span><span id="1-705">    <span class="k">def</span><span class="w"> </span><span class="nf">_comparator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PropComparator</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-706">        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="1-707">            <span class="bp">self</span><span class="o">.</span><span class="n">owning_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span>
</span><span id="1-708">        <span class="p">)</span><span class="o">.</span><span class="n">comparator</span>
</span><span id="1-709">
</span><span id="1-710">    <span class="k">def</span><span class="w"> </span><span class="nf">__clause_element__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-711">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="1-712">            <span class="s2">&quot;The association proxy can&#39;t be used as a plain column &quot;</span>
</span><span id="1-713">            <span class="s2">&quot;expression; it only works inside of a comparison expression&quot;</span>
</span><span id="1-714">        <span class="p">)</span>
</span><span id="1-715">
</span><span id="1-716">    <span class="nd">@classmethod</span>
</span><span id="1-717">    <span class="k">def</span><span class="w"> </span><span class="nf">_cls_unwrap_target_assoc_proxy</span><span class="p">(</span>
</span><span id="1-718">        <span class="bp">cls</span><span class="p">,</span> <span class="n">target_class</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value_attr</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-719">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span id="1-720">        <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">target_class</span><span class="p">,</span> <span class="n">value_attr</span><span class="p">)</span>
</span><span id="1-721">        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">AssociationProxy</span><span class="p">)</span>
</span><span id="1-722">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">AssociationProxyInstance</span><span class="p">):</span>
</span><span id="1-723">            <span class="k">return</span> <span class="n">attr</span>
</span><span id="1-724">        <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-725">
</span><span id="1-726">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span id="1-727">    <span class="k">def</span><span class="w"> </span><span class="nf">_unwrap_target_assoc_proxy</span><span class="p">(</span>
</span><span id="1-728">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-729">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span id="1-730">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cls_unwrap_target_assoc_proxy</span><span class="p">(</span>
</span><span id="1-731">            <span class="bp">self</span><span class="o">.</span><span class="n">target_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span>
</span><span id="1-732">        <span class="p">)</span>
</span><span id="1-733">
</span><span id="1-734">    <span class="nd">@property</span>
</span><span id="1-735">    <span class="k">def</span><span class="w"> </span><span class="nf">remote_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SQLORMOperations</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-736"><span class="w">        </span><span class="sd">&quot;&quot;&quot;The &#39;remote&#39; class attribute referenced by this</span>
</span><span id="1-737"><span class="sd">        :class:`.AssociationProxyInstance`.</span>
</span><span id="1-738">
</span><span id="1-739"><span class="sd">        .. seealso::</span>
</span><span id="1-740">
</span><span id="1-741"><span class="sd">            :attr:`.AssociationProxyInstance.attr`</span>
</span><span id="1-742">
</span><span id="1-743"><span class="sd">            :attr:`.AssociationProxyInstance.local_attr`</span>
</span><span id="1-744">
</span><span id="1-745"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-746">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="1-747">            <span class="s2">&quot;SQLORMOperations[_T]&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">)</span>
</span><span id="1-748">        <span class="p">)</span>
</span><span id="1-749">
</span><span id="1-750">    <span class="nd">@property</span>
</span><span id="1-751">    <span class="k">def</span><span class="w"> </span><span class="nf">local_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SQLORMOperations</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-752"><span class="w">        </span><span class="sd">&quot;&quot;&quot;The &#39;local&#39; class attribute referenced by this</span>
</span><span id="1-753"><span class="sd">        :class:`.AssociationProxyInstance`.</span>
</span><span id="1-754">
</span><span id="1-755"><span class="sd">        .. seealso::</span>
</span><span id="1-756">
</span><span id="1-757"><span class="sd">            :attr:`.AssociationProxyInstance.attr`</span>
</span><span id="1-758">
</span><span id="1-759"><span class="sd">            :attr:`.AssociationProxyInstance.remote_attr`</span>
</span><span id="1-760">
</span><span id="1-761"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-762">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="1-763">            <span class="s2">&quot;SQLORMOperations[Any]&quot;</span><span class="p">,</span>
</span><span id="1-764">            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">owning_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">),</span>
</span><span id="1-765">        <span class="p">)</span>
</span><span id="1-766">
</span><span id="1-767">    <span class="nd">@property</span>
</span><span id="1-768">    <span class="k">def</span><span class="w"> </span><span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">SQLORMOperations</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">SQLORMOperations</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span id="1-769"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a tuple of ``(local_attr, remote_attr)``.</span>
</span><span id="1-770">
</span><span id="1-771"><span class="sd">        This attribute was originally intended to facilitate using the</span>
</span><span id="1-772"><span class="sd">        :meth:`_query.Query.join` method to join across the two relationships</span>
</span><span id="1-773"><span class="sd">        at once, however this makes use of a deprecated calling style.</span>
</span><span id="1-774">
</span><span id="1-775"><span class="sd">        To use :meth:`_sql.select.join` or :meth:`_orm.Query.join` with</span>
</span><span id="1-776"><span class="sd">        an association proxy, the current method is to make use of the</span>
</span><span id="1-777"><span class="sd">        :attr:`.AssociationProxyInstance.local_attr` and</span>
</span><span id="1-778"><span class="sd">        :attr:`.AssociationProxyInstance.remote_attr` attributes separately::</span>
</span><span id="1-779">
</span><span id="1-780"><span class="sd">            stmt = (</span>
</span><span id="1-781"><span class="sd">                select(Parent)</span>
</span><span id="1-782"><span class="sd">                .join(Parent.proxied.local_attr)</span>
</span><span id="1-783"><span class="sd">                .join(Parent.proxied.remote_attr)</span>
</span><span id="1-784"><span class="sd">            )</span>
</span><span id="1-785">
</span><span id="1-786"><span class="sd">        A future release may seek to provide a more succinct join pattern</span>
</span><span id="1-787"><span class="sd">        for association proxy attributes.</span>
</span><span id="1-788">
</span><span id="1-789"><span class="sd">        .. seealso::</span>
</span><span id="1-790">
</span><span id="1-791"><span class="sd">            :attr:`.AssociationProxyInstance.local_attr`</span>
</span><span id="1-792">
</span><span id="1-793"><span class="sd">            :attr:`.AssociationProxyInstance.remote_attr`</span>
</span><span id="1-794">
</span><span id="1-795"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-796">        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_attr</span><span class="p">)</span>
</span><span id="1-797">
</span><span id="1-798">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span id="1-799">    <span class="k">def</span><span class="w"> </span><span class="nf">scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-800"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return ``True`` if this :class:`.AssociationProxyInstance`</span>
</span><span id="1-801"><span class="sd">        proxies a scalar relationship on the local side.&quot;&quot;&quot;</span>
</span><span id="1-802">
</span><span id="1-803">        <span class="n">scalar</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_property</span><span class="p">()</span><span class="o">.</span><span class="n">uselist</span>
</span><span id="1-804">        <span class="k">if</span> <span class="n">scalar</span><span class="p">:</span>
</span><span id="1-805">            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_scalar_accessors</span><span class="p">()</span>
</span><span id="1-806">        <span class="k">return</span> <span class="n">scalar</span>
</span><span id="1-807">
</span><span id="1-808">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span id="1-809">    <span class="k">def</span><span class="w"> </span><span class="nf">_value_is_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-810">        <span class="k">return</span> <span class="p">(</span>
</span><span id="1-811">            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_property</span><span class="p">()</span>
</span><span id="1-812">            <span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">)</span>
</span><span id="1-813">            <span class="o">.</span><span class="n">uselist</span>
</span><span id="1-814">        <span class="p">)</span>
</span><span id="1-815">
</span><span id="1-816">    <span class="nd">@property</span>
</span><span id="1-817">    <span class="k">def</span><span class="w"> </span><span class="nf">_target_is_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-818">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-819">
</span><span id="1-820">    <span class="n">_scalar_get</span><span class="p">:</span> <span class="n">_GetterProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span><span id="1-821">    <span class="n">_scalar_set</span><span class="p">:</span> <span class="n">_PlainSetterProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span><span id="1-822">
</span><span id="1-823">    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_scalar_accessors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-824">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getset_factory</span><span class="p">:</span>
</span><span id="1-825">            <span class="n">get</span><span class="p">,</span> <span class="n">set_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getset_factory</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="1-826">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-827">            <span class="n">get</span><span class="p">,</span> <span class="n">set_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_default_getset</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="1-828">        <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_get</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_set</span> <span class="o">=</span> <span class="n">get</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="1-829">            <span class="s2">&quot;_PlainSetterProtocol[_T]&quot;</span><span class="p">,</span> <span class="n">set_</span>
</span><span id="1-830">        <span class="p">)</span>
</span><span id="1-831">
</span><span id="1-832">    <span class="k">def</span><span class="w"> </span><span class="nf">_default_getset</span><span class="p">(</span>
</span><span id="1-833">        <span class="bp">self</span><span class="p">,</span> <span class="n">collection_class</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-834">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_GetterProtocol</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">_SetterProtocol</span><span class="p">]:</span>
</span><span id="1-835">        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span>
</span><span id="1-836">        <span class="n">_getter</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span><span id="1-837">
</span><span id="1-838">        <span class="k">def</span><span class="w"> </span><span class="nf">getter</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-839">            <span class="k">return</span> <span class="n">_getter</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="1-840">
</span><span id="1-841">        <span class="k">if</span> <span class="n">collection_class</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="1-842">
</span><span id="1-843">            <span class="k">def</span><span class="w"> </span><span class="nf">dict_setter</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-844">                <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="1-845">
</span><span id="1-846">            <span class="k">return</span> <span class="n">getter</span><span class="p">,</span> <span class="n">dict_setter</span>
</span><span id="1-847">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-848">
</span><span id="1-849">            <span class="k">def</span><span class="w"> </span><span class="nf">plain_setter</span><span class="p">(</span><span class="n">o</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-850">                <span class="nb">setattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="1-851">
</span><span id="1-852">            <span class="k">return</span> <span class="n">getter</span><span class="p">,</span> <span class="n">plain_setter</span>
</span><span id="1-853">
</span><span id="1-854">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span id="1-855">    <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_InfoType</span><span class="p">:</span>
</span><span id="1-856">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">info</span>
</span><span id="1-857">
</span><span id="1-858">    <span class="nd">@overload</span>
</span><span id="1-859">    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">_Self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_Self</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-860">
</span><span id="1-861">    <span class="nd">@overload</span>
</span><span id="1-862">    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-863">
</span><span id="1-864">    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
</span><span id="1-865">        <span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-866">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span id="1-867">        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-868">            <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-869">
</span><span id="1-870">        <span class="n">proxy</span><span class="p">:</span> <span class="n">_T</span>
</span><span id="1-871">
</span><span id="1-872">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span><span class="p">:</span>
</span><span id="1-873">            <span class="n">target</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">)</span>
</span><span id="1-874">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_get</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="1-875">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-876">            <span class="k">try</span><span class="p">:</span>
</span><span id="1-877">                <span class="c1"># If the owning instance is reborn (orm session resurrect,</span>
</span><span id="1-878">                <span class="c1"># etc.), refresh the proxy cache.</span>
</span><span id="1-879">                <span class="n">creator_id</span><span class="p">,</span> <span class="n">self_id</span><span class="p">,</span> <span class="n">proxy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="1-880">                    <span class="s2">&quot;Tuple[int, int, _T]&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span id="1-881">                <span class="p">)</span>
</span><span id="1-882">            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="1-883">                <span class="k">pass</span>
</span><span id="1-884">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-885">                <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="n">creator_id</span> <span class="ow">and</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="n">self_id</span><span class="p">:</span>
</span><span id="1-886">                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-887">                    <span class="k">return</span> <span class="n">proxy</span>
</span><span id="1-888">
</span><span id="1-889">            <span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span><span class="p">,</span> <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new</span><span class="p">(</span>
</span><span id="1-890">                <span class="n">_lazy_collection</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">)</span>
</span><span id="1-891">            <span class="p">)</span>
</span><span id="1-892">            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">proxy</span><span class="p">))</span>
</span><span id="1-893">            <span class="k">return</span> <span class="n">proxy</span>
</span><span id="1-894">
</span><span id="1-895">    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-896">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span><span class="p">:</span>
</span><span id="1-897">            <span class="n">creator</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="1-898">                <span class="s2">&quot;_PlainCreatorProtocol[_T]&quot;</span><span class="p">,</span>
</span><span id="1-899">                <span class="p">(</span>
</span><span id="1-900">                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">creator</span>
</span><span id="1-901">                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">creator</span>
</span><span id="1-902">                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_class</span>
</span><span id="1-903">                <span class="p">),</span>
</span><span id="1-904">            <span class="p">)</span>
</span><span id="1-905">            <span class="n">target</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">)</span>
</span><span id="1-906">            <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-907">                <span class="k">if</span> <span class="p">(</span>
</span><span id="1-908">                    <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="1-909">                    <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">create_on_none_assignment</span>
</span><span id="1-910">                <span class="p">):</span>
</span><span id="1-911">                    <span class="k">return</span>
</span><span id="1-912">                <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">,</span> <span class="n">creator</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
</span><span id="1-913">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-914">                <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_set</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="1-915">                <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">cascade_scalar_deletes</span><span class="p">:</span>
</span><span id="1-916">                    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-917">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-918">            <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="1-919">            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-920">            <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
</span><span id="1-921">                <span class="n">proxy</span><span class="o">.</span><span class="n">_bulk_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="1-922">
</span><span id="1-923">    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-924">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">owning_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-925">            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_owner</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-926">
</span><span id="1-927">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span><span class="p">:</span>
</span><span id="1-928">            <span class="n">target</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">)</span>
</span><span id="1-929">            <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-930">                <span class="nb">delattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">)</span>
</span><span id="1-931">        <span class="nb">delattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">)</span>
</span><span id="1-932">
</span><span id="1-933">    <span class="k">def</span><span class="w"> </span><span class="nf">_new</span><span class="p">(</span>
</span><span id="1-934">        <span class="bp">self</span><span class="p">,</span> <span class="n">lazy_collection</span><span class="p">:</span> <span class="n">_LazyCollectionProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span><span id="1-935">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">_T</span><span class="p">]:</span>
</span><span id="1-936">        <span class="n">creator</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-937">            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">creator</span>
</span><span id="1-938">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">creator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-939">            <span class="k">else</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;_CreatorProtocol&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_class</span><span class="p">)</span>
</span><span id="1-940">        <span class="p">)</span>
</span><span id="1-941">        <span class="n">collection_class</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">duck_type_collection</span><span class="p">(</span><span class="n">lazy_collection</span><span class="p">())</span>
</span><span id="1-942">
</span><span id="1-943">        <span class="k">if</span> <span class="n">collection_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-944">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-945">                <span class="sa">f</span><span class="s2">&quot;lazy collection factory did not return a &quot;</span>
</span><span id="1-946">                <span class="sa">f</span><span class="s2">&quot;valid collection type, got </span><span class="si">{</span><span class="n">collection_class</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="1-947">            <span class="p">)</span>
</span><span id="1-948">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">proxy_factory</span><span class="p">:</span>
</span><span id="1-949">            <span class="k">return</span> <span class="p">(</span>
</span><span id="1-950">                <span class="n">collection_class</span><span class="p">,</span>
</span><span id="1-951">                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">proxy_factory</span><span class="p">(</span>
</span><span id="1-952">                    <span class="n">lazy_collection</span><span class="p">,</span> <span class="n">creator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">,</span> <span class="bp">self</span>
</span><span id="1-953">                <span class="p">),</span>
</span><span id="1-954">            <span class="p">)</span>
</span><span id="1-955">
</span><span id="1-956">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getset_factory</span><span class="p">:</span>
</span><span id="1-957">            <span class="n">getter</span><span class="p">,</span> <span class="n">setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getset_factory</span><span class="p">(</span><span class="n">collection_class</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="1-958">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-959">            <span class="n">getter</span><span class="p">,</span> <span class="n">setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_default_getset</span><span class="p">(</span><span class="n">collection_class</span><span class="p">)</span>
</span><span id="1-960">
</span><span id="1-961">        <span class="k">if</span> <span class="n">collection_class</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="1-962">            <span class="k">return</span> <span class="p">(</span>
</span><span id="1-963">                <span class="n">collection_class</span><span class="p">,</span>
</span><span id="1-964">                <span class="n">cast</span><span class="p">(</span>
</span><span id="1-965">                    <span class="n">_T</span><span class="p">,</span>
</span><span id="1-966">                    <span class="n">_AssociationList</span><span class="p">(</span>
</span><span id="1-967">                        <span class="n">lazy_collection</span><span class="p">,</span> <span class="n">creator</span><span class="p">,</span> <span class="n">getter</span><span class="p">,</span> <span class="n">setter</span><span class="p">,</span> <span class="bp">self</span>
</span><span id="1-968">                    <span class="p">),</span>
</span><span id="1-969">                <span class="p">),</span>
</span><span id="1-970">            <span class="p">)</span>
</span><span id="1-971">        <span class="k">elif</span> <span class="n">collection_class</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="1-972">            <span class="k">return</span> <span class="p">(</span>
</span><span id="1-973">                <span class="n">collection_class</span><span class="p">,</span>
</span><span id="1-974">                <span class="n">cast</span><span class="p">(</span>
</span><span id="1-975">                    <span class="n">_T</span><span class="p">,</span>
</span><span id="1-976">                    <span class="n">_AssociationDict</span><span class="p">(</span>
</span><span id="1-977">                        <span class="n">lazy_collection</span><span class="p">,</span> <span class="n">creator</span><span class="p">,</span> <span class="n">getter</span><span class="p">,</span> <span class="n">setter</span><span class="p">,</span> <span class="bp">self</span>
</span><span id="1-978">                    <span class="p">),</span>
</span><span id="1-979">                <span class="p">),</span>
</span><span id="1-980">            <span class="p">)</span>
</span><span id="1-981">        <span class="k">elif</span> <span class="n">collection_class</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">:</span>
</span><span id="1-982">            <span class="k">return</span> <span class="p">(</span>
</span><span id="1-983">                <span class="n">collection_class</span><span class="p">,</span>
</span><span id="1-984">                <span class="n">cast</span><span class="p">(</span>
</span><span id="1-985">                    <span class="n">_T</span><span class="p">,</span>
</span><span id="1-986">                    <span class="n">_AssociationSet</span><span class="p">(</span>
</span><span id="1-987">                        <span class="n">lazy_collection</span><span class="p">,</span> <span class="n">creator</span><span class="p">,</span> <span class="n">getter</span><span class="p">,</span> <span class="n">setter</span><span class="p">,</span> <span class="bp">self</span>
</span><span id="1-988">                    <span class="p">),</span>
</span><span id="1-989">                <span class="p">),</span>
</span><span id="1-990">            <span class="p">)</span>
</span><span id="1-991">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-992">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-993">                <span class="s2">&quot;could not guess which interface to use for &quot;</span>
</span><span id="1-994">                <span class="s1">&#39;collection_class &quot;</span><span class="si">%s</span><span class="s1">&quot; backing &quot;</span><span class="si">%s</span><span class="s1">&quot;; specify a &#39;</span>
</span><span id="1-995">                <span class="s2">&quot;proxy_factory and proxy_bulk_set manually&quot;</span>
</span><span id="1-996">                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">)</span>
</span><span id="1-997">            <span class="p">)</span>
</span><span id="1-998">
</span><span id="1-999">    <span class="k">def</span><span class="w"> </span><span class="nf">_set</span><span class="p">(</span>
</span><span id="1-1000">        <span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">:</span> <span class="n">_AssociationCollection</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span id="1-1001">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1002">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">proxy_bulk_set</span><span class="p">:</span>
</span><span id="1-1003">            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">proxy_bulk_set</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="1-1004">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="1-1005">            <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;_AssociationList[Any]&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="1-1006">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="1-1007">            <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;_AssociationDict[Any, Any]&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="1-1008">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">:</span>
</span><span id="1-1009">            <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;_AssociationSet[Any]&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="1-1010">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1011">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-1012">                <span class="s2">&quot;no proxy_bulk_set supplied for custom &quot;</span>
</span><span id="1-1013">                <span class="s2">&quot;collection_class implementation&quot;</span>
</span><span id="1-1014">            <span class="p">)</span>
</span><span id="1-1015">
</span><span id="1-1016">    <span class="k">def</span><span class="w"> </span><span class="nf">_inflate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">:</span> <span class="n">_AssociationCollection</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1017">        <span class="n">creator</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-1018">            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">creator</span>
</span><span id="1-1019">            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">creator</span>
</span><span id="1-1020">            <span class="ow">or</span> <span class="n">cast</span><span class="p">(</span><span class="n">_CreatorProtocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_class</span><span class="p">)</span>
</span><span id="1-1021">        <span class="p">)</span>
</span><span id="1-1022">
</span><span id="1-1023">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getset_factory</span><span class="p">:</span>
</span><span id="1-1024">            <span class="n">getter</span><span class="p">,</span> <span class="n">setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getset_factory</span><span class="p">(</span>
</span><span id="1-1025">                <span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span><span class="p">,</span> <span class="bp">self</span>
</span><span id="1-1026">            <span class="p">)</span>
</span><span id="1-1027">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1028">            <span class="n">getter</span><span class="p">,</span> <span class="n">setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_default_getset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection_class</span><span class="p">)</span>
</span><span id="1-1029">
</span><span id="1-1030">        <span class="n">proxy</span><span class="o">.</span><span class="n">creator</span> <span class="o">=</span> <span class="n">creator</span>
</span><span id="1-1031">        <span class="n">proxy</span><span class="o">.</span><span class="n">getter</span> <span class="o">=</span> <span class="n">getter</span>
</span><span id="1-1032">        <span class="n">proxy</span><span class="o">.</span><span class="n">setter</span> <span class="o">=</span> <span class="n">setter</span>
</span><span id="1-1033">
</span><span id="1-1034">    <span class="k">def</span><span class="w"> </span><span class="nf">_criterion_exists</span><span class="p">(</span>
</span><span id="1-1035">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1036">        <span class="n">criterion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ColumnExpressionArgument</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1037">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-1038">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-1039">        <span class="n">is_has</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;is_has&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-1040">
</span><span id="1-1041">        <span class="n">target_assoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unwrap_target_assoc_proxy</span>
</span><span id="1-1042">        <span class="k">if</span> <span class="n">target_assoc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1043">            <span class="n">inner</span> <span class="o">=</span> <span class="n">target_assoc</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span>
</span><span id="1-1044">                <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="1-1045">            <span class="p">)</span>
</span><span id="1-1046">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
</span><span id="1-1047">
</span><span id="1-1048">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_is_object</span><span class="p">:</span>
</span><span id="1-1049">            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">)</span>
</span><span id="1-1050">            <span class="n">value_expr</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">comparator</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span><span class="n">criterion</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-1051">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1052">            <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="1-1053">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-1054">                    <span class="s2">&quot;Can&#39;t apply keyword arguments to column-targeted &quot;</span>
</span><span id="1-1055">                    <span class="s2">&quot;association proxy; use ==&quot;</span>
</span><span id="1-1056">                <span class="p">)</span>
</span><span id="1-1057">            <span class="k">elif</span> <span class="n">is_has</span> <span class="ow">and</span> <span class="n">criterion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1058">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span id="1-1059">                    <span class="s2">&quot;Non-empty has() not allowed for &quot;</span>
</span><span id="1-1060">                    <span class="s2">&quot;column-targeted association proxy; use ==&quot;</span>
</span><span id="1-1061">                <span class="p">)</span>
</span><span id="1-1062">
</span><span id="1-1063">            <span class="n">value_expr</span> <span class="o">=</span> <span class="n">criterion</span>
</span><span id="1-1064">
</span><span id="1-1065">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span><span class="n">value_expr</span><span class="p">)</span>
</span><span id="1-1066">
</span><span id="1-1067">    <span class="k">def</span><span class="w"> </span><span class="nf">any</span><span class="p">(</span>
</span><span id="1-1068">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1069">        <span class="n">criterion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ColumnExpressionArgument</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1070">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-1071">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-1072"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce a proxied &#39;any&#39; expression using EXISTS.</span>
</span><span id="1-1073">
</span><span id="1-1074"><span class="sd">        This expression will be a composed product</span>
</span><span id="1-1075"><span class="sd">        using the :meth:`.Relationship.Comparator.any`</span>
</span><span id="1-1076"><span class="sd">        and/or :meth:`.Relationship.Comparator.has`</span>
</span><span id="1-1077"><span class="sd">        operators of the underlying proxied attributes.</span>
</span><span id="1-1078">
</span><span id="1-1079"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1080">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unwrap_target_assoc_proxy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="1-1081">            <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span>
</span><span id="1-1082">            <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_is_object</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_is_scalar</span><span class="p">)</span>
</span><span id="1-1083">        <span class="p">):</span>
</span><span id="1-1084">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-1085">                <span class="s2">&quot;&#39;any()&#39; not implemented for scalar attributes. Use has().&quot;</span>
</span><span id="1-1086">            <span class="p">)</span>
</span><span id="1-1087">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span>
</span><span id="1-1088">            <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span> <span class="n">is_has</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="1-1089">        <span class="p">)</span>
</span><span id="1-1090">
</span><span id="1-1091">    <span class="k">def</span><span class="w"> </span><span class="nf">has</span><span class="p">(</span>
</span><span id="1-1092">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1093">        <span class="n">criterion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ColumnExpressionArgument</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1094">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-1095">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-1096"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce a proxied &#39;has&#39; expression using EXISTS.</span>
</span><span id="1-1097">
</span><span id="1-1098"><span class="sd">        This expression will be a composed product</span>
</span><span id="1-1099"><span class="sd">        using the :meth:`.Relationship.Comparator.any`</span>
</span><span id="1-1100"><span class="sd">        and/or :meth:`.Relationship.Comparator.has`</span>
</span><span id="1-1101"><span class="sd">        operators of the underlying proxied attributes.</span>
</span><span id="1-1102">
</span><span id="1-1103"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1104">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unwrap_target_assoc_proxy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="1-1105">            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span>
</span><span id="1-1106">            <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_is_object</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_is_scalar</span><span class="p">)</span>
</span><span id="1-1107">        <span class="p">):</span>
</span><span id="1-1108">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-1109">                <span class="s2">&quot;&#39;has()&#39; not implemented for collections. Use any().&quot;</span>
</span><span id="1-1110">            <span class="p">)</span>
</span><span id="1-1111">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span>
</span><span id="1-1112">            <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span> <span class="n">is_has</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="1-1113">        <span class="p">)</span>
</span><span id="1-1114">
</span><span id="1-1115">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-1116">        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
</span><span id="1-1117">
</span><span id="1-1118">
</span><span id="1-1119"><span class="k">class</span><span class="w"> </span><span class="nc">AmbiguousAssociationProxyInstance</span><span class="p">(</span><span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-1120"><span class="w">    </span><span class="sd">&quot;&quot;&quot;an :class:`.AssociationProxyInstance` where we cannot determine</span>
</span><span id="1-1121"><span class="sd">    the type of target object.</span>
</span><span id="1-1122"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-1123">
</span><span id="1-1124">    <span class="n">_is_canonical</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-1125">
</span><span id="1-1126">    <span class="k">def</span><span class="w"> </span><span class="nf">_ambiguous</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-1127">        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="1-1128">            <span class="s2">&quot;Association proxy </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> refers to an attribute &#39;</span><span class="si">%s</span><span class="s2">&#39; that is not &quot;</span>
</span><span id="1-1129">            <span class="s2">&quot;directly mapped on class </span><span class="si">%s</span><span class="s2">; therefore this operation cannot &quot;</span>
</span><span id="1-1130">            <span class="s2">&quot;proceed since we don&#39;t know what type of object is referred &quot;</span>
</span><span id="1-1131">            <span class="s2">&quot;towards&quot;</span>
</span><span id="1-1132">            <span class="o">%</span> <span class="p">(</span>
</span><span id="1-1133">                <span class="bp">self</span><span class="o">.</span><span class="n">owning_class</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="1-1134">                <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">,</span>
</span><span id="1-1135">                <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">,</span>
</span><span id="1-1136">                <span class="bp">self</span><span class="o">.</span><span class="n">target_class</span><span class="p">,</span>
</span><span id="1-1137">            <span class="p">)</span>
</span><span id="1-1138">        <span class="p">)</span>
</span><span id="1-1139">
</span><span id="1-1140">    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-1141">        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1142">            <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-1143">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1144">            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="1-1145">
</span><span id="1-1146">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-1147">        <span class="bp">self</span><span class="o">.</span><span class="n">_ambiguous</span><span class="p">()</span>
</span><span id="1-1148">
</span><span id="1-1149">    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-1150">        <span class="bp">self</span><span class="o">.</span><span class="n">_ambiguous</span><span class="p">()</span>
</span><span id="1-1151">
</span><span id="1-1152">    <span class="k">def</span><span class="w"> </span><span class="nf">any</span><span class="p">(</span>
</span><span id="1-1153">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1154">        <span class="n">criterion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ColumnExpressionArgument</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1155">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-1156">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-1157">        <span class="bp">self</span><span class="o">.</span><span class="n">_ambiguous</span><span class="p">()</span>
</span><span id="1-1158">
</span><span id="1-1159">    <span class="k">def</span><span class="w"> </span><span class="nf">has</span><span class="p">(</span>
</span><span id="1-1160">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1161">        <span class="n">criterion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ColumnExpressionArgument</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1162">        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="1-1163">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-1164">        <span class="bp">self</span><span class="o">.</span><span class="n">_ambiguous</span><span class="p">()</span>
</span><span id="1-1165">
</span><span id="1-1166">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span id="1-1167">    <span class="k">def</span><span class="w"> </span><span class="nf">_lookup_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span id="1-1168">        <span class="c1"># mapping of &lt;subclass&gt;-&gt;AssociationProxyInstance.</span>
</span><span id="1-1169">        <span class="c1"># e.g. proxy is A-&gt; A.b -&gt; B -&gt; B.b_attr, but B.b_attr doesn&#39;t exist;</span>
</span><span id="1-1170">        <span class="c1"># only B1(B) and B2(B) have &quot;b_attr&quot;, keys in here would be B1, B2</span>
</span><span id="1-1171">        <span class="k">return</span> <span class="p">{}</span>
</span><span id="1-1172">
</span><span id="1-1173">    <span class="k">def</span><span class="w"> </span><span class="nf">_non_canonical_get_for_object</span><span class="p">(</span>
</span><span id="1-1174">        <span class="bp">self</span><span class="p">,</span> <span class="n">parent_instance</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-1175">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1176">        <span class="k">if</span> <span class="n">parent_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1177">            <span class="n">actual_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">parent_instance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span><span class="p">)</span>
</span><span id="1-1178">            <span class="k">if</span> <span class="n">actual_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1179">                <span class="k">try</span><span class="p">:</span>
</span><span id="1-1180">                    <span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">actual_obj</span><span class="p">)</span>
</span><span id="1-1181">                <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">NoInspectionAvailable</span><span class="p">:</span>
</span><span id="1-1182">                    <span class="k">pass</span>
</span><span id="1-1183">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-1184">                    <span class="n">mapper</span> <span class="o">=</span> <span class="n">insp</span><span class="o">.</span><span class="n">mapper</span>
</span><span id="1-1185">                    <span class="n">instance_class</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">class_</span>
</span><span id="1-1186">                    <span class="k">if</span> <span class="n">instance_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_cache</span><span class="p">:</span>
</span><span id="1-1187">                        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_cache</span><span class="p">(</span><span class="n">instance_class</span><span class="p">,</span> <span class="n">mapper</span><span class="p">)</span>
</span><span id="1-1188">
</span><span id="1-1189">                    <span class="k">try</span><span class="p">:</span>
</span><span id="1-1190">                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_cache</span><span class="p">[</span><span class="n">instance_class</span><span class="p">]</span>
</span><span id="1-1191">                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="1-1192">                        <span class="k">pass</span>
</span><span id="1-1193">
</span><span id="1-1194">        <span class="c1"># no object or ambiguous object given, so return &quot;self&quot;, which</span>
</span><span id="1-1195">        <span class="c1"># is a proxy with generally only instance-level functionality</span>
</span><span id="1-1196">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-1197">
</span><span id="1-1198">    <span class="k">def</span><span class="w"> </span><span class="nf">_populate_cache</span><span class="p">(</span>
</span><span id="1-1199">        <span class="bp">self</span><span class="p">,</span> <span class="n">instance_class</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">mapper</span><span class="p">:</span> <span class="n">Mapper</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span id="1-1200">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1201">        <span class="n">prop</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">class_mapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">owning_class</span><span class="p">)</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span>
</span><span id="1-1202">            <span class="bp">self</span><span class="o">.</span><span class="n">target_collection</span>
</span><span id="1-1203">        <span class="p">)</span>
</span><span id="1-1204">
</span><span id="1-1205">        <span class="k">if</span> <span class="n">mapper</span><span class="o">.</span><span class="n">isa</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">mapper</span><span class="p">):</span>
</span><span id="1-1206">            <span class="n">target_class</span> <span class="o">=</span> <span class="n">instance_class</span>
</span><span id="1-1207">            <span class="k">try</span><span class="p">:</span>
</span><span id="1-1208">                <span class="n">target_assoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cls_unwrap_target_assoc_proxy</span><span class="p">(</span>
</span><span id="1-1209">                    <span class="n">target_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span>
</span><span id="1-1210">                <span class="p">)</span>
</span><span id="1-1211">            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="1-1212">                <span class="k">pass</span>
</span><span id="1-1213">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-1214">                <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_cache</span><span class="p">[</span><span class="n">instance_class</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_for_assoc</span><span class="p">(</span>
</span><span id="1-1215">                    <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;AssociationProxyInstance[_T]&quot;</span><span class="p">,</span> <span class="n">target_assoc</span><span class="p">),</span>
</span><span id="1-1216">                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
</span><span id="1-1217">                    <span class="bp">self</span><span class="o">.</span><span class="n">owning_class</span><span class="p">,</span>
</span><span id="1-1218">                    <span class="n">target_class</span><span class="p">,</span>
</span><span id="1-1219">                    <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">,</span>
</span><span id="1-1220">                <span class="p">)</span>
</span><span id="1-1221">
</span><span id="1-1222">
</span><span id="1-1223"><span class="k">class</span><span class="w"> </span><span class="nc">ObjectAssociationProxyInstance</span><span class="p">(</span><span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-1224"><span class="w">    </span><span class="sd">&quot;&quot;&quot;an :class:`.AssociationProxyInstance` that has an object as a target.&quot;&quot;&quot;</span>
</span><span id="1-1225">
</span><span id="1-1226">    <span class="n">_target_is_object</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-1227">    <span class="n">_is_canonical</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-1228">
</span><span id="1-1229">    <span class="k">def</span><span class="w"> </span><span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-1230"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce a proxied &#39;contains&#39; expression using EXISTS.</span>
</span><span id="1-1231">
</span><span id="1-1232"><span class="sd">        This expression will be a composed product</span>
</span><span id="1-1233"><span class="sd">        using the :meth:`.Relationship.Comparator.any`,</span>
</span><span id="1-1234"><span class="sd">        :meth:`.Relationship.Comparator.has`,</span>
</span><span id="1-1235"><span class="sd">        and/or :meth:`.Relationship.Comparator.contains`</span>
</span><span id="1-1236"><span class="sd">        operators of the underlying proxied attributes.</span>
</span><span id="1-1237"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1238">
</span><span id="1-1239">        <span class="n">target_assoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unwrap_target_assoc_proxy</span>
</span><span id="1-1240">        <span class="k">if</span> <span class="n">target_assoc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1241">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span>
</span><span id="1-1242">                <span class="n">target_assoc</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-1243">                <span class="k">if</span> <span class="ow">not</span> <span class="n">target_assoc</span><span class="o">.</span><span class="n">scalar</span>
</span><span id="1-1244">                <span class="k">else</span> <span class="n">target_assoc</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="1-1245">            <span class="p">)</span>
</span><span id="1-1246">        <span class="k">elif</span> <span class="p">(</span>
</span><span id="1-1247">            <span class="bp">self</span><span class="o">.</span><span class="n">_target_is_object</span>
</span><span id="1-1248">            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span>
</span><span id="1-1249">            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_is_scalar</span>
</span><span id="1-1250">        <span class="p">):</span>
</span><span id="1-1251">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span><span class="o">.</span><span class="n">has</span><span class="p">(</span>
</span><span id="1-1252">                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">)</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-1253">            <span class="p">)</span>
</span><span id="1-1254">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_is_object</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalar</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_is_scalar</span><span class="p">:</span>
</span><span id="1-1255">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span id="1-1256">                <span class="s2">&quot;contains() doesn&#39;t apply to a scalar object endpoint; use ==&quot;</span>
</span><span id="1-1257">            <span class="p">)</span>
</span><span id="1-1258">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1259">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span>
</span><span id="1-1260">                <span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">:</span> <span class="n">other</span><span class="p">}</span>
</span><span id="1-1261">            <span class="p">)</span>
</span><span id="1-1262">
</span><span id="1-1263">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>  <span class="c1"># type: ignore[override]  # noqa: E501</span>
</span><span id="1-1264">        <span class="c1"># note the has() here will fail for collections; eq_()</span>
</span><span id="1-1265">        <span class="c1"># is only allowed with a scalar.</span>
</span><span id="1-1266">        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1267">            <span class="k">return</span> <span class="n">or_</span><span class="p">(</span>
</span><span id="1-1268">                <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">:</span> <span class="n">obj</span><span class="p">}),</span>
</span><span id="1-1269">                <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span> <span class="o">==</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-1270">            <span class="p">)</span>
</span><span id="1-1271">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1272">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">:</span> <span class="n">obj</span><span class="p">})</span>
</span><span id="1-1273">
</span><span id="1-1274">    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>  <span class="c1"># type: ignore[override]  # noqa: E501</span>
</span><span id="1-1275">        <span class="c1"># note the has() here will fail for collections; eq_()</span>
</span><span id="1-1276">        <span class="c1"># is only allowed with a scalar.</span>
</span><span id="1-1277">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span><span class="o">.</span><span class="n">has</span><span class="p">(</span>
</span><span id="1-1278">            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_attr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">obj</span>
</span><span id="1-1279">        <span class="p">)</span>
</span><span id="1-1280">
</span><span id="1-1281">
</span><span id="1-1282"><span class="k">class</span><span class="w"> </span><span class="nc">ColumnAssociationProxyInstance</span><span class="p">(</span><span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-1283"><span class="w">    </span><span class="sd">&quot;&quot;&quot;an :class:`.AssociationProxyInstance` that has a database column as a</span>
</span><span id="1-1284"><span class="sd">    target.</span>
</span><span id="1-1285"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-1286">
</span><span id="1-1287">    <span class="n">_target_is_object</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-1288">    <span class="n">_is_canonical</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-1289">
</span><span id="1-1290">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>  <span class="c1"># type: ignore[override]  # noqa: E501</span>
</span><span id="1-1291">        <span class="c1"># special case &quot;is None&quot; to check for no related row as well</span>
</span><span id="1-1292">        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span>
</span><span id="1-1293">            <span class="bp">self</span><span class="o">.</span><span class="n">remote_attr</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">operators</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="1-1294">        <span class="p">)</span>
</span><span id="1-1295">        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1296">            <span class="k">return</span> <span class="n">or_</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-1297">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1298">            <span class="k">return</span> <span class="n">expr</span>
</span><span id="1-1299">
</span><span id="1-1300">    <span class="k">def</span><span class="w"> </span><span class="nf">operate</span><span class="p">(</span>
</span><span id="1-1301">        <span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">operators</span><span class="o">.</span><span class="n">OperatorType</span><span class="p">,</span> <span class="o">*</span><span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-1302">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-1303">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_criterion_exists</span><span class="p">(</span>
</span><span id="1-1304">            <span class="bp">self</span><span class="o">.</span><span class="n">remote_attr</span><span class="o">.</span><span class="n">operate</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-1305">        <span class="p">)</span>
</span><span id="1-1306">
</span><span id="1-1307">
</span><span id="1-1308"><span class="k">class</span><span class="w"> </span><span class="nc">_lazy_collection</span><span class="p">(</span><span class="n">_LazyCollectionProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-1309">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-1310">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">obj</span>
</span><span id="1-1311">        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
</span><span id="1-1312">
</span><span id="1-1313">    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span id="1-1314">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1315">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">MutableSet</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T</span><span class="p">],</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span id="1-1316">        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>  <span class="c1"># type: ignore[no-any-return]</span>
</span><span id="1-1317">
</span><span id="1-1318">    <span class="k">def</span><span class="w"> </span><span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-1319">        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;obj&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">}</span>
</span><span id="1-1320">
</span><span id="1-1321">    <span class="k">def</span><span class="w"> </span><span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1322">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;obj&quot;</span><span class="p">]</span>
</span><span id="1-1323">        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
</span><span id="1-1324">
</span><span id="1-1325">
</span><span id="1-1326"><span class="n">_IT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_IT&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;Any&quot;</span><span class="p">)</span>
</span><span id="1-1327"><span class="sd">&quot;&quot;&quot;instance type - this is the type of object inside a collection.</span>
</span><span id="1-1328">
</span><span id="1-1329"><span class="sd">this is not the same as the _T of AssociationProxy and</span>
</span><span id="1-1330"><span class="sd">AssociationProxyInstance itself, which will often refer to the</span>
</span><span id="1-1331"><span class="sd">collection[_IT] type.</span>
</span><span id="1-1332">
</span><span id="1-1333"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1334">
</span><span id="1-1335">
</span><span id="1-1336"><span class="k">class</span><span class="w"> </span><span class="nc">_AssociationCollection</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_IT</span><span class="p">]):</span>
</span><span id="1-1337">    <span class="n">getter</span><span class="p">:</span> <span class="n">_GetterProtocol</span><span class="p">[</span><span class="n">_IT</span><span class="p">]</span>
</span><span id="1-1338"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A function.  Given an associated object, return the &#39;value&#39;.&quot;&quot;&quot;</span>
</span><span id="1-1339">
</span><span id="1-1340">    <span class="n">creator</span><span class="p">:</span> <span class="n">_CreatorProtocol</span>
</span><span id="1-1341"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1342"><span class="sd">    A function that creates new target entities.  Given one parameter:</span>
</span><span id="1-1343"><span class="sd">    value.  This assertion is assumed::</span>
</span><span id="1-1344">
</span><span id="1-1345"><span class="sd">    obj = creator(somevalue)</span>
</span><span id="1-1346"><span class="sd">    assert getter(obj) == somevalue</span>
</span><span id="1-1347"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-1348">
</span><span id="1-1349">    <span class="n">parent</span><span class="p">:</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_IT</span><span class="p">]</span>
</span><span id="1-1350">    <span class="n">setter</span><span class="p">:</span> <span class="n">_SetterProtocol</span>
</span><span id="1-1351"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A function.  Given an associated object and a value, store that</span>
</span><span id="1-1352"><span class="sd">        value on the object.</span>
</span><span id="1-1353"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-1354">
</span><span id="1-1355">    <span class="n">lazy_collection</span><span class="p">:</span> <span class="n">_LazyCollectionProtocol</span><span class="p">[</span><span class="n">_IT</span><span class="p">]</span>
</span><span id="1-1356"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A callable returning a list-based collection of entities (usually an</span>
</span><span id="1-1357"><span class="sd">          object attribute managed by a SQLAlchemy relationship())&quot;&quot;&quot;</span>
</span><span id="1-1358">
</span><span id="1-1359">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="1-1360">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1361">        <span class="n">lazy_collection</span><span class="p">:</span> <span class="n">_LazyCollectionProtocol</span><span class="p">[</span><span class="n">_IT</span><span class="p">],</span>
</span><span id="1-1362">        <span class="n">creator</span><span class="p">:</span> <span class="n">_CreatorProtocol</span><span class="p">,</span>
</span><span id="1-1363">        <span class="n">getter</span><span class="p">:</span> <span class="n">_GetterProtocol</span><span class="p">[</span><span class="n">_IT</span><span class="p">],</span>
</span><span id="1-1364">        <span class="n">setter</span><span class="p">:</span> <span class="n">_SetterProtocol</span><span class="p">,</span>
</span><span id="1-1365">        <span class="n">parent</span><span class="p">:</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">_IT</span><span class="p">],</span>
</span><span id="1-1366">    <span class="p">):</span>
</span><span id="1-1367"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs an _AssociationCollection.</span>
</span><span id="1-1368">
</span><span id="1-1369"><span class="sd">        This will always be a subclass of either _AssociationList,</span>
</span><span id="1-1370"><span class="sd">        _AssociationSet, or _AssociationDict.</span>
</span><span id="1-1371">
</span><span id="1-1372"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1373">        <span class="bp">self</span><span class="o">.</span><span class="n">lazy_collection</span> <span class="o">=</span> <span class="n">lazy_collection</span>
</span><span id="1-1374">        <span class="bp">self</span><span class="o">.</span><span class="n">creator</span> <span class="o">=</span> <span class="n">creator</span>
</span><span id="1-1375">        <span class="bp">self</span><span class="o">.</span><span class="n">getter</span> <span class="o">=</span> <span class="n">getter</span>
</span><span id="1-1376">        <span class="bp">self</span><span class="o">.</span><span class="n">setter</span> <span class="o">=</span> <span class="n">setter</span>
</span><span id="1-1377">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</span><span id="1-1378">
</span><span id="1-1379">    <span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-1380">        <span class="n">col</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">_IT</span><span class="p">]</span>
</span><span id="1-1381">    <span class="k">else</span><span class="p">:</span>
</span><span id="1-1382">        <span class="n">col</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lazy_collection</span><span class="p">())</span>
</span><span id="1-1383">
</span><span id="1-1384">    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="1-1385">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
</span><span id="1-1386">
</span><span id="1-1387">    <span class="k">def</span><span class="w"> </span><span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1388">        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
</span><span id="1-1389">
</span><span id="1-1390">    <span class="k">def</span><span class="w"> </span><span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-1391">        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;lazy_collection&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lazy_collection</span><span class="p">}</span>
</span><span id="1-1392">
</span><span id="1-1393">    <span class="k">def</span><span class="w"> </span><span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1394">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span>
</span><span id="1-1395">        <span class="bp">self</span><span class="o">.</span><span class="n">lazy_collection</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;lazy_collection&quot;</span><span class="p">]</span>
</span><span id="1-1396">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_inflate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1397">
</span><span id="1-1398">    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1399">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-1400">
</span><span id="1-1401">
</span><span id="1-1402"><span class="k">class</span><span class="w"> </span><span class="nc">_AssociationSingleItem</span><span class="p">(</span><span class="n">_AssociationCollection</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-1403">    <span class="n">setter</span><span class="p">:</span> <span class="n">_PlainSetterProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span><span id="1-1404">    <span class="n">creator</span><span class="p">:</span> <span class="n">_PlainCreatorProtocol</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span><span id="1-1405">
</span><span id="1-1406">    <span class="k">def</span><span class="w"> </span><span class="nf">_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-1407">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">creator</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1408">
</span><span id="1-1409">    <span class="k">def</span><span class="w"> </span><span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="1-1410">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getter</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span>
</span><span id="1-1411">
</span><span id="1-1412">    <span class="k">def</span><span class="w"> </span><span class="nf">_bulk_replace</span><span class="p">(</span>
</span><span id="1-1413">        <span class="bp">self</span><span class="p">,</span> <span class="n">assoc_proxy</span><span class="p">:</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_IT</span><span class="p">]</span>
</span><span id="1-1414">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1415">        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="1-1416">        <span class="n">assoc_proxy</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="1-1417">
</span><span id="1-1418">
</span><span id="1-1419"><span class="k">class</span><span class="w"> </span><span class="nc">_AssociationList</span><span class="p">(</span><span class="n">_AssociationSingleItem</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-1420"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generic, converting, list-to-list proxy.&quot;&quot;&quot;</span>
</span><span id="1-1421">
</span><span id="1-1422">    <span class="n">col</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span><span id="1-1423">
</span><span id="1-1424">    <span class="k">def</span><span class="w"> </span><span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1425">        <span class="bp">self</span><span class="o">.</span><span class="n">setter</span><span class="p">(</span><span class="n">object_</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="1-1426">
</span><span id="1-1427">    <span class="nd">@overload</span>
</span><span id="1-1428">    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1429">
</span><span id="1-1430">    <span class="nd">@overload</span>
</span><span id="1-1431">    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
</span><span id="1-1432">
</span><span id="1-1433">    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span>
</span><span id="1-1434">        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]</span>
</span><span id="1-1435">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="p">,</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span id="1-1436">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="1-1437">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span id="1-1438">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1439">            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
</span><span id="1-1440">
</span><span id="1-1441">    <span class="nd">@overload</span>
</span><span id="1-1442">    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1443">
</span><span id="1-1444">    <span class="nd">@overload</span>
</span><span id="1-1445">    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1446">
</span><span id="1-1447">    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span>
</span><span id="1-1448">        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">],</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">]]</span>
</span><span id="1-1449">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1450">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="1-1451">            <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</span><span id="1-1452">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1453">            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1454">                <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1455">            <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">stop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="1-1456">                <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="n">index</span><span class="o">.</span><span class="n">stop</span>
</span><span id="1-1457">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-1458">                <span class="n">stop</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">stop</span>
</span><span id="1-1459">            <span class="n">step</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">step</span> <span class="ow">or</span> <span class="mi">1</span>
</span><span id="1-1460">
</span><span id="1-1461">            <span class="n">start</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="mi">0</span>
</span><span id="1-1462">            <span class="n">rng</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">))</span>
</span><span id="1-1463">
</span><span id="1-1464">            <span class="n">sized_value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1465">
</span><span id="1-1466">            <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="1-1467">                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rng</span><span class="p">:</span>
</span><span id="1-1468">                    <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>
</span><span id="1-1469">                <span class="n">i</span> <span class="o">=</span> <span class="n">start</span>
</span><span id="1-1470">                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sized_value</span><span class="p">:</span>
</span><span id="1-1471">                    <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span id="1-1472">                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="1-1473">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-1474">                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sized_value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">):</span>
</span><span id="1-1475">                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="1-1476">                        <span class="s2">&quot;attempt to assign sequence of size </span><span class="si">%s</span><span class="s2"> to &quot;</span>
</span><span id="1-1477">                        <span class="s2">&quot;extended slice of size </span><span class="si">%s</span><span class="s2">&quot;</span>
</span><span id="1-1478">                        <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sized_value</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">))</span>
</span><span id="1-1479">                    <span class="p">)</span>
</span><span id="1-1480">                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-1481">                    <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">item</span><span class="p">)</span>
</span><span id="1-1482">
</span><span id="1-1483">    <span class="nd">@overload</span>
</span><span id="1-1484">    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1485">
</span><span id="1-1486">    <span class="nd">@overload</span>
</span><span id="1-1487">    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1488">
</span><span id="1-1489">    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1490">        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="1-1491">
</span><span id="1-1492">    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1493">        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1494">            <span class="c1"># testlib.pragma exempt:__eq__</span>
</span><span id="1-1495">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
</span><span id="1-1496">                <span class="k">return</span> <span class="kc">True</span>
</span><span id="1-1497">        <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-1498">
</span><span id="1-1499">    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1500"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over proxied values.</span>
</span><span id="1-1501">
</span><span id="1-1502"><span class="sd">        For the actual domain objects, iterate over .col instead or</span>
</span><span id="1-1503"><span class="sd">        just use the underlying collection directly from its property</span>
</span><span id="1-1504"><span class="sd">        on the parent.</span>
</span><span id="1-1505"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1506">
</span><span id="1-1507">        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1508">            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</span><span id="1-1509">        <span class="k">return</span>
</span><span id="1-1510">
</span><span id="1-1511">    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1512">        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span>
</span><span id="1-1513">        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1514">        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="1-1515">
</span><span id="1-1516">    <span class="k">def</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="1-1517">        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="1-1518">        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="1-1519">            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
</span><span id="1-1520">                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="1-1521">        <span class="k">return</span> <span class="n">count</span>
</span><span id="1-1522">
</span><span id="1-1523">    <span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1524">        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="1-1525">            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="1-1526">
</span><span id="1-1527">    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1528">        <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
</span><span id="1-1529">
</span><span id="1-1530">    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="1-1531">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span id="1-1532">
</span><span id="1-1533">    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1534">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-1535">            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
</span><span id="1-1536">                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="1-1537">                <span class="k">return</span>
</span><span id="1-1538">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value not in list&quot;</span><span class="p">)</span>
</span><span id="1-1539">
</span><span id="1-1540">    <span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-1541"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Not supported, use reversed(mylist)&quot;&quot;&quot;</span>
</span><span id="1-1542">
</span><span id="1-1543">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-1544">
</span><span id="1-1545">    <span class="k">def</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-1546"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Not supported, use sorted(mylist)&quot;&quot;&quot;</span>
</span><span id="1-1547">
</span><span id="1-1548">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-1549">
</span><span id="1-1550">    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1551">        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)]</span>
</span><span id="1-1552">
</span><span id="1-1553">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1554">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="1-1555">
</span><span id="1-1556">    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1557">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="n">other</span>
</span><span id="1-1558">
</span><span id="1-1559">    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1560">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">other</span>
</span><span id="1-1561">
</span><span id="1-1562">    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1563">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">other</span>
</span><span id="1-1564">
</span><span id="1-1565">    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1566">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">other</span>
</span><span id="1-1567">
</span><span id="1-1568">    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1569">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">other</span>
</span><span id="1-1570">
</span><span id="1-1571">    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1572">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-1573">            <span class="n">other</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-1574">        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="1-1575">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="1-1576">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="n">other</span>
</span><span id="1-1577">
</span><span id="1-1578">    <span class="k">def</span><span class="w"> </span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1579">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-1580">            <span class="n">other</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-1581">        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="1-1582">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="1-1583">        <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1584">
</span><span id="1-1585">    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">SupportsIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1586">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="1-1587">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="1-1588">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span>
</span><span id="1-1589">
</span><span id="1-1590">    <span class="k">def</span><span class="w"> </span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">SupportsIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1591">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="1-1592">            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="1-1593">        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1594">
</span><span id="1-1595">    <span class="k">def</span><span class="w"> </span><span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="1-1596">        <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
</span><span id="1-1597">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-1598">
</span><span id="1-1599">    <span class="k">def</span><span class="w"> </span><span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">SupportsIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="1-1600">        <span class="c1"># unlike a regular list *=, proxied __imul__ will generate unique</span>
</span><span id="1-1601">        <span class="c1"># backing objects for each copy.  *= on proxied lists is a bit of</span>
</span><span id="1-1602">        <span class="c1"># a stretch anyhow, and this interpretation of the __imul__ contract</span>
</span><span id="1-1603">        <span class="c1"># is more plausibly useful than copying the backing objects.</span>
</span><span id="1-1604">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="1-1605">            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-1606">        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="1-1607">            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="1-1608">        <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="1-1609">            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="1-1610">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-1611">
</span><span id="1-1612">    <span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-1613">        <span class="c1"># TODO: no idea how to do this without separate &quot;stub&quot;</span>
</span><span id="1-1614">        <span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span>
</span><span id="1-1615">            <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="1-1616">        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1617">
</span><span id="1-1618">    <span class="k">else</span><span class="p">:</span>
</span><span id="1-1619">
</span><span id="1-1620">        <span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="1-1621">            <span class="n">ls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1622">            <span class="k">return</span> <span class="n">ls</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
</span><span id="1-1623">
</span><span id="1-1624">    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1625">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1626">
</span><span id="1-1627">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-1628">        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="1-1629">
</span><span id="1-1630">    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-1631">        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> objects are unhashable&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="1-1632">
</span><span id="1-1633">    <span class="k">if</span> <span class="ow">not</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-1634">        <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="1-1635">            <span class="k">if</span> <span class="p">(</span>
</span><span id="1-1636">                <span class="nb">callable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="1-1637">                <span class="ow">and</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">func_name</span>
</span><span id="1-1638">                <span class="ow">and</span> <span class="ow">not</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="1-1639">                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">func_name</span><span class="p">)</span>
</span><span id="1-1640">            <span class="p">):</span>
</span><span id="1-1641">                <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">func_name</span><span class="p">)</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="1-1642">        <span class="k">del</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func</span>
</span><span id="1-1643">
</span><span id="1-1644">
</span><span id="1-1645"><span class="k">class</span><span class="w"> </span><span class="nc">_AssociationDict</span><span class="p">(</span><span class="n">_AssociationCollection</span><span class="p">[</span><span class="n">_VT</span><span class="p">],</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">]):</span>
</span><span id="1-1646"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generic, converting, dict-to-dict proxy.&quot;&quot;&quot;</span>
</span><span id="1-1647">
</span><span id="1-1648">    <span class="n">setter</span><span class="p">:</span> <span class="n">_DictSetterProtocol</span><span class="p">[</span><span class="n">_VT</span><span class="p">]</span>
</span><span id="1-1649">    <span class="n">creator</span><span class="p">:</span> <span class="n">_KeyCreatorProtocol</span><span class="p">[</span><span class="n">_VT</span><span class="p">]</span>
</span><span id="1-1650">    <span class="n">col</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_VT</span><span class="p">]]</span>
</span><span id="1-1651">
</span><span id="1-1652">    <span class="k">def</span><span class="w"> </span><span class="nf">_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_VT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="1-1653">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">creator</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="1-1654">
</span><span id="1-1655">    <span class="k">def</span><span class="w"> </span><span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_VT</span><span class="p">:</span>
</span><span id="1-1656">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getter</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span>
</span><span id="1-1657">
</span><span id="1-1658">    <span class="k">def</span><span class="w"> </span><span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_VT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1659">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setter</span><span class="p">(</span><span class="n">object_</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="1-1660">
</span><span id="1-1661">    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_VT</span><span class="p">:</span>
</span><span id="1-1662">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="1-1663">
</span><span id="1-1664">    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_VT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1665">        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1666">            <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="1-1667">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1668">            <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="1-1669">
</span><span id="1-1670">    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1671">        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="1-1672">
</span><span id="1-1673">    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1674">        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span>
</span><span id="1-1675">
</span><span id="1-1676">    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_KT</span><span class="p">]:</span>
</span><span id="1-1677">        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="1-1678">
</span><span id="1-1679">    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1680">        <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="1-1681">
</span><span id="1-1682">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1683">        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="1-1684">
</span><span id="1-1685">    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1686">        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="n">other</span>
</span><span id="1-1687">
</span><span id="1-1688">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-1689">        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="1-1690">
</span><span id="1-1691">    <span class="nd">@overload</span>
</span><span id="1-1692">    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_VT</span><span class="p">]:</span> <span class="o">...</span>
</span><span id="1-1693">
</span><span id="1-1694">    <span class="nd">@overload</span>
</span><span id="1-1695">    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_VT</span><span class="p">,</span> <span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">_VT</span><span class="p">,</span> <span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
</span><span id="1-1696">
</span><span id="1-1697">    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
</span><span id="1-1698">        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">_VT</span><span class="p">,</span> <span class="n">_T</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-1699">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">_VT</span><span class="p">,</span> <span class="n">_T</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="1-1700">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-1701">            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="1-1702">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="1-1703">            <span class="k">return</span> <span class="n">default</span>
</span><span id="1-1704">
</span><span id="1-1705">    <span class="k">def</span><span class="w"> </span><span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_VT</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_VT</span><span class="p">:</span>
</span><span id="1-1706">        <span class="c1"># TODO: again, no idea how to create an actual MutableMapping.</span>
</span><span id="1-1707">        <span class="c1"># default must allow None, return type can&#39;t include None,</span>
</span><span id="1-1708">        <span class="c1"># the stub explicitly allows for default of None with a cryptic message</span>
</span><span id="1-1709">        <span class="c1"># &quot;This overload should be allowed only if the value type is</span>
</span><span id="1-1710">        <span class="c1"># compatible with None.&quot;.</span>
</span><span id="1-1711">        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1712">            <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</span><span id="1-1713">            <span class="k">return</span> <span class="n">default</span>  <span class="c1"># type: ignore</span>
</span><span id="1-1714">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1715">            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="1-1716">
</span><span id="1-1717">    <span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeysView</span><span class="p">[</span><span class="n">_KT</span><span class="p">]:</span>
</span><span id="1-1718">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="1-1719">
</span><span id="1-1720">    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ItemsView</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">]:</span>
</span><span id="1-1721">        <span class="k">return</span> <span class="n">ItemsView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1722">
</span><span id="1-1723">    <span class="k">def</span><span class="w"> </span><span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValuesView</span><span class="p">[</span><span class="n">_VT</span><span class="p">]:</span>
</span><span id="1-1724">        <span class="k">return</span> <span class="n">ValuesView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1725">
</span><span id="1-1726">    <span class="nd">@overload</span>
</span><span id="1-1727">    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_VT</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1728">
</span><span id="1-1729">    <span class="nd">@overload</span>
</span><span id="1-1730">    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span>
</span><span id="1-1731">        <span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_VT</span><span class="p">,</span> <span class="n">_T</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="1-1732">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">_VT</span><span class="p">,</span> <span class="n">_T</span><span class="p">]:</span> <span class="o">...</span>
</span><span id="1-1733">
</span><span id="1-1734">    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">:</span> <span class="n">_KT</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">_VT</span><span class="p">,</span> <span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1735">        <span class="n">member</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">__key</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-1736">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</span><span id="1-1737">
</span><span id="1-1738">    <span class="k">def</span><span class="w"> </span><span class="nf">popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">]:</span>
</span><span id="1-1739">        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
</span><span id="1-1740">        <span class="k">return</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="1-1741">
</span><span id="1-1742">    <span class="nd">@overload</span>
</span><span id="1-1743">    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span>
</span><span id="1-1744">        <span class="bp">self</span><span class="p">,</span> <span class="n">__m</span><span class="p">:</span> <span class="n">SupportsKeysAndGetItem</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_VT</span>
</span><span id="1-1745">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1746">
</span><span id="1-1747">    <span class="nd">@overload</span>
</span><span id="1-1748">    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span>
</span><span id="1-1749">        <span class="bp">self</span><span class="p">,</span> <span class="n">__m</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">]],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_VT</span>
</span><span id="1-1750">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1751">
</span><span id="1-1752">    <span class="nd">@overload</span>
</span><span id="1-1753">    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_VT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span id="1-1754">
</span><span id="1-1755">    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1756">        <span class="n">up</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-1757">        <span class="n">up</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="1-1758">
</span><span id="1-1759">        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">up</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="1-1760">            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-1761">
</span><span id="1-1762">    <span class="k">def</span><span class="w"> </span><span class="nf">_bulk_replace</span><span class="p">(</span>
</span><span id="1-1763">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1764">        <span class="n">assoc_proxy</span><span class="p">:</span> <span class="n">AssociationProxyInstance</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-1765">        <span class="n">values</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">],</span>
</span><span id="1-1766">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1767">        <span class="n">existing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1768">        <span class="n">constants</span> <span class="o">=</span> <span class="n">existing</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">values</span> <span class="ow">or</span> <span class="p">())</span>
</span><span id="1-1769">        <span class="n">additions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span> <span class="ow">or</span> <span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">constants</span><span class="p">)</span>
</span><span id="1-1770">        <span class="n">removals</span> <span class="o">=</span> <span class="n">existing</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">constants</span><span class="p">)</span>
</span><span id="1-1771">
</span><span id="1-1772">        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="ow">or</span> <span class="p">():</span>
</span><span id="1-1773">            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">additions</span><span class="p">:</span>
</span><span id="1-1774">                <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">member</span>
</span><span id="1-1775">            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">constants</span><span class="p">:</span>
</span><span id="1-1776">                <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">member</span>
</span><span id="1-1777">
</span><span id="1-1778">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">removals</span><span class="p">:</span>
</span><span id="1-1779">            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="1-1780">
</span><span id="1-1781">    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">]:</span>
</span><span id="1-1782">        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="1-1783">
</span><span id="1-1784">    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-1785">        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> objects are unhashable&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="1-1786">
</span><span id="1-1787">    <span class="k">if</span> <span class="ow">not</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-1788">        <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="1-1789">            <span class="k">if</span> <span class="p">(</span>
</span><span id="1-1790">                <span class="nb">callable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="1-1791">                <span class="ow">and</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">func_name</span>
</span><span id="1-1792">                <span class="ow">and</span> <span class="ow">not</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="1-1793">                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">func_name</span><span class="p">)</span>
</span><span id="1-1794">            <span class="p">):</span>
</span><span id="1-1795">                <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">func_name</span><span class="p">)</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="1-1796">        <span class="k">del</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func</span>
</span><span id="1-1797">
</span><span id="1-1798">
</span><span id="1-1799"><span class="k">class</span><span class="w"> </span><span class="nc">_AssociationSet</span><span class="p">(</span><span class="n">_AssociationSingleItem</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="1-1800"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generic, converting, set-to-set proxy.&quot;&quot;&quot;</span>
</span><span id="1-1801">
</span><span id="1-1802">    <span class="n">col</span><span class="p">:</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span>
</span><span id="1-1803">
</span><span id="1-1804">    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="1-1805">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
</span><span id="1-1806">
</span><span id="1-1807">    <span class="k">def</span><span class="w"> </span><span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1808">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1809">            <span class="k">return</span> <span class="kc">True</span>
</span><span id="1-1810">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1811">            <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-1812">
</span><span id="1-1813">    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__o</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1814">        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1815">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="o">==</span> <span class="n">__o</span><span class="p">:</span>
</span><span id="1-1816">                <span class="k">return</span> <span class="kc">True</span>
</span><span id="1-1817">        <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-1818">
</span><span id="1-1819">    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1820"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over proxied values.</span>
</span><span id="1-1821">
</span><span id="1-1822"><span class="sd">        For the actual domain objects, iterate over .col instead or just use</span>
</span><span id="1-1823"><span class="sd">        the underlying collection directly from its property on the parent.</span>
</span><span id="1-1824">
</span><span id="1-1825"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1826">        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1827">            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</span><span id="1-1828">        <span class="k">return</span>
</span><span id="1-1829">
</span><span id="1-1830">    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__element</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1831">        <span class="k">if</span> <span class="n">__element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="1-1832">            <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="n">__element</span><span class="p">))</span>
</span><span id="1-1833">
</span><span id="1-1834">    <span class="c1"># for discard and remove, choosing a more expensive check strategy rather</span>
</span><span id="1-1835">    <span class="c1"># than call self.creator()</span>
</span><span id="1-1836">    <span class="k">def</span><span class="w"> </span><span class="nf">discard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__element</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1837">        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1838">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="o">==</span> <span class="n">__element</span><span class="p">:</span>
</span><span id="1-1839">                <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</span><span id="1-1840">                <span class="k">break</span>
</span><span id="1-1841">
</span><span id="1-1842">    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__element</span><span class="p">:</span> <span class="n">_T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1843">        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1844">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="o">==</span> <span class="n">__element</span><span class="p">:</span>
</span><span id="1-1845">                <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</span><span id="1-1846">                <span class="k">return</span>
</span><span id="1-1847">        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">__element</span><span class="p">)</span>
</span><span id="1-1848">
</span><span id="1-1849">    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="1-1850">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">:</span>
</span><span id="1-1851">            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;pop from an empty set&quot;</span><span class="p">)</span>
</span><span id="1-1852">        <span class="n">member</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="1-1853">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</span><span id="1-1854">
</span><span id="1-1855">    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">s</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1856">        <span class="k">for</span> <span class="n">iterable</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="1-1857">            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
</span><span id="1-1858">                <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1859">
</span><span id="1-1860">    <span class="k">def</span><span class="w"> </span><span class="nf">_bulk_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assoc_proxy</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1861">        <span class="n">existing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1862">        <span class="n">constants</span> <span class="o">=</span> <span class="n">existing</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">values</span> <span class="ow">or</span> <span class="p">())</span>
</span><span id="1-1863">        <span class="n">additions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span> <span class="ow">or</span> <span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">constants</span><span class="p">)</span>
</span><span id="1-1864">        <span class="n">removals</span> <span class="o">=</span> <span class="n">existing</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">constants</span><span class="p">)</span>
</span><span id="1-1865">
</span><span id="1-1866">        <span class="n">appender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span>
</span><span id="1-1867">        <span class="n">remover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span>
</span><span id="1-1868">
</span><span id="1-1869">        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">or</span> <span class="p">():</span>
</span><span id="1-1870">            <span class="k">if</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">additions</span><span class="p">:</span>
</span><span id="1-1871">                <span class="n">appender</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</span><span id="1-1872">            <span class="k">elif</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">constants</span><span class="p">:</span>
</span><span id="1-1873">                <span class="n">appender</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</span><span id="1-1874">
</span><span id="1-1875">        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">removals</span><span class="p">:</span>
</span><span id="1-1876">            <span class="n">remover</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
</span><span id="1-1877">
</span><span id="1-1878">    <span class="k">def</span><span class="w"> </span><span class="fm">__ior__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="1-1879">        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">_S</span><span class="p">]</span>
</span><span id="1-1880">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="p">,</span> <span class="n">_S</span><span class="p">]]:</span>
</span><span id="1-1881">        <span class="k">if</span> <span class="ow">not</span> <span class="n">collections</span><span class="o">.</span><span class="n">_set_binops_check_strict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="1-1882">            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-1883">        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
</span><span id="1-1884">            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1885">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-1886">
</span><span id="1-1887">    <span class="k">def</span><span class="w"> </span><span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1888">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="1-1889">
</span><span id="1-1890">    <span class="k">def</span><span class="w"> </span><span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">s</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="p">,</span> <span class="n">_S</span><span class="p">]]:</span>
</span><span id="1-1891">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
</span><span id="1-1892">
</span><span id="1-1893">    <span class="k">def</span><span class="w"> </span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__s</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">_S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="p">,</span> <span class="n">_S</span><span class="p">]]:</span>
</span><span id="1-1894">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">__s</span><span class="p">)</span>
</span><span id="1-1895">
</span><span id="1-1896">    <span class="k">def</span><span class="w"> </span><span class="nf">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">s</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1897">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
</span><span id="1-1898">
</span><span id="1-1899">    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1900">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="1-1901">
</span><span id="1-1902">    <span class="k">def</span><span class="w"> </span><span class="nf">difference_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">s</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1903">        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="1-1904">            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
</span><span id="1-1905">                <span class="bp">self</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1906">
</span><span id="1-1907">    <span class="k">def</span><span class="w"> </span><span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="1-1908">        <span class="k">if</span> <span class="ow">not</span> <span class="n">collections</span><span class="o">.</span><span class="n">_set_binops_check_strict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="1-1909">            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-1910">        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="1-1911">            <span class="bp">self</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1912">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-1913">
</span><span id="1-1914">    <span class="k">def</span><span class="w"> </span><span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">s</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1915">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
</span><span id="1-1916">
</span><span id="1-1917">    <span class="k">def</span><span class="w"> </span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1918">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="1-1919">
</span><span id="1-1920">    <span class="k">def</span><span class="w"> </span><span class="nf">intersection_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">s</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1921">        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span id="1-1922">            <span class="n">want</span><span class="p">,</span> <span class="n">have</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1923">
</span><span id="1-1924">            <span class="n">remove</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="n">have</span> <span class="o">-</span> <span class="n">want</span><span class="p">,</span> <span class="n">want</span> <span class="o">-</span> <span class="n">have</span>
</span><span id="1-1925">
</span><span id="1-1926">            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">remove</span><span class="p">:</span>
</span><span id="1-1927">                <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1928">            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">add</span><span class="p">:</span>
</span><span id="1-1929">                <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1930">
</span><span id="1-1931">    <span class="k">def</span><span class="w"> </span><span class="fm">__iand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="1-1932">        <span class="k">if</span> <span class="ow">not</span> <span class="n">collections</span><span class="o">.</span><span class="n">_set_binops_check_strict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="1-1933">            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-1934">        <span class="n">want</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="1-1935">        <span class="n">have</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1936">
</span><span id="1-1937">        <span class="n">remove</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="n">have</span> <span class="o">-</span> <span class="n">want</span><span class="p">,</span> <span class="n">want</span> <span class="o">-</span> <span class="n">have</span>
</span><span id="1-1938">
</span><span id="1-1939">        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">remove</span><span class="p">:</span>
</span><span id="1-1940">            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1941">        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">add</span><span class="p">:</span>
</span><span id="1-1942">            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1943">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-1944">
</span><span id="1-1945">    <span class="k">def</span><span class="w"> </span><span class="nf">symmetric_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__s</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1946">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">__s</span><span class="p">)</span>
</span><span id="1-1947">
</span><span id="1-1948">    <span class="k">def</span><span class="w"> </span><span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">_S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="p">,</span> <span class="n">_S</span><span class="p">]]:</span>
</span><span id="1-1949">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="1-1950">
</span><span id="1-1951">    <span class="k">def</span><span class="w"> </span><span class="nf">symmetric_difference_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1952">        <span class="n">want</span><span class="p">,</span> <span class="n">have</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1953">
</span><span id="1-1954">        <span class="n">remove</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="n">have</span> <span class="o">-</span> <span class="n">want</span><span class="p">,</span> <span class="n">want</span> <span class="o">-</span> <span class="n">have</span>
</span><span id="1-1955">
</span><span id="1-1956">        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">remove</span><span class="p">:</span>
</span><span id="1-1957">            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1958">        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">add</span><span class="p">:</span>
</span><span id="1-1959">            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-1960">
</span><span id="1-1961">    <span class="k">def</span><span class="w"> </span><span class="fm">__ixor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">_S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MutableSet</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="p">,</span> <span class="n">_S</span><span class="p">]]:</span>  <span class="c1"># type: ignore  # noqa: E501</span>
</span><span id="1-1962">        <span class="k">if</span> <span class="ow">not</span> <span class="n">collections</span><span class="o">.</span><span class="n">_set_binops_check_strict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="1-1963">            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="1-1964">
</span><span id="1-1965">        <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_difference_update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="1-1966">        <span class="k">return</span> <span class="bp">self</span>
</span><span id="1-1967">
</span><span id="1-1968">    <span class="k">def</span><span class="w"> </span><span class="nf">issubset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__s</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1969">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">__s</span><span class="p">)</span>
</span><span id="1-1970">
</span><span id="1-1971">    <span class="k">def</span><span class="w"> </span><span class="nf">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__s</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1972">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">__s</span><span class="p">)</span>
</span><span id="1-1973">
</span><span id="1-1974">    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1975">        <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="1-1976">
</span><span id="1-1977">    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
</span><span id="1-1978">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-1979">
</span><span id="1-1980">    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1981">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="1-1982">
</span><span id="1-1983">    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1984">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="n">other</span>
</span><span id="1-1985">
</span><span id="1-1986">    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1987">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">other</span>
</span><span id="1-1988">
</span><span id="1-1989">    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1990">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">other</span>
</span><span id="1-1991">
</span><span id="1-1992">    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1993">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">other</span>
</span><span id="1-1994">
</span><span id="1-1995">    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">AbstractSet</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="1-1996">        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">other</span>
</span><span id="1-1997">
</span><span id="1-1998">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="1-1999">        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="1-2000">
</span><span id="1-2001">    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="1-2002">        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> objects are unhashable&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="1-2003">
</span><span id="1-2004">    <span class="k">if</span> <span class="ow">not</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-2005">        <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="1-2006">            <span class="k">if</span> <span class="p">(</span>
</span><span id="1-2007">                <span class="nb">callable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="1-2008">                <span class="ow">and</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">func_name</span>
</span><span id="1-2009">                <span class="ow">and</span> <span class="ow">not</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="1-2010">                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="n">func_name</span><span class="p">)</span>
</span><span id="1-2011">            <span class="p">):</span>
</span><span id="1-2012">                <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="n">func_name</span><span class="p">)</span><span class="o">.</span><span class="vm">__doc__</span>
</span><span id="1-2013">        <span class="k">del</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func</span>
</span></pre></div>
        </article>
        
        <div class="navigation flex print:hidden">
  
  
</div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2023, Jacob Coffee</p>
        
        <p>
          Made with
          
          <a href="https://www.sphinx-doc.org/">Sphinx</a> and
          
          <a href="https://shibuya.lepture.com">Shibuya theme</a>.
        </p>
      </div>
      <div class="sy-foot-socials">
          <a href="https://github.com/JacobCoffee/byte-bot" aria-label="GitHub"><i class="i-icon github"></i></a>
          <a href="https://twitter.com/_scriptr" aria-label="X (Twitter)"><i class="i-icon x-twitter"></i></a>
          <a href="https://discord.gg/ZVG8hN6RrJ/" aria-label="Discord"><i class="i-icon discord"></i></a>
          <a href="https://youtube.com/@monorepo" aria-label="YouTube"><i class="i-icon youtube"></i></a>
      </div>
    </div>
  </div>
</footer></div>
      <script src="../../../_static/documentation_options.js?v=8dde47fa"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../../_static/shibuya.js?v=3e5c8598"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    
</body>
</html>