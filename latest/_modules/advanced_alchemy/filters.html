<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>advanced_alchemy.filters - Docs</title>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />
  <script>
    const isDarkTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const sessionTheme = sessionStorage['_theme']
    if (sessionTheme) {
      document.documentElement.classList.add(sessionTheme)
    } else if (isDarkTheme) {
      document.documentElement.classList.add('dark')
    }
  </script><link rel="shortcut icon" href="../../_static/badge.svg"/><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=aecf457f" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=28c32440" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=ee381b95" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=80d31e7b" />
    <style>
:root {
  --sy-f-sys:-apple-system, BlinkMacSystemFont, Segoe UI, Oxygen, Ubuntu, Droid Sans, Helvetica Neue;--sy-f-cjk:PingFang SC, Hiragino Sans GB, Droid Sans Fallback, Microsoft YaHei;--sy-f-heading:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-text:var(--sy-f-sys), var(--sy-f-cjk), sans-serif;--sy-f-mono:Menlo, Monaco, Consolas, "Courier New", monospace;--sy-c-divider:rgba(var(--sy-rc-text), 0.1);--sy-c-divider-weak:rgba(var(--sy-rc-text), 0.05);--sy-c-border:rgba(var(--sy-rc-text), 0.14);--sy-s-banner-height:0rem;--sy-s-navbar-height:56px;--sy-s-offset-top:calc(var(--sy-s-navbar-height) + var(--sy-s-banner-height));--sy-c-link:rgb(var(--sy-rc-theme));--sy-c-link-weak:rgba(var(--sy-rc-theme), 0.86);
  --sy-rc-theme:66, 177, 168;--sy-rc-bg:255, 255, 255;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#fff;--sy-c-bg-weak:12, 12, 12;--sy-c-text:#0C0C0C;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#0C0C0C;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#42B1A8;
}
@media (prefers-color-scheme: light) {
  :root {
    --sy-rc-theme:66, 177, 168;--sy-rc-bg:255, 255, 255;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#fff;--sy-c-bg-weak:12, 12, 12;--sy-c-text:#0C0C0C;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#0C0C0C;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#42B1A8;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --sy-rc-theme:66, 177, 168;--sy-rc-bg:12, 12, 12;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#42B1A8;--sy-c-bg-weak:#0C0C0C;--sy-c-text:#EBEBE9;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#EBEBE9;--sy-c-foot-bg:#0C0C0C;--sy-c-foot-divider:#42B1A8;
  }
}
html.light {
  --sy-rc-theme:66, 177, 168;--sy-rc-bg:255, 255, 255;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#fff;--sy-c-bg-weak:12, 12, 12;--sy-c-text:#0C0C0C;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#0C0C0C;--sy-c-foot-bg:#fafafa;--sy-c-foot-divider:#42B1A8;
}
html.dark {
  --sy-rc-theme:66, 177, 168;--sy-rc-bg:12, 12, 12;--sy-rc-invert:66, 177, 168;--sy-rc-text:66, 177, 168;--sy-c-bg:#42B1A8;--sy-c-bg-weak:#0C0C0C;--sy-c-text:#EBEBE9;--sy-c-text-weak:#42B1A8;--sy-c-heading:#42B1A8;--sy-c-bold:#42B1A8;--sy-c-foot-text:#EBEBE9;--sy-c-foot-bg:#0C0C0C;--sy-c-foot-divider:#42B1A8;
}
</style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-heading: Inter, var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="advanced_alchemy.filters"/>
<meta name="twitter:card" content="summary"/></head>
<body><div class="document"><div class="announcement">
    <div class="announcement-inner">
      <p>This documentation is currently under development.</p>
      <button class="announcement-close" aria-label="Close announcement">
        <i class="i-icon close"></i>
      </button>
    </div>
  </div><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand mr-4" href="/">
      <img class="light-logo" src="../../_static/badge.svg" alt="byte-bot" height="28" />
      <img class="dark-logo" src="../../_static/badge.svg" alt="byte-bot" height="28" />
      <strong>byte-bot</strong>
    </a>
    <div class="sy-head-links" id="NavLinks">
      <nav class="sy-head-nav">

<ul><li class="link">
          <a href="https://byte-bot.app/"><span>Dashboard</span><i class="i-icon external-link"></i></a>
        </li><li class="link">
          <a href="https://github.com/sponsors/JacobCoffee"><span>Sponsor me</span><i class="i-icon external-link"></i></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form>
        
        
        <div class="sy-head-social flex items-center">
            <a class="flex items-center" href="https://github.com/JacobCoffee/byte-bot" aria-label="GitHub">
              <i class="i-icon github"></i>
            </a>
            <a class="flex items-center" href="https://discord.gg/ZVG8hN6RrJ/" aria-label="Discord">
              <i class="i-icon discord"></i>
            </a>
        </div>
      </div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden">
      <button class="js-theme theme-switch flex items-center" data-aria-light="Switch to dark mode" data-aria-dark="Switch to light mode">
        <i class="i-icon theme-icon"></i>
      </button>
      <button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="NavLinks" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading"><span class="caption-text">Byte Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../byte/usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../byte/usage/byte.html">About Byte</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../byte/usage/starting.html">Starting Byte</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../byte/api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../byte/api/bot.html">bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../byte/api/plugins/index.html">plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/plugins/admin.html">admin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/plugins/astral.html">astral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/plugins/events.html">events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/plugins/general.html">general</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/plugins/github.html">github</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/plugins/testing.html">testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/plugins/python.html">python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../byte/api/views/index.html">views</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/views/forums.html">forums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/views/astral.html">astral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/views/python.html">python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/views/abstract.html">abstract</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../byte/api/lib/index.html">lib</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/lib/common.html">common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/lib/logging.html">logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/lib/settings.html">settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../byte/api/lib/utils.html">utils</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Web Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../web/usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../web/usage/server.html">About the Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../web/usage/starting.html">Starting Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../web/api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../web/api/app.html">app</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../web/api/cli.html">cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../web/api/metadata.html">metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../web/api/utils.html">utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../web/api/domain/index.html">domain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/domain/init.html">Domain Initializer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/domain/urls.html">urls</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/domain/system/index.html">system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/system/controllers.html">controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/system/dtos.html">dtos</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/system/helpers.html">helpers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/domain/guilds/index.html">guilds</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/guilds/controllers.html">controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/guilds/dependencies.html">dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/guilds/helpers.html">helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/guilds/schemas.html">schemas</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/guilds/services.html">services</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/guilds/urls.html">urls</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/domain/github/index.html">github</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/github/helpers.html">helpers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/domain/web/index.html">web</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/web/controllers.html">controllers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/domain/db/index.html">Database</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/domain/db/models.html">models</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../web/api/lib/index.html">lib</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/constants.html">constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/cors.html">cors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/dependencies.html">dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/dtos.html">dtos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/exceptions.html">exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/openapi.html">openapi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/schema.html">schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/serialization.html">serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/settings.html">settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/static_files.html">static files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/types.html">types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/template.html">template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/log/index.html">logging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/lib/log/controller.html">controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/lib/log/init.html">init</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/lib/log/utils.html">utils</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../web/api/lib/db/index.html">Database Library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/lib/db/base.html">base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web/api/lib/db/orm.html">orm</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contribution-guide.html">Contribution guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
      
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-icon close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/JacobCoffee/byte"
  data-type="github" data-user="JacobCoffee" data-repo="byte">
  <span class="w-8 flex items-center justify-around shrink-0 text-2xl">
    <i class="i-icon github"></i>
  </span>
  <span class="flex-grow px-2">
    <span>JacobCoffee/byte</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <i class="i-icon star"></i>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <i class="i-icon git-fork"></i>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
    <div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-icon menu"></i>
      </button>
    </div>
    <ul class="flex-1">
      
      
      <li><a href="../../index.html">byte-bot</a><span>/</span></li>
      
      <li><a href="../index.html">Module code</a><span>/</span></li>
      
      <li><strong>advanced_alchemy.filters</strong></li>
      
      
    </ul>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-icon outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for advanced_alchemy.filters</h1><div class="highlight"><pre>
<span></span><span id="1-1"><span class="sd">&quot;&quot;&quot;SQLAlchemy filter constructs for advanced query operations.</span>
</span><span id="1-2">
</span><span id="1-3"><span class="sd">This module provides a comprehensive collection of filter datastructures designed to</span>
</span><span id="1-4"><span class="sd">enhance SQLAlchemy query construction. It implements type-safe, reusable filter patterns</span>
</span><span id="1-5"><span class="sd">for common database query operations.</span>
</span><span id="1-6">
</span><span id="1-7"><span class="sd">Features:</span>
</span><span id="1-8"><span class="sd">    Type-safe filter construction, datetime range filtering, collection-based filtering,</span>
</span><span id="1-9"><span class="sd">    pagination support, search operations, and customizable ordering.</span>
</span><span id="1-10">
</span><span id="1-11"><span class="sd">Note:</span>
</span><span id="1-12"><span class="sd">    All filter classes implement the :class:`StatementFilter` ABC, ensuring consistent</span>
</span><span id="1-13"><span class="sd">    interface across different filter types.</span>
</span><span id="1-14">
</span><span id="1-15"><span class="sd">See Also:</span>
</span><span id="1-16"><span class="sd">    - :class:`sqlalchemy.sql.expression.Select`: Core SQLAlchemy select expression</span>
</span><span id="1-17"><span class="sd">    - :class:`sqlalchemy.orm.Query`: SQLAlchemy ORM query interface</span>
</span><span id="1-18"><span class="sd">    - :mod:`advanced_alchemy.base`: Base model definitions</span>
</span><span id="1-19">
</span><span id="1-20"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-21">
</span><span id="1-22"><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="1-23"><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="1-24"><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
</span><span id="1-25"><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Collection</span>
</span><span id="1-26"><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="1-27"><span class="kn">from</span><span class="w"> </span><span class="nn">operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">attrgetter</span>
</span><span id="1-28"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="1-29">    <span class="n">Any</span><span class="p">,</span>
</span><span id="1-30">    <span class="n">Callable</span><span class="p">,</span>
</span><span id="1-31">    <span class="n">ClassVar</span><span class="p">,</span>
</span><span id="1-32">    <span class="n">Generic</span><span class="p">,</span>
</span><span id="1-33">    <span class="n">Literal</span><span class="p">,</span>
</span><span id="1-34">    <span class="n">Optional</span><span class="p">,</span>
</span><span id="1-35">    <span class="n">Union</span><span class="p">,</span>
</span><span id="1-36">    <span class="n">cast</span><span class="p">,</span>
</span><span id="1-37"><span class="p">)</span>
</span><span id="1-38">
</span><span id="1-39"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="1-40">    <span class="n">BinaryExpression</span><span class="p">,</span>
</span><span id="1-41">    <span class="n">ColumnElement</span><span class="p">,</span>
</span><span id="1-42">    <span class="n">Date</span><span class="p">,</span>
</span><span id="1-43">    <span class="n">Delete</span><span class="p">,</span>
</span><span id="1-44">    <span class="n">Select</span><span class="p">,</span>
</span><span id="1-45">    <span class="n">Update</span><span class="p">,</span>
</span><span id="1-46">    <span class="n">and_</span><span class="p">,</span>
</span><span id="1-47">    <span class="n">any_</span><span class="p">,</span>
</span><span id="1-48">    <span class="n">exists</span><span class="p">,</span>
</span><span id="1-49">    <span class="n">false</span><span class="p">,</span>
</span><span id="1-50">    <span class="n">not_</span><span class="p">,</span>
</span><span id="1-51">    <span class="n">or_</span><span class="p">,</span>
</span><span id="1-52">    <span class="n">select</span><span class="p">,</span>
</span><span id="1-53">    <span class="n">text</span><span class="p">,</span>
</span><span id="1-54">    <span class="n">true</span><span class="p">,</span>
</span><span id="1-55"><span class="p">)</span>
</span><span id="1-56"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">InstrumentedAttribute</span>
</span><span id="1-57"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">operators</span> <span class="k">as</span> <span class="n">op</span>
</span><span id="1-58"><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.sql.dml</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReturningDelete</span><span class="p">,</span> <span class="n">ReturningUpdate</span>
</span><span id="1-59"><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeAlias</span><span class="p">,</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">TypeVar</span>
</span><span id="1-60">
</span><span id="1-61"><span class="kn">from</span><span class="w"> </span><span class="nn">advanced_alchemy.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelProtocol</span>
</span><span id="1-62">
</span><span id="1-63"><span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-64">    <span class="s2">&quot;BeforeAfter&quot;</span><span class="p">,</span>
</span><span id="1-65">    <span class="s2">&quot;CollectionFilter&quot;</span><span class="p">,</span>
</span><span id="1-66">    <span class="s2">&quot;ComparisonFilter&quot;</span><span class="p">,</span>
</span><span id="1-67">    <span class="s2">&quot;ExistsFilter&quot;</span><span class="p">,</span>
</span><span id="1-68">    <span class="s2">&quot;FilterGroup&quot;</span><span class="p">,</span>
</span><span id="1-69">    <span class="s2">&quot;FilterMap&quot;</span><span class="p">,</span>
</span><span id="1-70">    <span class="s2">&quot;FilterTypes&quot;</span><span class="p">,</span>
</span><span id="1-71">    <span class="s2">&quot;InAnyFilter&quot;</span><span class="p">,</span>
</span><span id="1-72">    <span class="s2">&quot;LimitOffset&quot;</span><span class="p">,</span>
</span><span id="1-73">    <span class="s2">&quot;LogicalOperatorMap&quot;</span><span class="p">,</span>
</span><span id="1-74">    <span class="s2">&quot;MultiFilter&quot;</span><span class="p">,</span>
</span><span id="1-75">    <span class="s2">&quot;NotExistsFilter&quot;</span><span class="p">,</span>
</span><span id="1-76">    <span class="s2">&quot;NotInCollectionFilter&quot;</span><span class="p">,</span>
</span><span id="1-77">    <span class="s2">&quot;NotInSearchFilter&quot;</span><span class="p">,</span>
</span><span id="1-78">    <span class="s2">&quot;OnBeforeAfter&quot;</span><span class="p">,</span>
</span><span id="1-79">    <span class="s2">&quot;OrderBy&quot;</span><span class="p">,</span>
</span><span id="1-80">    <span class="s2">&quot;PaginationFilter&quot;</span><span class="p">,</span>
</span><span id="1-81">    <span class="s2">&quot;SearchFilter&quot;</span><span class="p">,</span>
</span><span id="1-82">    <span class="s2">&quot;StatementFilter&quot;</span><span class="p">,</span>
</span><span id="1-83">    <span class="s2">&quot;StatementFilterT&quot;</span><span class="p">,</span>
</span><span id="1-84">    <span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span>
</span><span id="1-85"><span class="p">)</span>
</span><span id="1-86">
</span><span id="1-87"><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
</span><span id="1-88"><span class="n">ModelT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;ModelT&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">ModelProtocol</span><span class="p">)</span>
</span><span id="1-89"><span class="n">StatementFilterT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;StatementFilterT&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;StatementFilter&quot;</span><span class="p">)</span>
</span><span id="1-90"><span class="n">StatementTypeT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span>
</span><span id="1-91">    <span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span>
</span><span id="1-92">    <span class="n">bound</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span>
</span><span id="1-93">        <span class="n">ReturningDelete</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">ReturningUpdate</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">Select</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">Select</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Update</span><span class="p">,</span> <span class="n">Delete</span>
</span><span id="1-94">    <span class="p">],</span>
</span><span id="1-95"><span class="p">)</span>
</span><span id="1-96">
</span><span id="1-97"><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;advanced_alchemy&quot;</span><span class="p">)</span>
</span><span id="1-98">
</span><span id="1-99">
</span><span id="1-100"><span class="c1"># Define TypedDicts for filter and logical maps</span>
</span><span id="1-101"><span class="k">class</span><span class="w"> </span><span class="nc">FilterMap</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
</span><span id="1-102">    <span class="n">before_after</span><span class="p">:</span> <span class="s2">&quot;type[BeforeAfter]&quot;</span>
</span><span id="1-103">    <span class="n">on_before_after</span><span class="p">:</span> <span class="s2">&quot;type[OnBeforeAfter]&quot;</span>
</span><span id="1-104">    <span class="n">collection</span><span class="p">:</span> <span class="s2">&quot;type[CollectionFilter[Any]]&quot;</span>
</span><span id="1-105">    <span class="n">not_in_collection</span><span class="p">:</span> <span class="s2">&quot;type[NotInCollectionFilter[Any]]&quot;</span>
</span><span id="1-106">    <span class="n">limit_offset</span><span class="p">:</span> <span class="s2">&quot;type[LimitOffset]&quot;</span>
</span><span id="1-107">    <span class="n">order_by</span><span class="p">:</span> <span class="s2">&quot;type[OrderBy]&quot;</span>
</span><span id="1-108">    <span class="n">search</span><span class="p">:</span> <span class="s2">&quot;type[SearchFilter]&quot;</span>
</span><span id="1-109">    <span class="n">not_in_search</span><span class="p">:</span> <span class="s2">&quot;type[NotInSearchFilter]&quot;</span>
</span><span id="1-110">    <span class="n">comparison</span><span class="p">:</span> <span class="s2">&quot;type[ComparisonFilter]&quot;</span>
</span><span id="1-111">    <span class="n">exists</span><span class="p">:</span> <span class="s2">&quot;type[ExistsFilter]&quot;</span>
</span><span id="1-112">    <span class="n">not_exists</span><span class="p">:</span> <span class="s2">&quot;type[NotExistsFilter]&quot;</span>
</span><span id="1-113">    <span class="n">filter_group</span><span class="p">:</span> <span class="s2">&quot;type[FilterGroup]&quot;</span>
</span><span id="1-114">
</span><span id="1-115">
</span><span id="1-116"><span class="k">class</span><span class="w"> </span><span class="nc">LogicalOperatorMap</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
</span><span id="1-117">    <span class="n">and_</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
</span><span id="1-118">    <span class="n">or_</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
</span><span id="1-119">
</span><span id="1-120">
</span><span id="1-121"><span class="k">class</span><span class="w"> </span><span class="nc">StatementFilter</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="1-122"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for SQLAlchemy statement filters.</span>
</span><span id="1-123">
</span><span id="1-124"><span class="sd">    This class defines the interface for all filter types in the system. Each filter</span>
</span><span id="1-125"><span class="sd">    implementation must provide a method to append its filtering logic to an existing</span>
</span><span id="1-126"><span class="sd">    SQLAlchemy statement.</span>
</span><span id="1-127"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-128">
</span><span id="1-129">    <span class="nd">@abstractmethod</span>
</span><span id="1-130">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span>
</span><span id="1-131">        <span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-132">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-133"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append filter conditions to a SQLAlchemy statement.</span>
</span><span id="1-134">
</span><span id="1-135"><span class="sd">        Args:</span>
</span><span id="1-136"><span class="sd">            statement: The SQLAlchemy statement to modify</span>
</span><span id="1-137"><span class="sd">            model: The SQLAlchemy model class</span>
</span><span id="1-138"><span class="sd">            *args: Additional positional arguments</span>
</span><span id="1-139"><span class="sd">            **kwargs: Additional keyword arguments</span>
</span><span id="1-140">
</span><span id="1-141"><span class="sd">        Returns:</span>
</span><span id="1-142"><span class="sd">            StatementTypeT: Modified SQLAlchemy statement with filter conditions applied</span>
</span><span id="1-143">
</span><span id="1-144"><span class="sd">        Raises:</span>
</span><span id="1-145"><span class="sd">            NotImplementedError: If the concrete class doesn&#39;t implement this method</span>
</span><span id="1-146">
</span><span id="1-147"><span class="sd">        Note:</span>
</span><span id="1-148"><span class="sd">            This method must be implemented by all concrete filter classes.</span>
</span><span id="1-149">
</span><span id="1-150"><span class="sd">        See Also:</span>
</span><span id="1-151"><span class="sd">            :meth:`sqlalchemy.sql.expression.Select.where`: SQLAlchemy where clause</span>
</span><span id="1-152"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-153">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-154">
</span><span id="1-155">    <span class="nd">@staticmethod</span>
</span><span id="1-156">    <span class="k">def</span><span class="w"> </span><span class="nf">_get_instrumented_attr</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InstrumentedAttribute</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">InstrumentedAttribute</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="1-157"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get SQLAlchemy instrumented attribute from model.</span>
</span><span id="1-158">
</span><span id="1-159"><span class="sd">        Args:</span>
</span><span id="1-160"><span class="sd">            model: SQLAlchemy model class or instance</span>
</span><span id="1-161"><span class="sd">            key: Attribute name or instrumented attribute</span>
</span><span id="1-162">
</span><span id="1-163"><span class="sd">        Returns:</span>
</span><span id="1-164"><span class="sd">            InstrumentedAttribute[Any]: SQLAlchemy instrumented attribute</span>
</span><span id="1-165">
</span><span id="1-166"><span class="sd">        See Also:</span>
</span><span id="1-167"><span class="sd">            :class:`sqlalchemy.orm.attributes.InstrumentedAttribute`: SQLAlchemy attribute</span>
</span><span id="1-168"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-169">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-170">            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;InstrumentedAttribute[Any]&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
</span><span id="1-171">        <span class="k">return</span> <span class="n">key</span>
</span><span id="1-172">
</span><span id="1-173">
<div class="viewcode-block" id="BeforeAfter">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.BeforeAfter">[docs]</a>
</span><span id="1-174"><span class="nd">@dataclass</span>
</span><span id="1-175"><span class="k">class</span><span class="w"> </span><span class="nc">BeforeAfter</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">):</span>
</span><span id="1-176"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DateTime range filter with exclusive bounds.</span>
</span><span id="1-177">
</span><span id="1-178"><span class="sd">    This filter creates date/time range conditions using &lt; and &gt; operators,</span>
</span><span id="1-179"><span class="sd">    excluding the boundary values.</span>
</span><span id="1-180">
</span><span id="1-181"><span class="sd">    If either `before` or `after` is None, that boundary condition is not applied.</span>
</span><span id="1-182">
</span><span id="1-183"><span class="sd">    See Also:</span>
</span><span id="1-184"><span class="sd">    ---------</span>
</span><span id="1-185"><span class="sd">        :class:`OnBeforeAfter` : Inclusive datetime range filtering</span>
</span><span id="1-186">
</span><span id="1-187"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-188">
</span><span id="1-189">    <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-190"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the model attribute to filter on.&quot;&quot;&quot;</span>
</span><span id="1-191">    <span class="n">before</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span>
</span><span id="1-192"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter results where field is earlier than this value.&quot;&quot;&quot;</span>
</span><span id="1-193">    <span class="n">after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span>
</span><span id="1-194"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter results where field is later than this value.&quot;&quot;&quot;</span>
</span><span id="1-195">
<div class="viewcode-block" id="BeforeAfter.append_to_statement">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.BeforeAfter.append_to_statement">[docs]</a>
</span><span id="1-196">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-197"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply datetime range conditions to statement.</span>
</span><span id="1-198">
</span><span id="1-199"><span class="sd">        Parameters</span>
</span><span id="1-200"><span class="sd">        ----------</span>
</span><span id="1-201"><span class="sd">        statement : StatementTypeT</span>
</span><span id="1-202"><span class="sd">            The SQLAlchemy statement to modify</span>
</span><span id="1-203"><span class="sd">        model : type[ModelT]</span>
</span><span id="1-204"><span class="sd">            The SQLAlchemy model class</span>
</span><span id="1-205">
</span><span id="1-206"><span class="sd">        Returns:</span>
</span><span id="1-207"><span class="sd">        --------</span>
</span><span id="1-208"><span class="sd">        StatementTypeT</span>
</span><span id="1-209"><span class="sd">            Modified statement with datetime range conditions</span>
</span><span id="1-210"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-211">        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instrumented_attr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="1-212">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-213">            <span class="n">statement</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">before</span><span class="p">))</span>
</span><span id="1-214">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-215">            <span class="n">statement</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">after</span><span class="p">))</span>
</span><span id="1-216">        <span class="k">return</span> <span class="n">statement</span></div>
</div>

</span><span id="1-217">
</span><span id="1-218">
</span><span id="1-219"><span class="nd">@dataclass</span>
</span><span id="1-220"><span class="k">class</span><span class="w"> </span><span class="nc">OnBeforeAfter</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">):</span>
</span><span id="1-221"><span class="w">    </span><span class="sd">&quot;&quot;&quot;DateTime range filter with inclusive bounds.</span>
</span><span id="1-222">
</span><span id="1-223"><span class="sd">    This filter creates date/time range conditions using &lt;= and &gt;= operators,</span>
</span><span id="1-224"><span class="sd">    including the boundary values.</span>
</span><span id="1-225">
</span><span id="1-226"><span class="sd">    If either `on_or_before` or `on_or_after` is None, that boundary condition</span>
</span><span id="1-227"><span class="sd">    is not applied.</span>
</span><span id="1-228">
</span><span id="1-229"><span class="sd">    See Also:</span>
</span><span id="1-230"><span class="sd">    ---------</span>
</span><span id="1-231"><span class="sd">        :class:`BeforeAfter` : Exclusive datetime range filtering</span>
</span><span id="1-232">
</span><span id="1-233"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-234">
</span><span id="1-235">    <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-236"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the model attribute to filter on.&quot;&quot;&quot;</span>
</span><span id="1-237">    <span class="n">on_or_before</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span>
</span><span id="1-238"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter results where field is on or earlier than this value.&quot;&quot;&quot;</span>
</span><span id="1-239">    <span class="n">on_or_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span>
</span><span id="1-240"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter results where field is on or later than this value.&quot;&quot;&quot;</span>
</span><span id="1-241">
</span><span id="1-242">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-243"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply inclusive datetime range conditions to statement.</span>
</span><span id="1-244">
</span><span id="1-245"><span class="sd">        Parameters</span>
</span><span id="1-246"><span class="sd">        ----------</span>
</span><span id="1-247"><span class="sd">        statement : StatementTypeT</span>
</span><span id="1-248"><span class="sd">            The SQLAlchemy statement to modify</span>
</span><span id="1-249"><span class="sd">        model : type[ModelT]</span>
</span><span id="1-250"><span class="sd">            The SQLAlchemy model class</span>
</span><span id="1-251">
</span><span id="1-252"><span class="sd">        Returns:</span>
</span><span id="1-253"><span class="sd">        --------</span>
</span><span id="1-254"><span class="sd">        StatementTypeT</span>
</span><span id="1-255"><span class="sd">            Modified statement with inclusive datetime range conditions</span>
</span><span id="1-256"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-257">        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instrumented_attr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="1-258">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_or_before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-259">            <span class="n">statement</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_or_before</span><span class="p">))</span>
</span><span id="1-260">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_or_after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-261">            <span class="n">statement</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_or_after</span><span class="p">))</span>
</span><span id="1-262">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-263">
</span><span id="1-264">
</span><span id="1-265"><span class="k">class</span><span class="w"> </span><span class="nc">InAnyFilter</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
</span><span id="1-266"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for filters using IN or ANY operators.</span>
</span><span id="1-267">
</span><span id="1-268"><span class="sd">    This abstract class provides common functionality for filters that check</span>
</span><span id="1-269"><span class="sd">    membership in a collection using either the SQL IN operator or the ANY operator.</span>
</span><span id="1-270"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-271">
</span><span id="1-272">
<div class="viewcode-block" id="CollectionFilter">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.CollectionFilter">[docs]</a>
</span><span id="1-273"><span class="nd">@dataclass</span>
</span><span id="1-274"><span class="k">class</span><span class="w"> </span><span class="nc">CollectionFilter</span><span class="p">(</span><span class="n">InAnyFilter</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="1-275"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Data required to construct a WHERE ... IN (...) clause.</span>
</span><span id="1-276">
</span><span id="1-277"><span class="sd">    This filter restricts records based on a field&#39;s presence in a collection of values.</span>
</span><span id="1-278">
</span><span id="1-279"><span class="sd">    The filter supports both ``IN`` and ``ANY`` operators for collection membership testing.</span>
</span><span id="1-280"><span class="sd">    Use ``prefer_any=True`` in ``append_to_statement`` to use the ``ANY`` operator.</span>
</span><span id="1-281"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-282">
</span><span id="1-283">    <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-284"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the model attribute to filter on.&quot;&quot;&quot;</span>
</span><span id="1-285">    <span class="n">values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="1-286"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Values for the ``IN`` clause. If this is None, no filter is applied.</span>
</span><span id="1-287"><span class="sd">        An empty list will force an empty result set (WHERE 1=-1)&quot;&quot;&quot;</span>
</span><span id="1-288">
<div class="viewcode-block" id="CollectionFilter.append_to_statement">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.CollectionFilter.append_to_statement">[docs]</a>
</span><span id="1-289">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span>
</span><span id="1-290">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-291">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span>
</span><span id="1-292">        <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span>
</span><span id="1-293">        <span class="n">prefer_any</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-294">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-295"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a WHERE ... IN or WHERE ... ANY (...) clause to the statement.</span>
</span><span id="1-296">
</span><span id="1-297"><span class="sd">        Parameters</span>
</span><span id="1-298"><span class="sd">        ----------</span>
</span><span id="1-299"><span class="sd">        statement : StatementTypeT</span>
</span><span id="1-300"><span class="sd">            The SQLAlchemy statement to modify</span>
</span><span id="1-301"><span class="sd">        model : type[ModelT]</span>
</span><span id="1-302"><span class="sd">            The SQLAlchemy model class</span>
</span><span id="1-303"><span class="sd">        prefer_any : bool, optional</span>
</span><span id="1-304"><span class="sd">            If True, uses the SQLAlchemy :func:`any_` operator instead of</span>
</span><span id="1-305"><span class="sd">            :func:`in_` for the filter condition</span>
</span><span id="1-306">
</span><span id="1-307"><span class="sd">        Returns:</span>
</span><span id="1-308"><span class="sd">        --------</span>
</span><span id="1-309"><span class="sd">        StatementTypeT</span>
</span><span id="1-310"><span class="sd">            Modified statement with the appropriate IN conditions</span>
</span><span id="1-311"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-312">        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instrumented_attr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="1-313">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-314">            <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-315">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="1-316">            <span class="c1"># Return empty result set by forcing a false condition</span>
</span><span id="1-317">            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;1=-1&quot;</span><span class="p">)))</span>
</span><span id="1-318">        <span class="k">if</span> <span class="n">prefer_any</span><span class="p">:</span>
</span><span id="1-319">            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">any_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">field</span><span class="p">))</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="1-320">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span></div>
</div>

</span><span id="1-321">
</span><span id="1-322">
</span><span id="1-323"><span class="nd">@dataclass</span>
</span><span id="1-324"><span class="k">class</span><span class="w"> </span><span class="nc">NotInCollectionFilter</span><span class="p">(</span><span class="n">InAnyFilter</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="1-325"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Data required to construct a WHERE ... NOT IN (...) clause.</span>
</span><span id="1-326">
</span><span id="1-327"><span class="sd">    This filter restricts records based on a field&#39;s absence in a collection of values.</span>
</span><span id="1-328">
</span><span id="1-329"><span class="sd">    The filter supports both ``NOT IN`` and ``!= ANY`` operators for collection exclusion.</span>
</span><span id="1-330"><span class="sd">    Use ``prefer_any=True`` in ``append_to_statement`` to use the ``ANY`` operator.</span>
</span><span id="1-331">
</span><span id="1-332"><span class="sd">    Parameters</span>
</span><span id="1-333"><span class="sd">    ----------</span>
</span><span id="1-334"><span class="sd">    field_name : str</span>
</span><span id="1-335"><span class="sd">        Name of the model attribute to filter on</span>
</span><span id="1-336"><span class="sd">    values : abc.Collection[T] | None</span>
</span><span id="1-337"><span class="sd">        Values for the ``NOT IN`` clause. If this is None or empty,</span>
</span><span id="1-338"><span class="sd">        the filter is not applied.</span>
</span><span id="1-339">
</span><span id="1-340"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-341">
</span><span id="1-342">    <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-343"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the model attribute to filter on.&quot;&quot;&quot;</span>
</span><span id="1-344">    <span class="n">values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="1-345"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Values for the ``NOT IN`` clause. If None or empty, no filter is applied.&quot;&quot;&quot;</span>
</span><span id="1-346">
</span><span id="1-347">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span>
</span><span id="1-348">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-349">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span>
</span><span id="1-350">        <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span>
</span><span id="1-351">        <span class="n">prefer_any</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-352">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-353"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a WHERE ... NOT IN or WHERE ... != ANY(...) clause to the statement.</span>
</span><span id="1-354">
</span><span id="1-355"><span class="sd">        Parameters</span>
</span><span id="1-356"><span class="sd">        ----------</span>
</span><span id="1-357"><span class="sd">        statement : StatementTypeT</span>
</span><span id="1-358"><span class="sd">            The SQLAlchemy statement to modify</span>
</span><span id="1-359"><span class="sd">        model : type[ModelT]</span>
</span><span id="1-360"><span class="sd">            The SQLAlchemy model class</span>
</span><span id="1-361"><span class="sd">        prefer_any : bool, optional</span>
</span><span id="1-362"><span class="sd">            If True, uses the SQLAlchemy :func:`any_` operator instead of</span>
</span><span id="1-363"><span class="sd">            :func:`notin_` for the filter condition</span>
</span><span id="1-364">
</span><span id="1-365"><span class="sd">        Returns:</span>
</span><span id="1-366"><span class="sd">        --------</span>
</span><span id="1-367"><span class="sd">        StatementTypeT</span>
</span><span id="1-368"><span class="sd">            Modified statement with the appropriate NOT IN conditions</span>
</span><span id="1-369"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-370">        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instrumented_attr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="1-371">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="1-372">            <span class="c1"># If None or empty, we do not modify the statement</span>
</span><span id="1-373">            <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-374">        <span class="k">if</span> <span class="n">prefer_any</span><span class="p">:</span>
</span><span id="1-375">            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">any_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="n">field</span><span class="p">))</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="1-376">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">notin_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
</span><span id="1-377">
</span><span id="1-378">
</span><span id="1-379"><span class="k">class</span><span class="w"> </span><span class="nc">PaginationFilter</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
</span><span id="1-380"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for pagination filters.</span>
</span><span id="1-381">
</span><span id="1-382"><span class="sd">    Subclasses should implement pagination logic, such as limit/offset or</span>
</span><span id="1-383"><span class="sd">    cursor-based pagination.</span>
</span><span id="1-384"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-385">
</span><span id="1-386">
<div class="viewcode-block" id="LimitOffset">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.LimitOffset">[docs]</a>
</span><span id="1-387"><span class="nd">@dataclass</span>
</span><span id="1-388"><span class="k">class</span><span class="w"> </span><span class="nc">LimitOffset</span><span class="p">(</span><span class="n">PaginationFilter</span><span class="p">):</span>
</span><span id="1-389"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Limit and offset pagination filter.</span>
</span><span id="1-390">
</span><span id="1-391"><span class="sd">    Implements traditional pagination using SQL LIMIT and OFFSET clauses.</span>
</span><span id="1-392"><span class="sd">    Only applies to SELECT statements; other statement types are returned unmodified.</span>
</span><span id="1-393">
</span><span id="1-394"><span class="sd">    Note:</span>
</span><span id="1-395"><span class="sd">        This filter only modifies SELECT statements. For other statement types</span>
</span><span id="1-396"><span class="sd">        (UPDATE, DELETE), the statement is returned unchanged.</span>
</span><span id="1-397">
</span><span id="1-398"><span class="sd">    See Also:</span>
</span><span id="1-399"><span class="sd">        - :meth:`sqlalchemy.sql.expression.Select.limit`: SQLAlchemy LIMIT clause</span>
</span><span id="1-400"><span class="sd">        - :meth:`sqlalchemy.sql.expression.Select.offset`: SQLAlchemy OFFSET clause</span>
</span><span id="1-401"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-402">
</span><span id="1-403">    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="1-404"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum number of rows to return.&quot;&quot;&quot;</span>
</span><span id="1-405">    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="1-406"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of rows to skip before returning results.&quot;&quot;&quot;</span>
</span><span id="1-407">
<div class="viewcode-block" id="LimitOffset.append_to_statement">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.LimitOffset.append_to_statement">[docs]</a>
</span><span id="1-408">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-409"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply LIMIT/OFFSET pagination to the statement.</span>
</span><span id="1-410">
</span><span id="1-411"><span class="sd">        Args:</span>
</span><span id="1-412"><span class="sd">            statement: The SQLAlchemy statement to modify</span>
</span><span id="1-413"><span class="sd">            model: The SQLAlchemy model class</span>
</span><span id="1-414">
</span><span id="1-415"><span class="sd">        Returns:</span>
</span><span id="1-416"><span class="sd">            StatementTypeT: Modified statement with limit and offset applied</span>
</span><span id="1-417">
</span><span id="1-418"><span class="sd">        Note:</span>
</span><span id="1-419"><span class="sd">            Only modifies SELECT statements. Other statement types are returned as-is.</span>
</span><span id="1-420">
</span><span id="1-421"><span class="sd">        See Also:</span>
</span><span id="1-422"><span class="sd">            :class:`sqlalchemy.sql.expression.Select`: SQLAlchemy SELECT statement</span>
</span><span id="1-423"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-424">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">Select</span><span class="p">):</span>
</span><span id="1-425">            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">)</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">))</span>
</span><span id="1-426">        <span class="k">return</span> <span class="n">statement</span></div>
</div>

</span><span id="1-427">
</span><span id="1-428">
<div class="viewcode-block" id="OrderBy">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.OrderBy">[docs]</a>
</span><span id="1-429"><span class="nd">@dataclass</span>
</span><span id="1-430"><span class="k">class</span><span class="w"> </span><span class="nc">OrderBy</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">):</span>
</span><span id="1-431"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Order by a specific field.</span>
</span><span id="1-432">
</span><span id="1-433"><span class="sd">    Appends an ORDER BY clause to SELECT statements, sorting records by the</span>
</span><span id="1-434"><span class="sd">    specified field in ascending or descending order.</span>
</span><span id="1-435">
</span><span id="1-436"><span class="sd">    Note:</span>
</span><span id="1-437"><span class="sd">        This filter only modifies SELECT statements. For other statement types,</span>
</span><span id="1-438"><span class="sd">        the statement is returned unchanged.</span>
</span><span id="1-439">
</span><span id="1-440"><span class="sd">    See Also:</span>
</span><span id="1-441"><span class="sd">        - :meth:`sqlalchemy.sql.expression.Select.order_by`: SQLAlchemy ORDER BY clause</span>
</span><span id="1-442"><span class="sd">        - :meth:`sqlalchemy.sql.expression.ColumnElement.asc`: Ascending order</span>
</span><span id="1-443"><span class="sd">        - :meth:`sqlalchemy.sql.expression.ColumnElement.desc`: Descending order</span>
</span><span id="1-444"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-445">
</span><span id="1-446">    <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-447"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the model attribute to sort on.&quot;&quot;&quot;</span>
</span><span id="1-448">    <span class="n">sort_order</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span> <span class="s2">&quot;desc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;asc&quot;</span>
</span><span id="1-449"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sort direction (&quot;asc&quot; or &quot;desc&quot;).&quot;&quot;&quot;</span>
</span><span id="1-450">
<div class="viewcode-block" id="OrderBy.append_to_statement">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.OrderBy.append_to_statement">[docs]</a>
</span><span id="1-451">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-452"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append an ORDER BY clause to the statement.</span>
</span><span id="1-453">
</span><span id="1-454"><span class="sd">        Args:</span>
</span><span id="1-455"><span class="sd">            statement: The SQLAlchemy statement to modify</span>
</span><span id="1-456"><span class="sd">            model: The SQLAlchemy model class</span>
</span><span id="1-457">
</span><span id="1-458"><span class="sd">        Returns:</span>
</span><span id="1-459"><span class="sd">            StatementTypeT: Modified statement with an ORDER BY clause</span>
</span><span id="1-460">
</span><span id="1-461"><span class="sd">        Note:</span>
</span><span id="1-462"><span class="sd">            Only modifies SELECT statements. Other statement types are returned as-is.</span>
</span><span id="1-463">
</span><span id="1-464"><span class="sd">        See Also:</span>
</span><span id="1-465"><span class="sd">            :meth:`sqlalchemy.sql.expression.Select.order_by`: SQLAlchemy ORDER BY</span>
</span><span id="1-466"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-467">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">Select</span><span class="p">):</span>
</span><span id="1-468">            <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-469">        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instrumented_attr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="1-470">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_order</span> <span class="o">==</span> <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
</span><span id="1-471">            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
</span><span id="1-472">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">asc</span><span class="p">()))</span></div>
</div>

</span><span id="1-473">
</span><span id="1-474">
<div class="viewcode-block" id="SearchFilter">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.SearchFilter">[docs]</a>
</span><span id="1-475"><span class="nd">@dataclass</span>
</span><span id="1-476"><span class="k">class</span><span class="w"> </span><span class="nc">SearchFilter</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">):</span>
</span><span id="1-477"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Case-sensitive or case-insensitive substring matching filter.</span>
</span><span id="1-478">
</span><span id="1-479"><span class="sd">    Implements text search using SQL LIKE or ILIKE operators. Can search across</span>
</span><span id="1-480"><span class="sd">    multiple fields using OR conditions.</span>
</span><span id="1-481">
</span><span id="1-482"><span class="sd">    Note:</span>
</span><span id="1-483"><span class="sd">        The search pattern automatically adds wildcards before and after the search</span>
</span><span id="1-484"><span class="sd">        value, equivalent to SQL pattern &#39;%value%&#39;.</span>
</span><span id="1-485">
</span><span id="1-486"><span class="sd">    See Also:</span>
</span><span id="1-487"><span class="sd">        - :class:`.NotInSearchFilter`: Opposite filter using NOT LIKE/ILIKE</span>
</span><span id="1-488"><span class="sd">        - :meth:`sqlalchemy.sql.expression.ColumnOperators.like`: Case-sensitive LIKE</span>
</span><span id="1-489"><span class="sd">        - :meth:`sqlalchemy.sql.expression.ColumnOperators.ilike`: Case-insensitive LIKE</span>
</span><span id="1-490"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-491">
</span><span id="1-492">    <span class="n">field_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</span><span id="1-493"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name or set of names of model attributes to search on.&quot;&quot;&quot;</span>
</span><span id="1-494">    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-495"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Text to match within the field(s).&quot;&quot;&quot;</span>
</span><span id="1-496">    <span class="n">ignore_case</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-497"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to use case-insensitive matching.&quot;&quot;&quot;</span>
</span><span id="1-498">
</span><span id="1-499">    <span class="nd">@property</span>
</span><span id="1-500">    <span class="k">def</span><span class="w"> </span><span class="nf">_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
</span><span id="1-501"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the SQL operator for combining multiple search clauses.</span>
</span><span id="1-502">
</span><span id="1-503"><span class="sd">        Returns:</span>
</span><span id="1-504"><span class="sd">            Callable[..., ColumnElement[bool]]: The `or_` operator for OR conditions</span>
</span><span id="1-505">
</span><span id="1-506"><span class="sd">        See Also:</span>
</span><span id="1-507"><span class="sd">            :func:`sqlalchemy.sql.expression.or_`: SQLAlchemy OR operator</span>
</span><span id="1-508"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-509">        <span class="k">return</span> <span class="n">or_</span>
</span><span id="1-510">
</span><span id="1-511">    <span class="nd">@property</span>
</span><span id="1-512">    <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;attrgetter[Callable[[str], BinaryExpression[bool]]]&quot;</span><span class="p">:</span>
</span><span id="1-513"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the appropriate LIKE or ILIKE operator as a function.</span>
</span><span id="1-514">
</span><span id="1-515"><span class="sd">        Returns:</span>
</span><span id="1-516"><span class="sd">            attrgetter: Bound method for LIKE or ILIKE operations</span>
</span><span id="1-517">
</span><span id="1-518"><span class="sd">        See Also:</span>
</span><span id="1-519"><span class="sd">            - :meth:`sqlalchemy.sql.expression.ColumnOperators.like`: LIKE operator</span>
</span><span id="1-520"><span class="sd">            - :meth:`sqlalchemy.sql.expression.ColumnOperators.ilike`: ILIKE operator</span>
</span><span id="1-521"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-522">        <span class="k">return</span> <span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;ilike&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_case</span> <span class="k">else</span> <span class="s2">&quot;like&quot;</span><span class="p">)</span>
</span><span id="1-523">
</span><span id="1-524">    <span class="nd">@property</span>
</span><span id="1-525">    <span class="k">def</span><span class="w"> </span><span class="nf">normalized_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="1-526"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert field_name to a set if it&#39;s a single string.</span>
</span><span id="1-527">
</span><span id="1-528"><span class="sd">        Returns:</span>
</span><span id="1-529"><span class="sd">            set[str]: Set of field names to be searched</span>
</span><span id="1-530"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-531">        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">}</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span>
</span><span id="1-532">
<div class="viewcode-block" id="SearchFilter.get_search_clauses">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.SearchFilter.get_search_clauses">[docs]</a>
</span><span id="1-533">    <span class="k">def</span><span class="w"> </span><span class="nf">get_search_clauses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">BinaryExpression</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
</span><span id="1-534"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the LIKE/ILIKE clauses for all specified fields.</span>
</span><span id="1-535">
</span><span id="1-536"><span class="sd">        Args:</span>
</span><span id="1-537"><span class="sd">            model: The SQLAlchemy model class</span>
</span><span id="1-538">
</span><span id="1-539"><span class="sd">        Returns:</span>
</span><span id="1-540"><span class="sd">            list[BinaryExpression[bool]]: List of text matching expressions</span>
</span><span id="1-541">
</span><span id="1-542"><span class="sd">        See Also:</span>
</span><span id="1-543"><span class="sd">            :class:`sqlalchemy.sql.expression.BinaryExpression`: SQLAlchemy expression</span>
</span><span id="1-544"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-545">        <span class="n">search_clause</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BinaryExpression</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-546">        <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_field_names</span><span class="p">:</span>
</span><span id="1-547">            <span class="k">try</span><span class="p">:</span>
</span><span id="1-548">                <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instrumented_attr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span><span id="1-549">                <span class="n">search_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;%</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="1-550">                <span class="n">search_clause</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">(</span><span class="n">field</span><span class="p">)(</span><span class="n">search_text</span><span class="p">))</span>
</span><span id="1-551">            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="1-552">                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Skipping search for field </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">.  It is not found in model </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="1-553">                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="1-554">                <span class="k">continue</span>
</span><span id="1-555">        <span class="k">return</span> <span class="n">search_clause</span></div>

</span><span id="1-556">
<div class="viewcode-block" id="SearchFilter.append_to_statement">
<a class="viewcode-back" href="../../web/api/lib/dependencies.html#byte_bot.server.lib.dependencies.SearchFilter.append_to_statement">[docs]</a>
</span><span id="1-557">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-558"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append a LIKE/ILIKE clause to the statement.</span>
</span><span id="1-559">
</span><span id="1-560"><span class="sd">        Args:</span>
</span><span id="1-561"><span class="sd">            statement: The SQLAlchemy statement to modify</span>
</span><span id="1-562"><span class="sd">            model: The SQLAlchemy model class</span>
</span><span id="1-563">
</span><span id="1-564"><span class="sd">        Returns:</span>
</span><span id="1-565"><span class="sd">            StatementTypeT: Modified statement with text search clauses</span>
</span><span id="1-566">
</span><span id="1-567"><span class="sd">        See Also:</span>
</span><span id="1-568"><span class="sd">            :meth:`sqlalchemy.sql.expression.Select.where`: SQLAlchemy WHERE clause</span>
</span><span id="1-569"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-570">        <span class="n">where_clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_search_clauses</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
</span><span id="1-571">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">where_clause</span><span class="p">))</span></div>
</div>

</span><span id="1-572">
</span><span id="1-573">
</span><span id="1-574"><span class="c1"># Regular typed dictionary for operators_map</span>
</span><span id="1-575"><span class="n">operators_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-576">    <span class="s2">&quot;eq&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
</span><span id="1-577">    <span class="s2">&quot;ne&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span>
</span><span id="1-578">    <span class="s2">&quot;gt&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">gt</span><span class="p">,</span>
</span><span id="1-579">    <span class="s2">&quot;ge&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">ge</span><span class="p">,</span>
</span><span id="1-580">    <span class="s2">&quot;lt&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span>
</span><span id="1-581">    <span class="s2">&quot;le&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">le</span><span class="p">,</span>
</span><span id="1-582">    <span class="s2">&quot;in&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">in_op</span><span class="p">,</span>
</span><span id="1-583">    <span class="s2">&quot;notin&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">notin_op</span><span class="p">,</span>
</span><span id="1-584">    <span class="s2">&quot;between&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="1-585">    <span class="s2">&quot;like&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">like_op</span><span class="p">,</span>
</span><span id="1-586">    <span class="s2">&quot;ilike&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">ilike_op</span><span class="p">,</span>
</span><span id="1-587">    <span class="s2">&quot;startswith&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">startswith_op</span><span class="p">,</span>
</span><span id="1-588">    <span class="s2">&quot;istartswith&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">),</span>
</span><span id="1-589">    <span class="s2">&quot;endswith&quot;</span><span class="p">:</span> <span class="n">op</span><span class="o">.</span><span class="n">endswith_op</span><span class="p">,</span>
</span><span id="1-590">    <span class="s2">&quot;iendswith&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">),</span>
</span><span id="1-591">    <span class="s2">&quot;dateeq&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="n">v</span><span class="p">,</span>
</span><span id="1-592"><span class="p">}</span>
</span><span id="1-593">
</span><span id="1-594"><span class="n">VALID_OPERATORS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">operators_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="1-595"><span class="sd">&quot;&quot;&quot;Set of valid operators that can be used in ComparisonFilter.&quot;&quot;&quot;</span>
</span><span id="1-596">
</span><span id="1-597">
</span><span id="1-598"><span class="nd">@dataclass</span>
</span><span id="1-599"><span class="k">class</span><span class="w"> </span><span class="nc">ComparisonFilter</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">):</span>
</span><span id="1-600"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple comparison filter for equality and inequality operations.</span>
</span><span id="1-601">
</span><span id="1-602"><span class="sd">    This filter applies basic comparison operators (=, !=, &gt;, &gt;=, &lt;, &lt;=) to a field.</span>
</span><span id="1-603"><span class="sd">    It provides a generic way to perform common comparison operations.</span>
</span><span id="1-604">
</span><span id="1-605"><span class="sd">    Args:</span>
</span><span id="1-606"><span class="sd">        field_name: Name of the model attribute to filter on</span>
</span><span id="1-607"><span class="sd">        operator: Comparison operator to use (must be one of: &#39;eq&#39;, &#39;ne&#39;, &#39;gt&#39;, &#39;ge&#39;, &#39;lt&#39;, &#39;le&#39;, &#39;in&#39;, &#39;notin&#39;, &#39;between&#39;, &#39;like&#39;, &#39;ilike&#39;, &#39;startswith&#39;, &#39;istartswith&#39;, &#39;endswith&#39;, &#39;iendswith&#39;, &#39;dateeq&#39;)</span>
</span><span id="1-608"><span class="sd">        value: Value to compare against</span>
</span><span id="1-609">
</span><span id="1-610"><span class="sd">    Raises:</span>
</span><span id="1-611"><span class="sd">        ValueError: If an invalid operator is provided</span>
</span><span id="1-612"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-613">
</span><span id="1-614">    <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-615"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the model attribute to filter on.&quot;&quot;&quot;</span>
</span><span id="1-616">    <span class="n">operator</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="1-617"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Comparison operator to use (one of &#39;eq&#39;, &#39;ne&#39;, &#39;gt&#39;, &#39;ge&#39;, &#39;lt&#39;, &#39;le&#39;).&quot;&quot;&quot;</span>
</span><span id="1-618">    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="1-619"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Value to compare against.&quot;&quot;&quot;</span>
</span><span id="1-620">
</span><span id="1-621">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-622"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a comparison operation to the statement.</span>
</span><span id="1-623">
</span><span id="1-624"><span class="sd">        Args:</span>
</span><span id="1-625"><span class="sd">            statement: The SQLAlchemy statement to modify</span>
</span><span id="1-626"><span class="sd">            model: The SQLAlchemy model class</span>
</span><span id="1-627">
</span><span id="1-628"><span class="sd">        Returns:</span>
</span><span id="1-629"><span class="sd">            StatementTypeT: Modified statement with the comparison condition</span>
</span><span id="1-630">
</span><span id="1-631"><span class="sd">        Raises:</span>
</span><span id="1-632"><span class="sd">            ValueError: If an invalid operator is provided</span>
</span><span id="1-633"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-634">        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instrumented_attr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="1-635">        <span class="n">operator_func</span> <span class="o">=</span> <span class="n">operators_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">)</span>
</span><span id="1-636">
</span><span id="1-637">        <span class="k">if</span> <span class="n">operator_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-638">            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid operator &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="si">}</span><span class="s2">&#39;. Must be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">VALID_OPERATORS</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="1-639">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="1-640">
</span><span id="1-641">        <span class="n">condition</span> <span class="o">=</span> <span class="n">operator_func</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-642">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span>
</span><span id="1-643">
</span><span id="1-644">
</span><span id="1-645"><span class="nd">@dataclass</span>
</span><span id="1-646"><span class="k">class</span><span class="w"> </span><span class="nc">NotInSearchFilter</span><span class="p">(</span><span class="n">SearchFilter</span><span class="p">):</span>
</span><span id="1-647"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter for excluding records that match a substring.</span>
</span><span id="1-648">
</span><span id="1-649"><span class="sd">    Implements negative text search using SQL NOT LIKE or NOT ILIKE operators.</span>
</span><span id="1-650"><span class="sd">    Can exclude across multiple fields using AND conditions.</span>
</span><span id="1-651">
</span><span id="1-652"><span class="sd">    Args:</span>
</span><span id="1-653"><span class="sd">        field_name: Name or set of names of model attributes to search on</span>
</span><span id="1-654"><span class="sd">        value: Text to exclude from the field(s)</span>
</span><span id="1-655"><span class="sd">        ignore_case: If True, uses NOT ILIKE for case-insensitive matching</span>
</span><span id="1-656">
</span><span id="1-657"><span class="sd">    Note:</span>
</span><span id="1-658"><span class="sd">        Uses AND for multiple fields, meaning records matching any field will be excluded.</span>
</span><span id="1-659">
</span><span id="1-660"><span class="sd">    See Also:</span>
</span><span id="1-661"><span class="sd">        - :class:`.SearchFilter`: Opposite filter using LIKE/ILIKE</span>
</span><span id="1-662"><span class="sd">        - :meth:`sqlalchemy.sql.expression.ColumnOperators.notlike`: NOT LIKE operator</span>
</span><span id="1-663"><span class="sd">        - :meth:`sqlalchemy.sql.expression.ColumnOperators.notilike`: NOT ILIKE operator</span>
</span><span id="1-664"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-665">
</span><span id="1-666">    <span class="nd">@property</span>
</span><span id="1-667">    <span class="k">def</span><span class="w"> </span><span class="nf">_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
</span><span id="1-668"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the SQL operator for combining multiple negated search clauses.</span>
</span><span id="1-669">
</span><span id="1-670"><span class="sd">        Returns:</span>
</span><span id="1-671"><span class="sd">            Callable[..., ColumnElement[bool]]: The `and_` operator for AND conditions</span>
</span><span id="1-672">
</span><span id="1-673"><span class="sd">        See Also:</span>
</span><span id="1-674"><span class="sd">            :func:`sqlalchemy.sql.expression.and_`: SQLAlchemy AND operator</span>
</span><span id="1-675"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-676">        <span class="k">return</span> <span class="n">and_</span>
</span><span id="1-677">
</span><span id="1-678">    <span class="nd">@property</span>
</span><span id="1-679">    <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;attrgetter[Callable[[str], BinaryExpression[bool]]]&quot;</span><span class="p">:</span>
</span><span id="1-680"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the appropriate NOT LIKE or NOT ILIKE operator as a function.</span>
</span><span id="1-681">
</span><span id="1-682"><span class="sd">        Returns:</span>
</span><span id="1-683"><span class="sd">            attrgetter: Bound method for NOT LIKE or NOT ILIKE operations</span>
</span><span id="1-684">
</span><span id="1-685"><span class="sd">        See Also:</span>
</span><span id="1-686"><span class="sd">            - :meth:`sqlalchemy.sql.expression.ColumnOperators.notlike`: NOT LIKE</span>
</span><span id="1-687"><span class="sd">            - :meth:`sqlalchemy.sql.expression.ColumnOperators.notilike`: NOT ILIKE</span>
</span><span id="1-688"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-689">        <span class="k">return</span> <span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;not_ilike&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_case</span> <span class="k">else</span> <span class="s2">&quot;not_like&quot;</span><span class="p">)</span>
</span><span id="1-690">
</span><span id="1-691">
</span><span id="1-692"><span class="nd">@dataclass</span>
</span><span id="1-693"><span class="k">class</span><span class="w"> </span><span class="nc">ExistsFilter</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">):</span>
</span><span id="1-694"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter for EXISTS subqueries.</span>
</span><span id="1-695">
</span><span id="1-696"><span class="sd">    This filter creates an EXISTS condition using a list of column expressions.</span>
</span><span id="1-697"><span class="sd">    The expressions can be combined using either AND or OR logic. The filter applies</span>
</span><span id="1-698"><span class="sd">    a correlated subquery that returns only the rows from the main query that match</span>
</span><span id="1-699"><span class="sd">    the specified conditions.</span>
</span><span id="1-700">
</span><span id="1-701"><span class="sd">    For example, if searching movies with `Movie.genre == &quot;Action&quot;`, only rows where</span>
</span><span id="1-702"><span class="sd">    the genre is &quot;Action&quot; will be returned.</span>
</span><span id="1-703">
</span><span id="1-704"><span class="sd">    Parameters</span>
</span><span id="1-705"><span class="sd">    ----------</span>
</span><span id="1-706"><span class="sd">    values : list[ColumnElement[bool]]</span>
</span><span id="1-707"><span class="sd">        values: List of SQLAlchemy column expressions to use in the EXISTS clause</span>
</span><span id="1-708"><span class="sd">    operator : Literal[&quot;and&quot;, &quot;or&quot;], optional</span>
</span><span id="1-709"><span class="sd">        operator: If &quot;and&quot;, combines conditions with AND, otherwise uses OR. Defaults to &quot;and&quot;.</span>
</span><span id="1-710">
</span><span id="1-711"><span class="sd">    Example:</span>
</span><span id="1-712"><span class="sd">    --------</span>
</span><span id="1-713"><span class="sd">        Basic usage with AND conditions::</span>
</span><span id="1-714">
</span><span id="1-715"><span class="sd">            from sqlalchemy import select</span>
</span><span id="1-716"><span class="sd">            from advanced_alchemy.filters import ExistsFilter</span>
</span><span id="1-717">
</span><span id="1-718"><span class="sd">            filter = ExistsFilter(</span>
</span><span id="1-719"><span class="sd">                values=[User.email.like(&quot;%@example.com%&quot;)],</span>
</span><span id="1-720"><span class="sd">            )</span>
</span><span id="1-721"><span class="sd">            statement = filter.append_to_statement(</span>
</span><span id="1-722"><span class="sd">                select(Organization), Organization</span>
</span><span id="1-723"><span class="sd">            )</span>
</span><span id="1-724">
</span><span id="1-725"><span class="sd">        This will return only organizations where the user&#39;s email contains &quot;@example.com&quot;.</span>
</span><span id="1-726">
</span><span id="1-727"><span class="sd">        Using OR conditions::</span>
</span><span id="1-728">
</span><span id="1-729"><span class="sd">            filter = ExistsFilter(</span>
</span><span id="1-730"><span class="sd">                values=[User.role == &quot;admin&quot;, User.role == &quot;owner&quot;],</span>
</span><span id="1-731"><span class="sd">                operator=&quot;or&quot;,</span>
</span><span id="1-732"><span class="sd">            )</span>
</span><span id="1-733">
</span><span id="1-734"><span class="sd">        This will return organizations where the user&#39;s role is either &quot;admin&quot; OR &quot;owner&quot;.</span>
</span><span id="1-735">
</span><span id="1-736"><span class="sd">    See Also:</span>
</span><span id="1-737"><span class="sd">    --------</span>
</span><span id="1-738"><span class="sd">        :class:`NotExistsFilter`: The inverse of this filter</span>
</span><span id="1-739"><span class="sd">        :func:`sqlalchemy.sql.expression.exists`: SQLAlchemy EXISTS expression</span>
</span><span id="1-740"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-741">
</span><span id="1-742">    <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
</span><span id="1-743"><span class="w">    </span><span class="sd">&quot;&quot;&quot;List of SQLAlchemy column expressions to use in the EXISTS clause.&quot;&quot;&quot;</span>
</span><span id="1-744">    <span class="n">operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span>
</span><span id="1-745"><span class="w">    </span><span class="sd">&quot;&quot;&quot;If &quot;and&quot;, combines conditions with the AND operator, otherwise uses OR.&quot;&quot;&quot;</span>
</span><span id="1-746">
</span><span id="1-747">    <span class="nd">@property</span>
</span><span id="1-748">    <span class="k">def</span><span class="w"> </span><span class="nf">_and</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
</span><span id="1-749"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the SQLAlchemy `and_` operator.</span>
</span><span id="1-750">
</span><span id="1-751"><span class="sd">        Returns:</span>
</span><span id="1-752"><span class="sd">            Callable[..., ColumnElement[bool]]: The `and_` operator for AND conditions</span>
</span><span id="1-753">
</span><span id="1-754"><span class="sd">        See Also:</span>
</span><span id="1-755"><span class="sd">            :func:`sqlalchemy.sql.expression.and_`: SQLAlchemy AND operator</span>
</span><span id="1-756"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-757">        <span class="k">return</span> <span class="n">and_</span>
</span><span id="1-758">
</span><span id="1-759">    <span class="nd">@property</span>
</span><span id="1-760">    <span class="k">def</span><span class="w"> </span><span class="nf">_or</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
</span><span id="1-761"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the SQLAlchemy `or_` operator.</span>
</span><span id="1-762">
</span><span id="1-763"><span class="sd">        Returns:</span>
</span><span id="1-764"><span class="sd">            Callable[..., ColumnElement[bool]]: The `or_` operator for OR conditions</span>
</span><span id="1-765">
</span><span id="1-766"><span class="sd">        See Also:</span>
</span><span id="1-767"><span class="sd">            :func:`sqlalchemy.sql.expression.or_`: SQLAlchemy OR operator</span>
</span><span id="1-768"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-769">        <span class="k">return</span> <span class="n">or_</span>
</span><span id="1-770">
</span><span id="1-771">    <span class="k">def</span><span class="w"> </span><span class="nf">_get_combined_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-772"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine the filter conditions using the specified operator.</span>
</span><span id="1-773">
</span><span id="1-774"><span class="sd">        Returns:</span>
</span><span id="1-775"><span class="sd">            ColumnElement[bool]:</span>
</span><span id="1-776"><span class="sd">                A SQLAlchemy column expression combining all conditions with AND or OR</span>
</span><span id="1-777"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-778">        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_and</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_or</span>
</span><span id="1-779">        <span class="k">return</span> <span class="n">op</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span><span id="1-780">
</span><span id="1-781">    <span class="k">def</span><span class="w"> </span><span class="nf">get_exists_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-782"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the EXISTS clause for the statement.</span>
</span><span id="1-783">
</span><span id="1-784"><span class="sd">        Args:</span>
</span><span id="1-785"><span class="sd">            model : type[ModelT]</span>
</span><span id="1-786"><span class="sd">                The SQLAlchemy model class to correlate with</span>
</span><span id="1-787">
</span><span id="1-788"><span class="sd">        Returns:</span>
</span><span id="1-789"><span class="sd">            ColumnElement[bool]:</span>
</span><span id="1-790"><span class="sd">                A correlated EXISTS expression for use in a WHERE clause</span>
</span><span id="1-791"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-792">        <span class="c1"># Handle empty values list case</span>
</span><span id="1-793">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="1-794">            <span class="c1"># Use explicitly imported &#39;false&#39; from sqlalchemy</span>
</span><span id="1-795">            <span class="c1"># Return SQLAlchemy FALSE expression</span>
</span><span id="1-796">            <span class="k">return</span> <span class="n">false</span><span class="p">()</span>
</span><span id="1-797">
</span><span id="1-798">        <span class="c1"># Combine all values with AND or OR (using the operator specified in the filter)</span>
</span><span id="1-799">        <span class="c1"># This creates a single boolean expression from multiple conditions</span>
</span><span id="1-800">        <span class="n">combined_conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_combined_conditions</span><span class="p">()</span>
</span><span id="1-801">
</span><span id="1-802">        <span class="c1"># Create a correlated subquery with the combined conditions</span>
</span><span id="1-803">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-804">            <span class="n">subquery</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">combined_conditions</span><span class="p">)</span>
</span><span id="1-805">            <span class="n">correlated_subquery</span> <span class="o">=</span> <span class="n">subquery</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">__table__</span><span class="p">)</span>
</span><span id="1-806">            <span class="k">return</span> <span class="n">exists</span><span class="p">(</span><span class="n">correlated_subquery</span><span class="p">)</span>
</span><span id="1-807">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
</span><span id="1-808">            <span class="k">return</span> <span class="n">false</span><span class="p">()</span>
</span><span id="1-809">
</span><span id="1-810">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-811"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append EXISTS condition to the statement.</span>
</span><span id="1-812">
</span><span id="1-813"><span class="sd">        Args:</span>
</span><span id="1-814"><span class="sd">            statement : StatementTypeT</span>
</span><span id="1-815"><span class="sd">                The SQLAlchemy statement to modify</span>
</span><span id="1-816"><span class="sd">            model : type[ModelT]</span>
</span><span id="1-817"><span class="sd">            The SQLAlchemy model class</span>
</span><span id="1-818">
</span><span id="1-819"><span class="sd">        Returns:</span>
</span><span id="1-820"><span class="sd">            StatementTypeT:</span>
</span><span id="1-821"><span class="sd">                Modified statement with EXISTS condition</span>
</span><span id="1-822"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-823">        <span class="c1"># We apply the exists clause regardless of whether self.values is empty,</span>
</span><span id="1-824">        <span class="c1"># as get_exists_clause handles the empty case by returning false().</span>
</span><span id="1-825">        <span class="n">exists_clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exists_clause</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="1-826">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">exists_clause</span><span class="p">))</span>
</span><span id="1-827">
</span><span id="1-828">
</span><span id="1-829"><span class="nd">@dataclass</span>
</span><span id="1-830"><span class="k">class</span><span class="w"> </span><span class="nc">NotExistsFilter</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">):</span>
</span><span id="1-831"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter for NOT EXISTS subqueries.</span>
</span><span id="1-832">
</span><span id="1-833"><span class="sd">    This filter creates a NOT EXISTS condition using a list of column expressions.</span>
</span><span id="1-834"><span class="sd">    The expressions can be combined using either AND or OR logic. The filter applies</span>
</span><span id="1-835"><span class="sd">    a correlated subquery that returns only the rows from the main query that DO NOT</span>
</span><span id="1-836"><span class="sd">    match the specified conditions.</span>
</span><span id="1-837">
</span><span id="1-838"><span class="sd">    For example, if searching movies with `Movie.genre == &quot;Action&quot;`, only rows where</span>
</span><span id="1-839"><span class="sd">    the genre is NOT &quot;Action&quot; will be returned.</span>
</span><span id="1-840">
</span><span id="1-841"><span class="sd">    Parameters</span>
</span><span id="1-842"><span class="sd">    ----------</span>
</span><span id="1-843"><span class="sd">    values : list[ColumnElement[bool]]</span>
</span><span id="1-844"><span class="sd">        values: List of SQLAlchemy column expressions to use in the NOT EXISTS clause</span>
</span><span id="1-845"><span class="sd">    operator : Literal[&quot;and&quot;, &quot;or&quot;], optional</span>
</span><span id="1-846"><span class="sd">        operator: If &quot;and&quot;, combines conditions with AND, otherwise uses OR. Defaults to &quot;and&quot;.</span>
</span><span id="1-847">
</span><span id="1-848"><span class="sd">    Example:</span>
</span><span id="1-849"><span class="sd">    --------</span>
</span><span id="1-850"><span class="sd">        Basic usage with AND conditions::</span>
</span><span id="1-851">
</span><span id="1-852"><span class="sd">            from sqlalchemy import select</span>
</span><span id="1-853"><span class="sd">            from advanced_alchemy.filters import NotExistsFilter</span>
</span><span id="1-854">
</span><span id="1-855"><span class="sd">            filter = NotExistsFilter(</span>
</span><span id="1-856"><span class="sd">                values=[User.email.like(&quot;%@example.com%&quot;)],</span>
</span><span id="1-857"><span class="sd">            )</span>
</span><span id="1-858"><span class="sd">            statement = filter.append_to_statement(</span>
</span><span id="1-859"><span class="sd">                select(Organization), Organization</span>
</span><span id="1-860"><span class="sd">            )</span>
</span><span id="1-861">
</span><span id="1-862"><span class="sd">        This will return only organizations where the user&#39;s email does NOT contain &quot;@example.com&quot;.</span>
</span><span id="1-863">
</span><span id="1-864"><span class="sd">        Using OR conditions::</span>
</span><span id="1-865">
</span><span id="1-866"><span class="sd">            filter = NotExistsFilter(</span>
</span><span id="1-867"><span class="sd">                values=[User.role == &quot;admin&quot;, User.role == &quot;owner&quot;],</span>
</span><span id="1-868"><span class="sd">                operator=&quot;or&quot;,</span>
</span><span id="1-869"><span class="sd">            )</span>
</span><span id="1-870">
</span><span id="1-871"><span class="sd">        This will return organizations where the user&#39;s role is NEITHER &quot;admin&quot; NOR &quot;owner&quot;.</span>
</span><span id="1-872">
</span><span id="1-873"><span class="sd">    See Also:</span>
</span><span id="1-874"><span class="sd">    --------</span>
</span><span id="1-875"><span class="sd">        :class:`ExistsFilter`: The inverse of this filter</span>
</span><span id="1-876"><span class="sd">        :func:`sqlalchemy.sql.expression.not_`: SQLAlchemy NOT operator</span>
</span><span id="1-877"><span class="sd">        :func:`sqlalchemy.sql.expression.exists`: SQLAlchemy EXISTS expression</span>
</span><span id="1-878"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-879">
</span><span id="1-880">    <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
</span><span id="1-881"><span class="w">    </span><span class="sd">&quot;&quot;&quot;List of SQLAlchemy column expressions to use in the NOT EXISTS clause.&quot;&quot;&quot;</span>
</span><span id="1-882">    <span class="n">operator</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="s2">&quot;or&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span>
</span><span id="1-883"><span class="w">    </span><span class="sd">&quot;&quot;&quot;If &quot;and&quot;, combines conditions with the AND operator, otherwise uses OR.&quot;&quot;&quot;</span>
</span><span id="1-884">
</span><span id="1-885">    <span class="nd">@property</span>
</span><span id="1-886">    <span class="k">def</span><span class="w"> </span><span class="nf">_and</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
</span><span id="1-887"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the SQLAlchemy `and_` operator.</span>
</span><span id="1-888">
</span><span id="1-889"><span class="sd">        Returns:</span>
</span><span id="1-890"><span class="sd">            Callable[..., ColumnElement[bool]]: The `and_` operator for AND conditions</span>
</span><span id="1-891">
</span><span id="1-892"><span class="sd">        See Also:</span>
</span><span id="1-893"><span class="sd">            :func:`sqlalchemy.sql.expression.and_`: SQLAlchemy AND operator</span>
</span><span id="1-894"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-895">        <span class="k">return</span> <span class="n">and_</span>
</span><span id="1-896">
</span><span id="1-897">    <span class="nd">@property</span>
</span><span id="1-898">    <span class="k">def</span><span class="w"> </span><span class="nf">_or</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
</span><span id="1-899"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the SQLAlchemy `or_` operator.</span>
</span><span id="1-900">
</span><span id="1-901"><span class="sd">        Returns:</span>
</span><span id="1-902"><span class="sd">            Callable[..., ColumnElement[bool]]: The `or_` operator for OR conditions</span>
</span><span id="1-903">
</span><span id="1-904"><span class="sd">        See Also:</span>
</span><span id="1-905"><span class="sd">            :func:`sqlalchemy.sql.expression.or_`: SQLAlchemy OR operator</span>
</span><span id="1-906"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-907">        <span class="k">return</span> <span class="n">or_</span>
</span><span id="1-908">
</span><span id="1-909">    <span class="k">def</span><span class="w"> </span><span class="nf">_get_combined_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-910">        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_and</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_or</span>
</span><span id="1-911">        <span class="k">return</span> <span class="n">op</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span><span id="1-912">
</span><span id="1-913">    <span class="k">def</span><span class="w"> </span><span class="nf">get_exists_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="1-914"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the NOT EXISTS clause for the statement.</span>
</span><span id="1-915">
</span><span id="1-916"><span class="sd">        Args:</span>
</span><span id="1-917"><span class="sd">            model : type[ModelT]</span>
</span><span id="1-918"><span class="sd">                The SQLAlchemy model class to correlate with</span>
</span><span id="1-919">
</span><span id="1-920">
</span><span id="1-921"><span class="sd">        Returns:</span>
</span><span id="1-922"><span class="sd">            ColumnElement[bool]:</span>
</span><span id="1-923"><span class="sd">                A correlated NOT EXISTS expression for use in a WHERE clause</span>
</span><span id="1-924"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-925">        <span class="c1"># Handle empty values list case</span>
</span><span id="1-926">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="1-927">            <span class="c1"># Return SQLAlchemy TRUE expression</span>
</span><span id="1-928">            <span class="k">return</span> <span class="n">true</span><span class="p">()</span>
</span><span id="1-929">
</span><span id="1-930">        <span class="c1"># Combine conditions and create correlated subquery</span>
</span><span id="1-931">        <span class="n">combined_conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_combined_conditions</span><span class="p">()</span>
</span><span id="1-932">        <span class="n">subquery</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">combined_conditions</span><span class="p">)</span>
</span><span id="1-933">        <span class="n">correlated_subquery</span> <span class="o">=</span> <span class="n">subquery</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">__table__</span><span class="p">)</span>
</span><span id="1-934">        <span class="k">return</span> <span class="n">not_</span><span class="p">(</span><span class="n">exists</span><span class="p">(</span><span class="n">correlated_subquery</span><span class="p">))</span>
</span><span id="1-935">
</span><span id="1-936">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-937"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append NOT EXISTS condition to the statement.</span>
</span><span id="1-938">
</span><span id="1-939"><span class="sd">        Args:</span>
</span><span id="1-940"><span class="sd">            statement : StatementTypeT</span>
</span><span id="1-941"><span class="sd">                The SQLAlchemy statement to modify</span>
</span><span id="1-942"><span class="sd">            model : type[ModelT]</span>
</span><span id="1-943"><span class="sd">                The SQLAlchemy model class</span>
</span><span id="1-944">
</span><span id="1-945"><span class="sd">        Returns:</span>
</span><span id="1-946"><span class="sd">            StatementTypeT:</span>
</span><span id="1-947"><span class="sd">                Modified statement with NOT EXISTS condition</span>
</span><span id="1-948"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-949">        <span class="c1"># We apply the exists clause regardless of whether self.values is empty,</span>
</span><span id="1-950">        <span class="c1"># as get_exists_clause handles the empty case by returning true.</span>
</span><span id="1-951">        <span class="n">exists_clause</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_exists_clause</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="1-952">        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">exists_clause</span><span class="p">))</span>
</span><span id="1-953">
</span><span id="1-954">
</span><span id="1-955"><span class="nd">@dataclass</span>
</span><span id="1-956"><span class="k">class</span><span class="w"> </span><span class="nc">FilterGroup</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">):</span>
</span><span id="1-957"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A group of filters combined with a logical operator.</span>
</span><span id="1-958">
</span><span id="1-959"><span class="sd">    This class combines multiple filters with a logical operator (AND/OR).</span>
</span><span id="1-960"><span class="sd">    It provides a way to create complex nested filter conditions.</span>
</span><span id="1-961"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-962">
</span><span id="1-963">    <span class="n">logical_operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
</span><span id="1-964"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Logical operator to combine the filters.&quot;&quot;&quot;</span>
</span><span id="1-965">    <span class="n">filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StatementFilter</span><span class="p">]</span>
</span><span id="1-966"><span class="w">    </span><span class="sd">&quot;&quot;&quot;List of filters to combine.&quot;&quot;&quot;</span>
</span><span id="1-967">
</span><span id="1-968">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span>
</span><span id="1-969">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-970">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span>
</span><span id="1-971">        <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span>
</span><span id="1-972">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;StatementTypeT&quot;</span><span class="p">:</span>
</span><span id="1-973"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply all filters combined with the logical operator.</span>
</span><span id="1-974">
</span><span id="1-975"><span class="sd">        Args:</span>
</span><span id="1-976"><span class="sd">            statement: The SQLAlchemy statement to modify</span>
</span><span id="1-977"><span class="sd">            model: The SQLAlchemy model class</span>
</span><span id="1-978">
</span><span id="1-979"><span class="sd">        Returns:</span>
</span><span id="1-980"><span class="sd">            StatementTypeT: Modified statement with combined filters</span>
</span><span id="1-981"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-982">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="1-983">            <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-984">
</span><span id="1-985">        <span class="c1"># Create a list of expressions from each filter</span>
</span><span id="1-986">        <span class="n">expressions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-987">        <span class="k">for</span> <span class="n">filter_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
</span><span id="1-988">            <span class="c1"># Each filter needs to be applied to a clean version of the statement</span>
</span><span id="1-989">            <span class="c1"># to get just its expression</span>
</span><span id="1-990">            <span class="n">filter_statement</span> <span class="o">=</span> <span class="n">filter_obj</span><span class="o">.</span><span class="n">append_to_statement</span><span class="p">(</span><span class="n">select</span><span class="p">(),</span> <span class="n">model</span><span class="p">)</span>
</span><span id="1-991">            <span class="c1"># Extract the whereclause from the filter&#39;s statement</span>
</span><span id="1-992">            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filter_statement</span><span class="p">,</span> <span class="s2">&quot;whereclause&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filter_statement</span><span class="o">.</span><span class="n">whereclause</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-993">                <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filter_statement</span><span class="o">.</span><span class="n">whereclause</span><span class="p">)</span>  <span class="c1"># pyright: ignore</span>
</span><span id="1-994">
</span><span id="1-995">        <span class="k">if</span> <span class="n">expressions</span><span class="p">:</span>
</span><span id="1-996">            <span class="c1"># Combine all expressions with the logical operator</span>
</span><span id="1-997">            <span class="n">combined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_operator</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span><span id="1-998">            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;StatementTypeT&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">combined</span><span class="p">))</span>
</span><span id="1-999">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1000">
</span><span id="1-1001">
</span><span id="1-1002"><span class="nd">@dataclass</span>
</span><span id="1-1003"><span class="k">class</span><span class="w"> </span><span class="nc">MultiFilter</span><span class="p">(</span><span class="n">StatementFilter</span><span class="p">):</span>
</span><span id="1-1004"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply multiple filters to a query based on a JSON/dict input.</span>
</span><span id="1-1005">
</span><span id="1-1006"><span class="sd">    This filter provides a way to construct complex filter trees from</span>
</span><span id="1-1007"><span class="sd">    a structured dictionary input, supporting nested logical groups and</span>
</span><span id="1-1008"><span class="sd">    various filter types.</span>
</span><span id="1-1009"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-1010">
</span><span id="1-1011">    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="1-1012"><span class="w">    </span><span class="sd">&quot;&quot;&quot;JSON/dict structure representing the filters.&quot;&quot;&quot;</span>
</span><span id="1-1013">
</span><span id="1-1014">    <span class="c1"># TypedDict class variables</span>
</span><span id="1-1015">    <span class="n">_filter_map</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">FilterMap</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-1016">        <span class="s2">&quot;before_after&quot;</span><span class="p">:</span> <span class="n">BeforeAfter</span><span class="p">,</span>
</span><span id="1-1017">        <span class="s2">&quot;on_before_after&quot;</span><span class="p">:</span> <span class="n">OnBeforeAfter</span><span class="p">,</span>
</span><span id="1-1018">        <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">CollectionFilter</span><span class="p">,</span>
</span><span id="1-1019">        <span class="s2">&quot;not_in_collection&quot;</span><span class="p">:</span> <span class="n">NotInCollectionFilter</span><span class="p">,</span>
</span><span id="1-1020">        <span class="s2">&quot;limit_offset&quot;</span><span class="p">:</span> <span class="n">LimitOffset</span><span class="p">,</span>
</span><span id="1-1021">        <span class="s2">&quot;order_by&quot;</span><span class="p">:</span> <span class="n">OrderBy</span><span class="p">,</span>
</span><span id="1-1022">        <span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="n">SearchFilter</span><span class="p">,</span>
</span><span id="1-1023">        <span class="s2">&quot;not_in_search&quot;</span><span class="p">:</span> <span class="n">NotInSearchFilter</span><span class="p">,</span>
</span><span id="1-1024">        <span class="s2">&quot;filter_group&quot;</span><span class="p">:</span> <span class="n">FilterGroup</span><span class="p">,</span>
</span><span id="1-1025">        <span class="s2">&quot;comparison&quot;</span><span class="p">:</span> <span class="n">ComparisonFilter</span><span class="p">,</span>
</span><span id="1-1026">        <span class="s2">&quot;exists&quot;</span><span class="p">:</span> <span class="n">ExistsFilter</span><span class="p">,</span>
</span><span id="1-1027">        <span class="s2">&quot;not_exists&quot;</span><span class="p">:</span> <span class="n">NotExistsFilter</span><span class="p">,</span>
</span><span id="1-1028">    <span class="p">}</span>
</span><span id="1-1029">
</span><span id="1-1030">    <span class="n">_logical_map</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">LogicalOperatorMap</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-1031">        <span class="s2">&quot;and_&quot;</span><span class="p">:</span> <span class="n">and_</span><span class="p">,</span>
</span><span id="1-1032">        <span class="s2">&quot;or_&quot;</span><span class="p">:</span> <span class="n">or_</span><span class="p">,</span>
</span><span id="1-1033">    <span class="p">}</span>
</span><span id="1-1034">
</span><span id="1-1035">    <span class="k">def</span><span class="w"> </span><span class="nf">append_to_statement</span><span class="p">(</span>
</span><span id="1-1036">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1037">        <span class="n">statement</span><span class="p">:</span> <span class="n">StatementTypeT</span><span class="p">,</span>
</span><span id="1-1038">        <span class="n">model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ModelT</span><span class="p">],</span>
</span><span id="1-1039">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatementTypeT</span><span class="p">:</span>
</span><span id="1-1040"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply the filters to the statement based on the filter definitions.</span>
</span><span id="1-1041">
</span><span id="1-1042"><span class="sd">        Args:</span>
</span><span id="1-1043"><span class="sd">            statement: The SQLAlchemy statement to modify</span>
</span><span id="1-1044"><span class="sd">            model: The SQLAlchemy model class</span>
</span><span id="1-1045">
</span><span id="1-1046"><span class="sd">        Returns:</span>
</span><span id="1-1047"><span class="sd">            StatementTypeT: Modified statement with all filters applied</span>
</span><span id="1-1048"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1049">        <span class="k">for</span> <span class="n">filter_type</span><span class="p">,</span> <span class="n">conditions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="1-1050">            <span class="n">operator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logical_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filter_type</span><span class="p">)</span>
</span><span id="1-1051">            <span class="k">if</span> <span class="n">operator</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="1-1052">                <span class="c1"># Create filters from the conditions</span>
</span><span id="1-1053">                <span class="n">valid_filters</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-1054">                <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>  <span class="c1"># pyright: ignore</span>
</span><span id="1-1055">                    <span class="n">filter_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_filter</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>  <span class="c1"># pyright: ignore</span>
</span><span id="1-1056">                    <span class="k">if</span> <span class="n">filter_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1057">                        <span class="n">valid_filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filter_instance</span><span class="p">)</span>  <span class="c1"># pyright: ignore</span>
</span><span id="1-1058">
</span><span id="1-1059">                <span class="c1"># Only create a filter group if we have valid filters</span>
</span><span id="1-1060">                <span class="k">if</span> <span class="n">valid_filters</span><span class="p">:</span>
</span><span id="1-1061">                    <span class="n">filter_group</span> <span class="o">=</span> <span class="n">FilterGroup</span><span class="p">(</span>
</span><span id="1-1062">                        <span class="n">logical_operator</span><span class="o">=</span><span class="n">operator</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
</span><span id="1-1063">                        <span class="n">filters</span><span class="o">=</span><span class="n">valid_filters</span><span class="p">,</span>  <span class="c1"># pyright: ignore</span>
</span><span id="1-1064">                    <span class="p">)</span>
</span><span id="1-1065">                    <span class="n">statement</span> <span class="o">=</span> <span class="n">filter_group</span><span class="o">.</span><span class="n">append_to_statement</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="1-1066">        <span class="k">return</span> <span class="n">statement</span>
</span><span id="1-1067">
</span><span id="1-1068">    <span class="k">def</span><span class="w"> </span><span class="nf">_create_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StatementFilter</span><span class="p">]:</span>
</span><span id="1-1069"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a filter instance from a condition dictionary.</span>
</span><span id="1-1070">
</span><span id="1-1071"><span class="sd">        Args:</span>
</span><span id="1-1072"><span class="sd">            condition: Dictionary defining a filter</span>
</span><span id="1-1073">
</span><span id="1-1074"><span class="sd">        Returns:</span>
</span><span id="1-1075"><span class="sd">            Optional[StatementFilter]: Filter instance if successfully created, None otherwise</span>
</span><span id="1-1076"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1077">        <span class="c1"># Check if condition is a nested logical group</span>
</span><span id="1-1078">        <span class="n">logical_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logical_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="1-1079">        <span class="n">intersect</span> <span class="o">=</span> <span class="n">logical_keys</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">condition</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="1-1080">        <span class="k">if</span> <span class="n">intersect</span><span class="p">:</span>
</span><span id="1-1081">            <span class="c1"># It&#39;s a nested filter group</span>
</span><span id="1-1082">            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">intersect</span><span class="p">:</span>
</span><span id="1-1083">                <span class="n">operator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logical_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="1-1084">                <span class="k">if</span> <span class="n">operator</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="1-1085">                    <span class="n">nested_filters</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="1-1086">                    <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
</span><span id="1-1087">                        <span class="n">filter_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_filter</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>
</span><span id="1-1088">                        <span class="k">if</span> <span class="n">filter_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1089">                            <span class="n">nested_filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filter_instance</span><span class="p">)</span>  <span class="c1"># pyright: ignore</span>
</span><span id="1-1090">
</span><span id="1-1091">                    <span class="k">if</span> <span class="n">nested_filters</span><span class="p">:</span>
</span><span id="1-1092">                        <span class="k">return</span> <span class="n">FilterGroup</span><span class="p">(</span><span class="n">logical_operator</span><span class="o">=</span><span class="n">operator</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">nested_filters</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-1093">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1094">            <span class="c1"># Regular filter</span>
</span><span id="1-1095">            <span class="n">filter_type</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="1-1096">            <span class="k">if</span> <span class="n">filter_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="1-1097">                <span class="n">filter_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filter_type</span><span class="p">)</span>
</span><span id="1-1098">                <span class="k">if</span> <span class="n">filter_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1099">                    <span class="k">try</span><span class="p">:</span>
</span><span id="1-1100">                        <span class="c1"># Create a copy of the condition without the type key</span>
</span><span id="1-1101">                        <span class="n">filter_args</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">condition</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;type&quot;</span><span class="p">}</span>
</span><span id="1-1102">                        <span class="k">return</span> <span class="n">filter_class</span><span class="p">(</span><span class="o">**</span><span class="n">filter_args</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="1-1103">                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: BLE001</span>
</span><span id="1-1104">                        <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-1105">        <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-1106">
</span><span id="1-1107">
</span><span id="1-1108"><span class="c1"># Define FilterTypes using direct class references</span>
</span><span id="1-1109"><span class="n">FilterTypes</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="1-1110">    <span class="n">BeforeAfter</span><span class="p">,</span>
</span><span id="1-1111">    <span class="n">OnBeforeAfter</span><span class="p">,</span>
</span><span id="1-1112">    <span class="n">CollectionFilter</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-1113">    <span class="n">LimitOffset</span><span class="p">,</span>
</span><span id="1-1114">    <span class="n">OrderBy</span><span class="p">,</span>
</span><span id="1-1115">    <span class="n">SearchFilter</span><span class="p">,</span>
</span><span id="1-1116">    <span class="n">NotInCollectionFilter</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="1-1117">    <span class="n">NotInSearchFilter</span><span class="p">,</span>
</span><span id="1-1118">    <span class="n">ExistsFilter</span><span class="p">,</span>
</span><span id="1-1119">    <span class="n">NotExistsFilter</span><span class="p">,</span>
</span><span id="1-1120">    <span class="n">ComparisonFilter</span><span class="p">,</span>
</span><span id="1-1121">    <span class="n">MultiFilter</span><span class="p">,</span>
</span><span id="1-1122">    <span class="n">FilterGroup</span><span class="p">,</span>
</span><span id="1-1123"><span class="p">]</span>
</span><span id="1-1124"><span class="sd">&quot;&quot;&quot;Aggregate type alias of the types supported for collection filtering.&quot;&quot;&quot;</span>
</span></pre></div>
        </article>
        
        <div class="navigation flex print:hidden">
  
  
</div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2023, Jacob Coffee</p>
        
        <p>
          Made with
          
          <a href="https://www.sphinx-doc.org/">Sphinx</a> and
          
          <a href="https://shibuya.lepture.com">Shibuya theme</a>.
        </p>
      </div>
      <div class="sy-foot-socials">
          <a href="https://github.com/JacobCoffee/byte-bot" aria-label="GitHub"><i class="i-icon github"></i></a>
          <a href="https://twitter.com/_scriptr" aria-label="X (Twitter)"><i class="i-icon x-twitter"></i></a>
          <a href="https://discord.gg/ZVG8hN6RrJ/" aria-label="Discord"><i class="i-icon discord"></i></a>
          <a href="https://youtube.com/@monorepo" aria-label="YouTube"><i class="i-icon youtube"></i></a>
      </div>
    </div>
  </div>
</footer></div>
      <script src="../../_static/documentation_options.js?v=8dde47fa"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../_static/shibuya.js?v=3e5c8598"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    
</body>
</html>